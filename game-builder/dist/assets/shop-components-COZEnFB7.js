import{r as n,j as e,c as be,L as fe}from"./vendor-react-B5bTltmH.js";import{b as de,a as me,u as je,S as Ne}from"./app-contexts-DyyK1F6R.js";import{I as ke,u as he,T as we}from"./ui-components-C6zsR5sV.js";import{g as ve}from"./utils-CqSnstQE.js";const Ie=()=>{const{currencies:o,addCurrency:h,updateCurrency:T,deleteCurrency:G,setDefaultCurrency:B}=de(),[f,N]=n.useState(!1),[x,g]=n.useState(null),[i,u]=n.useState({id:"",name:"",description:"",icon:null,exchangeRate:1,isDefault:!1}),d=[{id:"Soft_currency",name:"Луны",description:"Основная игровая валюта",icon:null,exchangeRate:1,isDefault:!0},{id:"Medium_currency",name:"Солы",description:"Переходящая валюта",icon:null,exchangeRate:.1,isDefault:!1},{id:"Hard_currency",name:"Алетит",description:"Премиальная валюта",icon:null,exchangeRate:.01,isDefault:!1}],j=(l,v)=>{f&&x?g({...x,[l]:v}):u({...i,[l]:v})},U=l=>{f&&x?g({...x,icon:l}):u({...i,icon:l})},w=()=>{if(f&&x)T(x.id,x),N(!1),g(null);else{if(!i.id||!i.name){alert("Заполните обязательные поля: ID и Название");return}if(o.some(l=>l.id===i.id)){alert("Валюта с таким ID уже существует");return}h(i),u({id:"",name:"",description:"",icon:null,exchangeRate:1,isDefault:!1})}},z=()=>{N(!1),g(null)},J=l=>{g({...l}),N(!0)},O=l=>{window.confirm("Вы уверены, что хотите удалить эту валюту?")&&G(l)},Y=l=>{B(l)},A=()=>{const l=[{oldId:"Soft_currency",newName:"Луны",newDesc:"Основная игровая валюта",rate:1,isDefault:!0},{oldId:"Medium_currency",newName:"Солы",newDesc:"Переходящая валюта",rate:.1},{oldId:"Premium_currency",newName:"Солы",newDesc:"Переходящая валюта",rate:.1},{oldId:"Hard_currency",newName:"Алетит",newDesc:"Премиальная валюта",rate:.01},{oldId:"Special_currency",newName:"Алетит",newDesc:"Премиальная валюта",rate:.01}];let v=!1;l.forEach(y=>{o.find(k=>k.id===y.oldId)&&(T(y.oldId,{name:y.newName,description:y.newDesc,exchangeRate:y.rate}),y.isDefault&&B(y.oldId),v=!0)}),d.forEach(y=>{o.some(R=>R.id===y.id)||(h(y),v=!0)}),o.some(y=>y.isDefault)||B("Soft_currency"),v||alert("Все стандартные валюты уже добавлены")},V=l=>l.id==="Soft_currency"?"Базовая валюта":l.id==="Medium_currency"?"10 Солов = 100 Лунов":l.id==="Hard_currency"?"10 Алетит = 100 Солов = 1000 Лунов":`1 = ${1/(l.exchangeRate||1)} Лунов`;return e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{className:"bg-white dark:bg-gray-800 p-6 rounded-lg shadow-md",children:[e.jsx("h2",{className:"text-xl font-semibold mb-4 text-gray-800 dark:text-white",children:f?"Редактирование валюты":"Добавление новой валюты"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1 text-gray-700 dark:text-gray-300",children:"ID валюты*"}),e.jsx("input",{type:"text",value:f?(x==null?void 0:x.id)||"":i.id,onChange:l=>j("id",l.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white",readOnly:f,placeholder:"например: gold_coins"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1 text-gray-700 dark:text-gray-300",children:"Название*"}),e.jsx("input",{type:"text",value:f?(x==null?void 0:x.name)||"":i.name,onChange:l=>j("name",l.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white",placeholder:"например: Луны"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1 text-gray-700 dark:text-gray-300",children:"Иконка валюты"}),e.jsx(ke,{onUpload:U})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1 text-gray-700 dark:text-gray-300",children:"Курс обмена"}),e.jsx("input",{type:"number",min:"0.001",step:"0.001",value:f?(x==null?void 0:x.exchangeRate)||1:i.exchangeRate,onChange:l=>j("exchangeRate",parseFloat(l.target.value)||1),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white",placeholder:"относительно Лунов"}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:"Значение относительно базовой валюты (Луны). Например, 0.1 означает: 1 единица этой валюты = 10 Лунов."})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium mb-1 text-gray-700 dark:text-gray-300",children:"Описание"}),e.jsx("textarea",{value:f?(x==null?void 0:x.description)||"":i.description,onChange:l=>j("description",l.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white",rows:2})]}),!f&&e.jsxs("div",{className:"md:col-span-2",children:[e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",checked:i.isDefault||!1,onChange:l=>j("isDefault",l.target.checked),className:"h-4 w-4 text-blue-600 rounded"}),e.jsx("span",{className:"ml-2 text-gray-700 dark:text-gray-300",children:"Установить как валюту по умолчанию"})]}),e.jsx("p",{className:"text-xs text-red-500 mt-1",children:"Внимание: Рекомендуется использовать Луны (Soft_currency) как валюту по умолчанию."})]})]}),e.jsxs("div",{className:"flex justify-between space-x-2",children:[e.jsx("button",{onClick:A,className:"px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 transition-colors",children:"Добавить стандартные валюты"}),e.jsxs("div",{className:"flex space-x-2",children:[f&&e.jsx("button",{onClick:z,className:"px-4 py-2 bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-white rounded-md hover:bg-gray-300 dark:hover:bg-gray-600 transition-colors",children:"Отмена"}),e.jsx("button",{onClick:w,className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors",children:f?"Сохранить изменения":"Добавить валюту"})]})]})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 p-6 rounded-lg shadow-md",children:[e.jsx("h2",{className:"text-xl font-semibold mb-4 text-gray-800 dark:text-white",children:"Список валют"}),o.length===0?e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Нет добавленных валют"}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200 dark:divide-gray-700",children:[e.jsx("thead",{className:"bg-gray-50 dark:bg-gray-700",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"ID"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Название"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Иконка"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Курс обмена"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"По умолчанию"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Действия"})]})}),e.jsx("tbody",{className:"bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700",children:o.map(l=>e.jsxs("tr",{className:"hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-gray-100",children:l.id}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-gray-100",children:l.name}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:l.icon?e.jsx("div",{className:"h-8 w-8 rounded-full bg-gray-200 dark:bg-gray-700 overflow-hidden",children:e.jsx("img",{src:`/api/image/${l.icon}`,alt:l.name,className:"h-full w-full object-cover",onError:v=>{v.target.src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzIiIGhlaWdodD0iMzIiIHZpZXdCb3g9IjAgMCAzMiAzMiIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48Y2lyY2xlIGN4PSIxNiIgY3k9IjE2IiByPSIxNiIgZmlsbD0iIzY0NzQ4QiIvPjx0ZXh0IHg9IjEyIiB5PSIyMCIgZm9udC1mYW1pbHk9IkFyaWFsIiBmb250LXNpemU9IjE0IiBmaWxsPSJ3aGl0ZSI+JDwvdGV4dD48L3N2Zz4="}})}):e.jsx("div",{className:"h-8 w-8 rounded-full bg-gray-600 flex items-center justify-center text-white",children:"$"})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-gray-100",children:V(l)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:l.isDefault?e.jsx("span",{className:"px-2 py-1 text-xs bg-green-100 dark:bg-green-900/30 text-green-800 dark:text-green-300 rounded-full",children:"По умолчанию"}):e.jsx("button",{onClick:()=>Y(l.id),className:"text-xs text-blue-600 dark:text-blue-400 hover:underline",children:"Сделать по умолчанию"})}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:[e.jsx("button",{onClick:()=>J(l),className:"text-indigo-600 dark:text-indigo-400 hover:text-indigo-900 mr-3",children:"Изменить"}),!l.isDefault&&e.jsx("button",{onClick:()=>O(l.id),className:"text-red-600 dark:text-red-400 hover:text-red-900",children:"Удалить"})]})]},l.id))})]})})]})]})},re=new Set,Ce=be.memo(({shopId:o,onClose:h})=>{var oe,xe;const{shops:T,addItemToShop:G,getDefaultCurrency:B,removeItemFromShop:f}=de(),{comparisonItems:N,calculateItemCost:x}=me(),g=me(),{addToast:i}=he(),{state:u}=je(),d=n.useRef(re.has(o)),j=n.useRef(new Map),U=n.useRef(!d.current),w=n.useRef(null),[z,J]=n.useState(d.current),[O,Y]=n.useState(""),[A,V]=n.useState(""),[l,v]=n.useState([]),y=6,R=8,[k,X]=n.useState(1),[I,b]=n.useState(1),[$,L]=n.useState("name"),[F,ae]=n.useState("asc"),M=n.useMemo(()=>T==null?void 0:T.find(t=>t.shopId===o),[T,o]),K=n.useMemo(()=>B(),[B]),[C,H]=n.useState({shopItemId:"",minAppearanceCount:1,maxAppearanceCount:1,appearanceChance:1,overrideCost:!1,overrideCurrencyId:(K==null?void 0:K.id)||"",buyCost:{costType:0,from:100,to:100},sellCost:{costType:0,from:70,to:70},id:"",count:1}),se=n.useCallback(t=>{if(!t)return null;if(j.current.has(t))return j.current.get(t)||null;try{const a=ve(t,u);return j.current.set(t,a),a}catch(a){return console.error("Error getting image URL:",a),j.current.set(t,null),null}},[u]),le=n.useMemo(()=>{var a;const t=new Set;return N.forEach(s=>{var p;(p=s.selectedCategories)==null||p.forEach(E=>t.add(E))}),(a=u.resources)!=null&&a.items&&u.resources.items.forEach(s=>{s.category&&t.add(s.category)}),["",...Array.from(t)].sort()},[N,(oe=u.resources)==null?void 0:oe.items]),D=n.useMemo(()=>{var a;const t=[];return N&&t.push(...N.map(s=>{var p;return{...s,source:"balance",category:((p=s.selectedCategories)==null?void 0:p.join(", "))||"Без категории"}})),(a=u.resources)!=null&&a.items&&t.push(...u.resources.items.map(s=>({name:s.name||s.id,imageId:s.imageId,source:"resource",tier:1,mechanic:"Найти в мире",selectedCategories:s.category?[s.category]:[],selectedModifiers:[],selectedLocations:[],frequencyType:"Часто встречаемый",craftComplexity:"Не крафтиться",category:s.category||"Ресурс"}))),t},[N,(xe=u.resources)==null?void 0:xe.items]),ee=n.useCallback(t=>t.name!==void 0&&t.tier!==void 0&&t.mechanic!==void 0&&Array.isArray(t.selectedCategories)&&Array.isArray(t.selectedModifiers)&&Array.isArray(t.selectedLocations)&&t.frequencyType!==void 0&&t.craftComplexity!==void 0,[]),Z=n.useMemo(()=>D.filter(t=>{var p;const a=O?(((p=t.name)==null?void 0:p.toLowerCase())||"").includes(O.toLowerCase()):!0,s=A?(t.selectedCategories||[]).includes(A):!0;return a&&s}),[D,O,A]),r=n.useMemo(()=>{const t=(k-1)*y;return Z.slice(t,t+y)},[Z,k]),c=n.useMemo(()=>Math.ceil(Z.length/y)||1,[Z.length]),m=n.useMemo(()=>M?[...M.shopItems].sort((t,a)=>{let s=0;switch($){case"name":s=t.id.localeCompare(a.id);break;case"count":s=t.count-a.count;break;case"buyPrice":s=t.buyCost.from-a.buyCost.from;break;case"sellPrice":s=t.sellCost.from-a.sellCost.from;break;case"chance":s=t.appearanceChance-a.appearanceChance;break;default:s=0}return F==="asc"?s:-s}):[],[M,$,F]),_=n.useMemo(()=>{const t=(I-1)*R;return m.slice(t,t+R)},[m,I]),S=n.useMemo(()=>Math.ceil(m.length/R)||1,[m.length]),W=n.useCallback(t=>{X(a=>a===t?a:Math.min(Math.max(1,t),c))},[c]),P=n.useCallback(t=>{b(a=>a===t?a:Math.min(Math.max(1,t),S))},[S]),ce=n.useRef(new Set);n.useEffect(()=>{M?ce.current=new Set(M.shopItems.map(t=>t.id)):ce.current.clear()},[M]);const ie=n.useCallback(t=>ce.current.has(t),[]),ge=n.useCallback(t=>{var Q,ne;const a=D.find(q=>q.name===t);if(!a)return;let s=10,p=15,E=7;if(a.source==="balance"&&ee(a)){s=x(a);const q=((Q=g.currentConfig)==null?void 0:Q.sellDiscount)||.35,ye=((ne=g.currentConfig)==null?void 0:ne.buyMarkup)||.25;E=Math.round(s*(1-q)),p=Math.round(s*(1+ye)),console.log(`Item: ${t}, Base Price: ${s}, Buy: ${p}, Sell: ${E}`)}H(q=>({...q,shopItemId:t,id:t,buyCost:{costType:0,from:p,to:p},sellCost:{costType:0,from:E,to:E}}))},[D,x,ee,g]),ue=n.useCallback(()=>{if(!C.id){i("Выберите предмет","error");return}if(ie(C.id)){i("Этот предмет уже добавлен в магазин","warning");return}G(o,{...C,shopItemId:C.id}),i("Товар успешно добавлен в магазин","success"),H(t=>({...t,id:"",shopItemId:""}))},[C,ie,G,o,i]),pe=n.useCallback(t=>{window.confirm("Вы уверены, что хотите удалить этот товар?")&&(f(o,t),i("Товар удален из магазина","success"))},[f,o,i]),te=n.useCallback(t=>{L(a=>a===t?(ae(s=>s==="asc"?"desc":"asc"),a):(ae("asc"),t))},[]);return n.useEffect(()=>()=>{w.current&&(clearTimeout(w.current),w.current=null)},[]),n.useEffect(()=>{d.current||(re.clear(),re.add(o),d.current=!0);const t=setTimeout(()=>{U.current=!1,J(!0)},250);return()=>{clearTimeout(t)}},[o,T]),n.useEffect(()=>()=>{re.delete(o),w.current=setTimeout(()=>{const t=document.getElementById(`shop-editor-${o}`);(!t||!document.body.contains(t))&&re.delete(o)},200)},[o]),z?M?e.jsxs("div",{id:`shop-editor-${o}`,className:"p-4 text-gray-800 dark:text-gray-200 max-w-[1200px] w-full mx-auto",children:[e.jsxs("div",{className:"bg-green-100 dark:bg-green-900/20 p-4 rounded-md mb-4 text-center",children:[e.jsx("h3",{className:"text-green-800 dark:text-green-300 font-medium text-lg mb-1",children:"Магазин успешно загружен!"}),e.jsxs("p",{className:"text-green-700 dark:text-green-400",children:["Магазин: ",M.name," (ID: ",M.shopId,")"]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"bg-gray-800 rounded-lg shadow-md overflow-hidden",children:[e.jsx("div",{className:"bg-gray-700 px-4 py-3",children:e.jsx("h3",{className:"text-lg font-medium text-white",children:"Добавление товара"})}),e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium mb-1 text-gray-300",children:"Поиск предметов"}),e.jsx("input",{type:"text",placeholder:"Введите название...",value:O,onChange:t=>{Y(t.target.value),X(1)},className:"w-full px-3 py-2 border border-gray-600 rounded-md bg-gray-700 text-white placeholder-gray-400"})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium mb-1 text-gray-300",children:"Категория"}),e.jsxs("select",{value:A,onChange:t=>{V(t.target.value),X(1)},className:"w-full px-3 py-2 border border-gray-600 rounded-md bg-gray-700 text-white",children:[e.jsx("option",{value:"",children:"Все категории"}),le.slice(1).map(t=>e.jsx("option",{value:t,children:t},t))]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-1",children:[e.jsxs("label",{className:"text-sm font-medium text-gray-300",children:["Доступные предметы (",Z.length,")"]}),e.jsxs("span",{className:"text-xs text-gray-400",children:["Страница ",k," из ",c||1]})]}),e.jsx("div",{className:"border border-gray-600 rounded-md bg-gray-700",children:Z.length===0?e.jsx("p",{className:"text-center py-4 text-gray-400",children:"Ничего не найдено"}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"divide-y divide-gray-600",children:[r.map(t=>{var p;const a=ie(t.name),s=t.imageId?se(t.imageId):null;return e.jsx("div",{className:`p-2 cursor-pointer ${C.id===t.name?"bg-blue-900/30":a?"bg-gray-600 opacity-50":"hover:bg-gray-600/50"}`,onClick:()=>!a&&ge(t.name),children:e.jsxs("div",{className:"flex items-center",children:[s?e.jsx("div",{className:"flex-shrink-0 h-8 w-8 mr-2 bg-gray-700 rounded overflow-hidden",children:e.jsx("img",{src:s,alt:t.name,className:"h-full w-full object-cover"})}):e.jsx("div",{className:"flex-shrink-0 h-8 w-8 mr-2 bg-gray-600 rounded flex items-center justify-center text-xs text-gray-400",children:"Нет"}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("div",{className:"font-medium text-white truncate",children:t.name}),e.jsx("div",{className:"text-xs text-gray-400 truncate",children:t.category||((p=t.selectedCategories)==null?void 0:p.join(", "))||"Без категории"})]}),a&&e.jsx("span",{className:"text-xs px-2 py-1 bg-gray-500 text-gray-300 rounded ml-2 whitespace-nowrap",children:"В магазине"})]})},t.name)}),r.length<y&&Array.from({length:y-r.length}).map((t,a)=>e.jsx("div",{className:"p-2 bg-gray-700 opacity-50",style:{height:"52px"},children:e.jsx("div",{className:"flex items-center h-full",children:e.jsx("div",{className:"text-gray-600 dark:text-gray-500 text-center w-full"})})},`empty-${a}`))]}),e.jsxs("div",{className:"bg-gray-800 p-2 border-t border-gray-600 flex justify-between items-center",children:[e.jsx("button",{onClick:()=>W(k-1),disabled:k<=1,className:`px-2 py-1 rounded ${k<=1?"bg-gray-700 text-gray-500 cursor-not-allowed":"bg-gray-700 text-white hover:bg-gray-600"}`,children:"← Назад"}),e.jsx("div",{className:"text-sm text-gray-400 flex items-center",children:Array.from({length:Math.min(5,c)},(t,a)=>{let s;return c<=5||k<=3?s=a+1:k>=c-2?s=c-4+a:s=k-2+a,s<1||s>c?null:e.jsx("button",{onClick:()=>W(s),className:`mx-1 w-7 h-7 rounded ${k===s?"bg-blue-600 text-white":"bg-gray-700 text-gray-300 hover:bg-gray-600"}`,children:s},s)})}),e.jsx("button",{onClick:()=>W(k+1),disabled:k>=c,className:`px-2 py-1 rounded ${k>=c?"bg-gray-700 text-gray-500 cursor-not-allowed":"bg-gray-700 text-white hover:bg-gray-600"}`,children:"Вперед →"})]})]})})]}),C.id&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"block text-sm font-medium mb-1 text-gray-300",children:"Количество"}),e.jsx("input",{type:"number",min:"1",value:C.count,onChange:t=>H(a=>({...a,count:parseInt(t.target.value)||1})),className:"w-full px-3 py-2 border border-gray-600 rounded-md bg-gray-700 text-white"})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"block text-sm font-medium mb-1 text-gray-300",children:"Шанс появления"}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"range",min:"0",max:"100",value:C.appearanceChance*100,onChange:t=>H(a=>({...a,appearanceChance:parseInt(t.target.value)/100})),className:"flex-1 mr-3"}),e.jsxs("div",{className:"w-16 text-center text-white font-bold",children:[Math.round(C.appearanceChance*100),"%"]})]})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"block text-sm font-medium mb-1 text-green-400",children:"Цена покупки (сколько платит игрок)"}),e.jsx("input",{type:"number",min:"0",value:C.buyCost.from,onChange:t=>H(a=>({...a,buyCost:{...a.buyCost,from:parseInt(t.target.value)||0,to:parseInt(t.target.value)||0}})),className:"w-full px-3 py-2 border border-gray-600 rounded-md bg-gray-700 text-white"})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"block text-sm font-medium mb-1 text-red-400",children:"Цена продажи (сколько получает игрок)"}),e.jsx("input",{type:"number",min:"0",value:C.sellCost.from,onChange:t=>H(a=>({...a,sellCost:{...a.sellCost,from:parseInt(t.target.value)||0,to:parseInt(t.target.value)||0}})),className:"w-full px-3 py-2 border border-gray-600 rounded-md bg-gray-700 text-white"})]}),(()=>{var a,s;const t=D.find(p=>p.name===C.id);if(t&&t.source==="balance"&&ee(t)){const p=x(t),E=((a=g.currentConfig)==null?void 0:a.sellDiscount)||.35,Q=((s=g.currentConfig)==null?void 0:s.buyMarkup)||.25,ne=Math.round(p*(1-E)),q=Math.round(p*(1+Q));return e.jsxs("div",{className:"mt-4 p-3 bg-gray-700 rounded-md text-sm",children:[e.jsx("h4",{className:"text-gray-300 font-medium mb-2",children:"Цены в системе баланса:"}),e.jsxs("div",{className:"flex justify-between mb-1",children:[e.jsx("span",{className:"text-gray-400",children:"Базовая стоимость:"}),e.jsx("span",{className:"text-white font-medium",children:p})]}),e.jsxs("div",{className:"flex justify-between mb-1",children:[e.jsx("span",{className:"text-gray-400",children:"Цена покупки:"}),e.jsx("span",{className:"text-green-400 font-medium",children:q})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-400",children:"Цена продажи:"}),e.jsx("span",{className:"text-red-400 font-medium",children:ne})]})]})}return null})()]}),e.jsx("div",{className:"mt-4",children:e.jsx("button",{onClick:ue,disabled:!C.id,className:`w-full px-4 py-2 rounded ${C.id?"bg-blue-600 hover:bg-blue-700 text-white":"bg-gray-600 text-gray-400 cursor-not-allowed"}`,children:"Добавить в магазин"})})]})]}),e.jsxs("div",{className:"bg-gray-800 rounded-lg shadow-md flex flex-col",children:[e.jsxs("div",{className:"bg-gray-700 px-4 py-3 flex justify-between items-center",children:[e.jsxs("h3",{className:"text-lg font-medium text-white",children:["Товары в магазине (",M.shopItems.length,")"]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{onClick:()=>v(M.shopItems.map(t=>t.id)),className:"px-2 py-1 text-xs bg-blue-900/40 text-blue-300 rounded hover:bg-blue-900/60",children:"Выбрать все"}),e.jsx("button",{onClick:()=>v([]),className:"px-2 py-1 text-xs bg-gray-700 text-gray-300 rounded hover:bg-gray-600",disabled:l.length===0,children:"Отменить выбор"})]})]}),M.shopItems.length===0?e.jsxs("div",{className:"p-8 text-center text-gray-400 border border-dashed border-gray-600 rounded-lg m-4 flex-grow",children:[e.jsx("p",{className:"mb-2",children:"В магазине пока нет товаров"}),e.jsx("p",{className:"text-sm",children:"Выберите товар из списка слева и добавьте его в магазин"})]}):e.jsxs("div",{className:"p-1",children:[e.jsxs("table",{className:"min-w-full border-collapse",children:[e.jsx("thead",{className:"bg-gray-700",children:e.jsxs("tr",{children:[e.jsx("th",{className:"w-6 p-2 text-left",children:e.jsx("span",{className:"sr-only",children:"Выбор"})}),e.jsx("th",{className:"p-2 text-left text-xs font-medium text-gray-300 uppercase tracking-wider cursor-pointer hover:bg-gray-650",onClick:()=>te("name"),children:e.jsxs("div",{className:"flex items-center",children:["Товар",$==="name"&&e.jsx("span",{className:"ml-1",children:F==="asc"?"↑":"↓"})]})}),e.jsx("th",{className:"p-2 text-left text-xs font-medium text-gray-300 uppercase tracking-wider cursor-pointer hover:bg-gray-650",style:{width:"60px"},onClick:()=>te("count"),children:e.jsxs("div",{className:"flex items-center",children:["Кол",$==="count"&&e.jsx("span",{className:"ml-1",children:F==="asc"?"↑":"↓"})]})}),e.jsx("th",{className:"p-2 text-left text-xs font-medium text-green-400 uppercase tracking-wider cursor-pointer hover:bg-gray-650",style:{width:"75px"},onClick:()=>te("buyPrice"),children:e.jsxs("div",{className:"flex items-center",children:["Покупка",$==="buyPrice"&&e.jsx("span",{className:"ml-1",children:F==="asc"?"↑":"↓"})]})}),e.jsx("th",{className:"p-2 text-left text-xs font-medium text-red-400 uppercase tracking-wider cursor-pointer hover:bg-gray-650",style:{width:"75px"},onClick:()=>te("sellPrice"),children:e.jsxs("div",{className:"flex items-center",children:["Продажа",$==="sellPrice"&&e.jsx("span",{className:"ml-1",children:F==="asc"?"↑":"↓"})]})}),e.jsx("th",{className:"p-2 text-left text-xs font-medium text-gray-300 uppercase tracking-wider cursor-pointer hover:bg-gray-650",style:{width:"75px"},onClick:()=>te("chance"),children:e.jsxs("div",{className:"flex items-center",children:["Шанс",$==="chance"&&e.jsx("span",{className:"ml-1",children:F==="asc"?"↑":"↓"})]})}),e.jsx("th",{className:"p-2 text-right text-xs font-medium text-gray-300 uppercase tracking-wider",style:{width:"70px"},children:"Опции"})]})}),e.jsxs("tbody",{className:"bg-gray-800 divide-y divide-gray-700",children:[_.map((t,a)=>{const s=D.find(E=>E.name===t.id),p=s!=null&&s.imageId?se(s.imageId):null;return e.jsxs("tr",{className:`${l.includes(t.id)?"bg-blue-900/20":"hover:bg-gray-750"}`,children:[e.jsx("td",{className:"px-2 py-1 whitespace-nowrap align-middle",children:e.jsx("input",{type:"checkbox",checked:l.includes(t.id),onChange:()=>{v(E=>E.includes(t.id)?E.filter(Q=>Q!==t.id):[...E,t.id])},className:"h-4 w-4 text-blue-600 bg-gray-700 rounded border-gray-600"})}),e.jsx("td",{className:"py-1 px-2",children:e.jsxs("div",{className:"flex items-center",children:[p?e.jsx("div",{className:"flex-shrink-0 h-6 w-6 mr-2 bg-gray-700 rounded overflow-hidden",children:e.jsx("img",{src:p,alt:t.id,className:"h-full w-full object-cover"})}):e.jsx("div",{className:"flex-shrink-0 h-6 w-6 mr-2 bg-gray-700 rounded flex items-center justify-center text-xs text-gray-400",children:"-"}),e.jsx("div",{className:"text-sm font-medium text-gray-200 truncate max-w-[150px]",children:t.id})]})}),e.jsxs("td",{className:"px-2 py-1 whitespace-nowrap text-sm text-gray-300",children:[t.count," шт."]}),e.jsx("td",{className:"px-2 py-1 whitespace-nowrap text-sm text-green-400 font-medium",children:t.buyCost.from}),e.jsx("td",{className:"px-2 py-1 whitespace-nowrap text-sm text-red-400 font-medium",children:t.sellCost.from}),e.jsx("td",{className:"px-2 py-1 whitespace-nowrap",children:e.jsxs("div",{className:"text-sm text-gray-300",children:[(t.appearanceChance*100).toFixed(0),"%"]})}),e.jsx("td",{className:"px-2 py-1 whitespace-nowrap text-right",children:e.jsx("button",{onClick:()=>pe(t.id),className:"text-red-400 hover:text-red-300 text-sm",children:"Удалить"})})]},`${t.id}-${a}`)}),_.length<R&&Array.from({length:R-_.length}).map((t,a)=>e.jsx("tr",{className:"bg-gray-800 h-[42px]",children:e.jsx("td",{colSpan:7})},`empty-row-${a}`))]})]}),e.jsxs("div",{className:"flex justify-between items-center mt-2 p-2 text-sm",children:[e.jsxs("div",{className:"text-gray-400",children:["Показаны ",m.length>0?(I-1)*R+1:0,"-",Math.min(I*R,m.length)," из ",m.length]}),S>1&&e.jsxs("div",{className:"flex space-x-1",children:[e.jsx("button",{onClick:()=>P(I-1),disabled:I<=1,className:`px-2 py-1 rounded text-xs ${I<=1?"bg-gray-700 text-gray-500 cursor-not-allowed":"bg-gray-700 text-white hover:bg-gray-600"}`,children:"←"}),Array.from({length:Math.min(5,S)},(t,a)=>{let s;return S<=5||I<=3?s=a+1:I>=S-2?s=S-4+a:s=I-2+a,s<1||s>S?null:e.jsx("button",{onClick:()=>P(s),className:`w-6 h-6 rounded text-xs ${I===s?"bg-blue-600 text-white":"bg-gray-700 text-gray-300 hover:bg-gray-600"}`,children:s},s)}),e.jsx("button",{onClick:()=>P(I+1),disabled:I>=S,className:`px-2 py-1 rounded text-xs ${I>=S?"bg-gray-700 text-gray-500 cursor-not-allowed":"bg-gray-700 text-white hover:bg-gray-600"}`,children:"→"})]})]})]})]})]}),e.jsx("div",{className:"flex justify-end mt-4",children:e.jsx("button",{onClick:h,className:"px-6 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 text-lg",children:"Закрыть"})})]}):e.jsxs("div",{id:`shop-editor-${o}`,className:"p-6 text-center",children:[e.jsxs("div",{className:"mb-4 text-red-500 text-xl font-medium",children:["Магазин с ID ",o," не найден"]}),e.jsx("p",{className:"mb-4",children:"Доступные магазины:"}),e.jsx("ul",{className:"mb-4 list-disc list-inside text-left bg-gray-100 dark:bg-gray-700 p-4 rounded-md",children:T==null?void 0:T.map(t=>e.jsxs("li",{className:"mb-1",children:[e.jsx("span",{className:"font-medium",children:t.name})," (ID: ",t.shopId,")"]},t.shopId))}),e.jsx("button",{onClick:h,className:"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700",children:"Закрыть"})]}):e.jsxs("div",{id:`shop-editor-${o}`,className:"p-6 text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-blue-500 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-300 text-lg",children:"Загрузка данных магазина..."}),e.jsx("button",{onClick:h,className:"mt-4 px-4 py-2 bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-white rounded hover:bg-gray-300 dark:hover:bg-gray-600",children:"Отменить"})]})}),Se=()=>{var Z;const{traders:o,shops:h,addTrader:T,updateTrader:G,deleteTrader:B,addShop:f,updateShop:N,deleteShop:x}=de(),{addToast:g}=he(),[i,u]=n.useState(!1),[d,j]=n.useState(null),[U,w]=n.useState(!1),[z,J]=n.useState(null),[O,Y]=n.useState(!1),[A,V]=n.useState({isOpen:!1,title:"",message:"",onConfirm:()=>{},type:"info"}),l=n.useRef(null);n.useEffect(()=>{h&&o&&O&&(Y(!1),l.current&&(clearTimeout(l.current),l.current=null))},[h,o,O]),n.useEffect(()=>()=>{l.current&&clearTimeout(l.current)},[]);const[v,y]=n.useState(1),[R,k]=n.useState(1);n.useEffect(()=>{if(h&&h.length>0){const r=Math.max(...h.map(c=>parseInt(c.shopId.replace("Shop_",""),10)||0).filter(c=>!isNaN(c)));y(r+1)}if(o&&o.length>0){const r=Math.max(...o.map(c=>parseInt(c.traderId.replace("Trader_",""),10)||0).filter(c=>!isNaN(c)));k(r+1)}},[h,o]);const X=()=>`Shop_${v}`,I=()=>`Trader_${R}`,[b,$]=n.useState({trader:{traderId:I(),name:"",shopId:X(),traderInventoryUIId:"Trader",buyInventoryUIId:"Buy",sellInventoryUIId:"Sell",fillShopWhenTraderHasCreated:!0,canTrade:!0,canInteractDirectly:!0,description:"",location:""},shop:{shopId:X(),name:"",description:"",shopItems:[],restockTime:1440,isRandomStock:!1}});n.useEffect(()=>{$(r=>({...r,trader:{...r.trader,shopId:r.shop.shopId}}))},[b.shop.shopId]);const L=(r,c,m)=>{var _,S;if(i&&d){if(j({...d,[r]:{...d[r],[c]:m}}),c==="name"&&((_=document.getElementById("sync-names"))!=null&&_.checked)){const W=r==="trader"?"shop":"trader";j(P=>P&&{...P,[W]:{...P[W],name:m}})}}else if($({...b,[r]:{...b[r],[c]:m}}),c==="name"&&((S=document.getElementById("sync-names"))!=null&&S.checked)){const W=r==="trader"?"shop":"trader";$(P=>({...P,[W]:{...P[W],name:m}}))}},F=()=>{if(i&&d)G(d.trader.traderId,d.trader),N(d.shop.shopId,d.shop),u(!1),j(null),g("Торговая точка успешно обновлена","success");else{if(!b.trader.name||!b.shop.name){g("Заполните обязательные поля: Имя торговца и Название магазина","error");return}const r=X(),c=I(),m={...b.shop,shopId:r},_={...b.trader,traderId:c,shopId:r};f(m),T(_),y(S=>S+1),k(S=>S+1),$({trader:{traderId:`Trader_${R+1}`,name:"",shopId:`Shop_${v+1}`,traderInventoryUIId:"Trader",buyInventoryUIId:"Buy",sellInventoryUIId:"Sell",fillShopWhenTraderHasCreated:!0,canTrade:!0,canInteractDirectly:!0,description:"",location:""},shop:{shopId:`Shop_${v+1}`,name:"",description:"",shopItems:[],restockTime:1440,isRandomStock:!1}}),g("Торговая точка успешно создана","success")}},ae=()=>{u(!1),j(null)},M=r=>{const c=o.find(_=>_.traderId===r);if(!c){g("Торговец не найден","error");return}const m=h.find(_=>_.shopId===c.shopId);if(!m){g("Магазин торговца не найден","error");return}j({trader:c,shop:m}),u(!0)},K=r=>{const c=o.find(m=>m.traderId===r);c&&V({isOpen:!0,title:"Подтверждение удаления",message:`Вы уверены, что хотите удалить торговую точку "${c.name}"?`,onConfirm:()=>{B(r),x(c.shopId),V(m=>({...m,isOpen:!1})),g("Торговая точка удалена","success")},type:"danger"})},C=r=>{console.log("Opening shop editor with ID:",r);const c=h==null?void 0:h.find(m=>m.shopId===r);if(!c){g(`Магазин с ID ${r} не найден`,"error"),console.log("Shop not found:",r,"Available shops:",h==null?void 0:h.map(m=>m.shopId));return}if(typeof window<"u"&&window.initializedShopIds&&window.initializedShopIds.clear(),U){w(!1),J(null),setTimeout(()=>{console.log("Opening shop editor after previous close:",c.name),J(r),w(!0)},100);return}console.log("Shop found, opening editor:",c),J(r),w(!0)},H=()=>{console.log("Closing shop item editor"),w(!1),setTimeout(()=>{J(null)},100)},se=r=>{const c=h.find(m=>m.shopId===r);return c?c.shopItems.length:0},le=o.map(r=>{const c=h.find(m=>m.shopId===r.shopId)||{shopId:r.shopId,name:"Магазин не найден",description:"",shopItems:[],restockTime:1440,isRandomStock:!1};return{trader:r,shop:c}}),[D,ee]=n.useState({isVisible:!1,message:"",type:"info",timeout:null});return n.useEffect(()=>()=>{D.timeout&&clearTimeout(D.timeout)},[D.timeout]),e.jsxs("div",{className:"space-y-8 relative",children:[A.isOpen&&e.jsx("div",{className:"fixed inset-0 z-50 overflow-y-auto bg-black bg-opacity-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-6 max-w-md w-full shadow-lg",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-3",children:A.title}),e.jsx("p",{className:"text-gray-500 dark:text-gray-300 mb-6",children:A.message}),e.jsxs("div",{className:"flex justify-end space-x-3",children:[e.jsx("button",{onClick:()=>V(r=>({...r,isOpen:!1})),className:"px-4 py-2 bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-white rounded hover:bg-gray-300 dark:hover:bg-gray-600",children:"Отмена"}),e.jsx("button",{onClick:A.onConfirm,className:"px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700",children:"Удалить"})]})]})}),D.isVisible&&e.jsx("div",{className:`fixed bottom-4 right-4 z-50 p-4 rounded-md shadow-lg text-white 
          ${D.type==="success"?"bg-green-500":D.type==="error"?"bg-red-500":D.type==="warning"?"bg-yellow-500":"bg-blue-500"}`,children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex-1 mr-3",children:e.jsx("p",{children:D.message})}),e.jsx("button",{onClick:()=>ee(r=>({...r,isVisible:!1})),className:"text-white hover:text-gray-200",children:e.jsx("svg",{className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})}),O&&e.jsx("div",{className:"fixed inset-0 z-40 bg-black bg-opacity-30 flex items-center justify-center",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-6 flex flex-col items-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-blue-500 mb-4"}),e.jsx("p",{className:"text-gray-700 dark:text-gray-300 text-center",children:"Загрузка данных..."}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-2",children:"Это может занять несколько секунд"}),e.jsxs("div",{className:"flex space-x-3 mt-4",children:[e.jsx("button",{onClick:()=>{Y(!1),l.current&&(clearTimeout(l.current),l.current=null)},className:"px-4 py-2 text-sm bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-white rounded hover:bg-gray-300 dark:hover:bg-gray-600",children:"Отменить"}),e.jsx("button",{onClick:()=>{z?(Y(!1),w(!0)):Y(!1),l.current&&(clearTimeout(l.current),l.current=null)},className:"px-4 py-2 text-sm bg-blue-600 text-white rounded hover:bg-blue-700",children:"Продолжить без ожидания"})]})]})}),U&&z&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black bg-opacity-50",children:e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-xl max-w-7xl w-full max-h-[90vh] overflow-y-auto",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs("h2",{className:"text-xl font-semibold text-gray-800 dark:text-white",children:["Товары в магазине: ",((Z=h==null?void 0:h.find(r=>r.shopId===z))==null?void 0:Z.name)||z]}),e.jsx("button",{onClick:H,className:"text-gray-400 hover:text-gray-500",children:e.jsx("svg",{className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsx(Ce,{shopId:z,onClose:H},`shop-editor-${z}-${Date.now()}`)]})})}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 p-6 rounded-lg shadow-md",children:[e.jsx("h2",{className:"text-xl font-semibold mb-4 text-gray-800 dark:text-white",children:i?"Редактирование торговой точки":"Создание новой торговой точки"}),e.jsx("div",{className:"mb-4",children:e.jsxs("label",{className:"flex items-center text-sm",children:[e.jsx("input",{type:"checkbox",id:"sync-names",defaultChecked:!0,className:"h-4 w-4 text-blue-600 rounded mr-2"}),"Синхронизировать имя торговца и название магазина"]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-800 dark:text-white border-b pb-2",children:"Информация о торговце"}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1 text-gray-700 dark:text-gray-300",children:"ID торговца"}),e.jsx("input",{type:"text",value:i?(d==null?void 0:d.trader.traderId)||"":b.trader.traderId,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-gray-100 dark:bg-gray-700 text-gray-900 dark:text-gray-300",readOnly:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1 text-gray-700 dark:text-gray-300",children:"Имя торговца*"}),e.jsx("input",{type:"text",value:i?(d==null?void 0:d.trader.name)||"":b.trader.name,onChange:r=>L("trader","name",r.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white",placeholder:"например: Кузнец Михаил"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1 text-gray-700 dark:text-gray-300",children:"Местоположение"}),e.jsx("input",{type:"text",value:i?(d==null?void 0:d.trader.location)||"":b.trader.location,onChange:r=>L("trader","location",r.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white",placeholder:"например: Главная площадь"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1 text-gray-700 dark:text-gray-300",children:"Описание торговца"}),e.jsx("textarea",{value:i?(d==null?void 0:d.trader.description)||"":b.trader.description,onChange:r=>L("trader","description",r.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white",rows:2})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",checked:i?(d==null?void 0:d.trader.canTrade)||!1:b.trader.canTrade,onChange:r=>L("trader","canTrade",r.target.checked),className:"h-4 w-4 text-blue-600 rounded"}),e.jsx("span",{className:"ml-2 text-gray-700 dark:text-gray-300",children:"Может торговать"})]}),e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",checked:i?(d==null?void 0:d.trader.canInteractDirectly)||!1:b.trader.canInteractDirectly,onChange:r=>L("trader","canInteractDirectly",r.target.checked),className:"h-4 w-4 text-blue-600 rounded"}),e.jsx("span",{className:"ml-2 text-gray-700 dark:text-gray-300",children:"Прямое взаимодействие"})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-800 dark:text-white border-b pb-2",children:"Информация о магазине"}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1 text-gray-700 dark:text-gray-300",children:"ID магазина"}),e.jsx("input",{type:"text",value:i?(d==null?void 0:d.shop.shopId)||"":b.shop.shopId,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-gray-100 dark:bg-gray-700 text-gray-900 dark:text-gray-300",readOnly:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1 text-gray-700 dark:text-gray-300",children:"Название магазина*"}),e.jsx("input",{type:"text",value:i?(d==null?void 0:d.shop.name)||"":b.shop.name,onChange:r=>L("shop","name",r.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white",placeholder:"например: Кузница Михаила"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1 text-gray-700 dark:text-gray-300",children:"Описание магазина"}),e.jsx("textarea",{value:i?(d==null?void 0:d.shop.description)||"":b.shop.description,onChange:r=>L("shop","description",r.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white",rows:2})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1 text-gray-700 dark:text-gray-300",children:"Время пополнения (минуты)"}),e.jsx("input",{type:"number",min:"0",value:i?(d==null?void 0:d.shop.restockTime)||1440:b.shop.restockTime,onChange:r=>L("shop","restockTime",parseInt(r.target.value)||0),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white"}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:"Время, через которое обновляется ассортимент (1440 = 24 часа)"})]}),e.jsx("div",{children:e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",checked:i?(d==null?void 0:d.shop.isRandomStock)||!1:b.shop.isRandomStock,onChange:r=>L("shop","isRandomStock",r.target.checked),className:"h-4 w-4 text-blue-600 rounded"}),e.jsx("span",{className:"ml-2 text-gray-700 dark:text-gray-300",children:"Случайный ассортимент при пополнении"})]})})]})]}),e.jsxs("div",{className:"flex justify-end space-x-2",children:[i&&e.jsx("button",{onClick:ae,className:"px-4 py-2 bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-white rounded-md hover:bg-gray-300 dark:hover:bg-gray-600 transition-colors",children:"Отмена"}),e.jsx("button",{onClick:F,className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors",children:i?"Сохранить изменения":"Создать торговую точку"})]})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 p-6 rounded-lg shadow-md",children:[e.jsx("h2",{className:"text-xl font-semibold mb-4 text-gray-800 dark:text-white",children:"Список торговых точек"}),le.length===0?e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Нет созданных торговых точек"}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200 dark:divide-gray-700",children:[e.jsx("thead",{className:"bg-gray-50 dark:bg-gray-700",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Имя торговца"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Название магазина"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Местоположение"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Товары"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Статус"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Действия"})]})}),e.jsx("tbody",{className:"bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700",children:le.map(({trader:r,shop:c})=>e.jsxs("tr",{className:"hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors",children:[e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-gray-100",children:[r.name,e.jsxs("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:["ID: ",r.traderId]})]}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-gray-100",children:[c.name,e.jsxs("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:["ID: ",c.shopId]})]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-gray-100",children:r.location||"-"}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center",children:[e.jsxs("span",{className:"px-2 py-1 text-xs bg-blue-100 dark:bg-blue-900/30 text-blue-800 dark:text-blue-300 rounded-full mr-2",children:[se(c.shopId)," товаров"]}),e.jsx("button",{onClick:()=>C(c.shopId),className:"text-xs text-blue-600 dark:text-blue-400 hover:underline",children:"Управление товарами"})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:r.canTrade?e.jsx("span",{className:"px-2 py-1 text-xs bg-green-100 dark:bg-green-900/30 text-green-800 dark:text-green-300 rounded-full",children:"Активен"}):e.jsx("span",{className:"px-2 py-1 text-xs bg-red-100 dark:bg-red-900/30 text-red-800 dark:text-red-300 rounded-full",children:"Неактивен"})}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:[e.jsx("button",{onClick:()=>M(r.traderId),className:"text-indigo-600 dark:text-indigo-400 hover:text-indigo-900 mr-3",children:"Изменить"}),e.jsx("button",{onClick:()=>K(r.traderId),className:"text-red-600 dark:text-red-400 hover:text-red-900",children:"Удалить"})]})]},r.traderId))})]})})]})]})},Te=()=>{const[o,h]=n.useState(0),{exportShopData:T,importShopData:G}=de(),B=()=>{const N=T(),x=JSON.stringify(N,null,2),g=new Blob([x],{type:"application/json"}),i=URL.createObjectURL(g),u=document.createElement("a");u.href=i,u.download=`shop_data_${new Date().toISOString().split("T")[0]}.json`,document.body.appendChild(u),u.click(),setTimeout(()=>{document.body.removeChild(u),URL.revokeObjectURL(i)},0)},f=()=>{const N=document.createElement("input");N.type="file",N.accept=".json",N.onchange=x=>{const g=x.target;if(!g.files||g.files.length===0)return;const i=g.files[0],u=new FileReader;u.onload=d=>{var j;try{const U=(j=d.target)==null?void 0:j.result,w=JSON.parse(U);if(!w.currencies||!w.traders||!w.shops)throw new Error("Некорректный формат данных");G(w),alert("Данные успешно импортированы")}catch(U){alert(`Ошибка при импорте: ${U}`)}},u.readAsText(i)},N.click()};return e.jsxs("div",{className:"container mx-auto py-6 px-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-800 dark:text-white",children:"Shop Builder"}),e.jsx(fe,{to:"/",className:"text-sm text-blue-600 dark:text-blue-400 hover:underline",children:"← Вернуться на главную"})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{onClick:B,className:"px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700 transition-colors",children:"Экспорт"}),e.jsx("button",{onClick:f,className:"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 transition-colors",children:"Импорт"})]})]}),e.jsxs("div",{className:"flex border-b border-gray-300 dark:border-gray-700 mb-6",children:[e.jsx("button",{className:`px-4 py-2 ${o===0?"border-b-2 border-blue-600 text-blue-600 dark:border-blue-400 dark:text-blue-400 font-medium":"text-gray-600 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white"}`,onClick:()=>h(0),children:"Валюты"}),e.jsx("button",{className:`px-4 py-2 ${o===1?"border-b-2 border-blue-600 text-blue-600 dark:border-blue-400 dark:text-blue-400 font-medium":"text-gray-600 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white"}`,onClick:()=>h(1),children:"Торговые точки"})]}),e.jsxs("div",{className:"mt-4",children:[o===0&&e.jsx(Ie,{}),o===1&&e.jsx(Se,{})]})]})},$e=()=>e.jsx(Ne,{children:e.jsx(we,{children:e.jsx(Te,{})})});export{$e as S};
