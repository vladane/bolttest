import{r as u,j as e,u as nt,R as lt,a as $e,b as it,c as ot,B as dt}from"./vendor-react-B5bTltmH.js";import{u as xe,a as je,B as ct,N as mt,A as gt}from"./app-contexts-DyyK1F6R.js";import{I as Fe,E as Ne,S as ze,a as xt,b as ut}from"./ui-components-C6zsR5sV.js";import{g as Ee,a as ht,c as pt,b as Ke,f as we,d as Qe,e as yt,i as Ve}from"./utils-CqSnstQE.js";import{S as bt}from"./shop-components-COZEnFB7.js";import"./index-B0NGiynd.js";import"./vendor-other-CPcG8nbB.js";import"./vendor-styles-B6Xg8d0z.js";import"./vendor-routing-CleNNFrk.js";(function(){const R=document.createElement("link").relList;if(R&&R.supports&&R.supports("modulepreload"))return;for(const w of document.querySelectorAll('link[rel="modulepreload"]'))h(w);new MutationObserver(w=>{for(const a of w)if(a.type==="childList")for(const k of a.addedNodes)k.tagName==="LINK"&&k.rel==="modulepreload"&&h(k)}).observe(document,{childList:!0,subtree:!0});function i(w){const a={};return w.integrity&&(a.integrity=w.integrity),w.referrerPolicy&&(a.referrerPolicy=w.referrerPolicy),w.crossOrigin==="use-credentials"?a.credentials="include":w.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function h(w){if(w.ep)return;w.ep=!0;const a=i(w);fetch(w.href,a)}})();var nr=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function lr(o){return o&&o.__esModule&&Object.prototype.hasOwnProperty.call(o,"default")?o.default:o}function ir(o){throw new Error('Could not dynamically require "'+o+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}const ft=o=>{switch(o==null?void 0:o.toLowerCase()){case"common":return"text-gray-400 dark:text-gray-300";case"uncommon":return"text-green-500 dark:text-green-400";case"rare":return"text-blue-500 dark:text-blue-400";case"exotic":return"text-purple-500 dark:text-purple-400";case"epic":return"text-pink-500 dark:text-pink-400";case"mythical":return"text-yellow-600 dark:text-yellow-500";case"legendary":return"text-amber-500 dark:text-amber-400";case"relic":return"text-red-600 dark:text-red-500";case"immortal":return"text-cyan-500 dark:text-cyan-400";case"ancient":return"text-teal-600 dark:text-teal-500";default:return"text-gray-500 dark:text-gray-400"}};function jt(){const{state:o,updateState:R}=xe(),[i,h]=u.useState({name:"",rarity:"common",element:"",health:"",physDefense:"",magicDefense:"",speed:"",imageId:null,abilities:[],gearRequirements:{}}),[w,a]=u.useState(-1),[k,x]=u.useState(""),[f,S]=u.useState(null),[L,C]=u.useState(null),[M,N]=u.useState(!1),[I,A]=u.useState(-1),[P,U]=u.useState("0.00%"),j=p=>{if(p<=0)return"0.00%";const v=p/100,T=(v*v-.1)/5*100;return Math.max(0,T).toFixed(2)+"%"};u.useEffect(()=>{const p=parseFloat(i.speed)||0;U(j(p))},[i.speed]);const O=p=>{const{name:v,value:T}=p.target;h(b=>({...b,[v]:T})),f&&S(null)},Z=p=>{h(v=>({...v,imageId:p}))},n=()=>{if(w!==-1){if(i.abilities.includes(w)){S("This ability is already added");return}h(p=>({...p,abilities:[...p.abilities,w]})),a(-1)}},t=p=>{h(v=>({...v,abilities:v.abilities.filter((T,b)=>b!==p)}))},s=()=>{if(!i.name.trim())return S("Please enter a unit name"),!1;if(!i.element)return S("Please select an element"),!1;const p=parseInt(i.health);if(isNaN(p)||p<=0)return S("Health must be greater than 0"),!1;const v=parseFloat(i.speed);return isNaN(v)||v<=0?(S("Speed must be greater than 0"),!1):v>100?(S("Speed cannot be greater than 100"),!1):!0},d=p=>{if(p.preventDefault(),!s())return;const v={name:i.name.trim(),rarity:i.rarity,element:i.element,stats:{health:parseInt(i.health)||0,physDefense:parseInt(i.physDefense)||0,magicDefense:parseInt(i.magicDefense)||0,speed:parseFloat(i.speed)||0},imageId:i.imageId,abilities:i.abilities,gearRequirements:i.gearRequirements,equipment:{}};if(M&&I>=0){const T=[...o.units.units];T[I]=v,R("units.units",T),C("Unit updated successfully!")}else R("units.units",[...o.units.units,v]),C("Unit created successfully!");r()},r=()=>{h({name:"",rarity:"common",element:"",health:"",physDefense:"",magicDefense:"",speed:"",imageId:null,abilities:[],gearRequirements:{"Gear Common 1":[],"Gear Common 2":[],"Gear Uncommon 1":[],"Gear Uncommon 2":[],"Gear Uncommon 3":[],"Gear Rare 1":[],"Gear Rare 2":[],"Gear Rare 3":[],"Gear Exotic 1":[],"Gear Exotic 2":[],"Gear Exotic 3":[],"Gear Exotic 4":[],"Gear Epic 1":[],"Gear Epic 2":[],"Gear Epic 3":[],"Gear Epic 4":[],"Gear Mythical 1":[],"Gear Mythical 2":[],"Gear Mythical 3":[],"Gear Mythical 4":[],"Gear Mythical 5":[],"Gear Legendary 1":[],"Gear Legendary 2":[],"Gear Legendary 3":[],"Gear Legendary 4":[],"Gear Legendary 5":[],"Gear Relic 1":[],"Gear Relic 2":[],"Gear Relic 3":[],"Gear Relic 4":[],"Gear Immortal 1":[],"Gear Immortal 2":[],"Gear Immortal 3":[],"Gear Ancient 1":[],"Gear Ancient 2":[],"Gear Ancient 3":[]}}),N(!1),A(-1),U("0.00%"),a(-1)},y=p=>{var v;return((v=o.units.abilities[p])==null?void 0:v.name)||"Unknown Ability"};return e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold mb-4",children:M?"Edit Unit":"Create Unit"}),f&&e.jsx("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4",children:f}),L&&e.jsx("div",{className:"bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded mb-4",children:L}),e.jsxs("form",{onSubmit:d,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Name"}),e.jsx("input",{type:"text",name:"name",value:i.name,onChange:O,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-700 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 cursor-text",placeholder:"Enter unit name"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Rarity"}),e.jsx("select",{name:"rarity",value:i.rarity,onChange:O,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-700 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 cursor-pointer",children:o.units.rarities.map(p=>e.jsx("option",{value:p.id,className:`rarity-${p.id}`,children:p.name},p.id))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Element"}),e.jsxs("select",{name:"element",value:i.element,onChange:O,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-700 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 cursor-pointer",children:[e.jsx("option",{value:"",children:"Select element"}),e.jsx("option",{value:"fire",children:"Fire"}),e.jsx("option",{value:"water",children:"Water"}),e.jsx("option",{value:"earth",children:"Earth"}),e.jsx("option",{value:"air",children:"Air"}),e.jsx("option",{value:"electricity",children:"Electricity"}),e.jsx("option",{value:"chaos",children:"Chaos"}),e.jsx("option",{value:"order",children:"Order"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Health"}),e.jsx("input",{type:"number",name:"health",value:i.health,onChange:O,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-700 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 cursor-text",placeholder:"Health points"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Speed"}),e.jsx("input",{type:"number",name:"speed",value:i.speed,onChange:O,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-700 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 cursor-text",placeholder:"Speed value",step:"0.1"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Physical Defense"}),e.jsx("input",{type:"number",name:"physDefense",value:i.physDefense,onChange:O,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-700 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 cursor-text",placeholder:"Physical defense"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Magic Defense"}),e.jsx("input",{type:"number",name:"magicDefense",value:i.magicDefense,onChange:O,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-700 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 cursor-text",placeholder:"Magic defense"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Dodge (calculated)"}),e.jsx("input",{type:"text",value:P,readOnly:!0,className:"w-full px-3 py-2 bg-gray-100 dark:bg-gray-800 border border-gray-300 dark:border-gray-700 rounded-md cursor-not-allowed text-gray-700 dark:text-gray-300"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Unit Image"}),e.jsx(Fe,{onImageUpload:Z,currentImageId:i.imageId,size:"lg"})]}),e.jsxs("div",{className:"border border-gray-200 dark:border-gray-700 rounded-md p-4",children:[e.jsx("h3",{className:"text-lg font-medium mb-3",children:"Abilities"}),e.jsxs("div",{className:"flex space-x-2 mb-3",children:[e.jsxs("select",{value:w,onChange:p=>a(parseInt(p.target.value)),className:"flex-1 px-3 py-2 border border-gray-300 dark:border-gray-700 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 cursor-pointer",children:[e.jsx("option",{value:"-1",children:"Select an ability"}),o.units.abilities.map((p,v)=>e.jsx("option",{value:v,children:p.name},v))]}),e.jsx("button",{type:"button",onClick:n,disabled:w===-1,className:"px-4 py-2 bg-primary text-white rounded-md disabled:opacity-50",children:"Add"})]}),i.abilities.length===0?e.jsx("p",{className:"text-gray-500 dark:text-gray-400 text-center py-2",children:"No abilities added yet"}):e.jsx("div",{className:"space-y-2",children:i.abilities.map((p,v)=>e.jsxs("div",{className:"flex justify-between items-center bg-gray-50 dark:bg-gray-800 p-2 rounded",children:[e.jsx("span",{children:y(p)}),e.jsx("button",{type:"button",onClick:()=>t(v),className:"text-red-500 hover:text-red-700",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]},v))})]}),e.jsxs("div",{className:"border border-gray-200 dark:border-gray-700 rounded-md p-4",children:[e.jsx("h3",{className:"text-lg font-medium mb-3",children:"Gear Requirements (Optional)"}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mb-4",children:"Define what items are required for each gear level of this unit."}),e.jsxs("div",{className:"flex items-end gap-2 mb-6",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Select Gear Level:"}),e.jsxs("select",{value:k,onChange:p=>x(p.target.value),className:"w-full px-3 py-2 bg-gray-50 dark:bg-gray-800 border border-gray-300 dark:border-gray-700 rounded-md",children:[e.jsx("option",{value:"",children:"-- Select Gear Level --"}),["Gear Common 1","Gear Common 2","Gear Uncommon 1","Gear Uncommon 2","Gear Uncommon 3","Gear Rare 1","Gear Rare 2","Gear Rare 3","Gear Exotic 1","Gear Exotic 2","Gear Exotic 3","Gear Exotic 4","Gear Epic 1","Gear Epic 2","Gear Epic 3","Gear Epic 4","Gear Mythical 1","Gear Mythical 2","Gear Mythical 3","Gear Mythical 4","Gear Mythical 5","Gear Legendary 1","Gear Legendary 2","Gear Legendary 3","Gear Legendary 4","Gear Legendary 5","Gear Relic 1","Gear Relic 2","Gear Relic 3","Gear Relic 4","Gear Immortal 1","Gear Immortal 2","Gear Immortal 3","Gear Ancient 1","Gear Ancient 2","Gear Ancient 3"].map(p=>e.jsx("option",{value:p,children:p},p))]})]}),e.jsx("button",{type:"button",onClick:()=>{if(k){const p={...i.gearRequirements};p[k]||(p[k]=[]),h(v=>({...v,gearRequirements:p})),x("")}},disabled:!k,className:`px-4 py-2 rounded-md ${k?"bg-primary text-white hover:bg-opacity-90":"bg-gray-400 text-gray-700 cursor-not-allowed"}`,children:"Add Level"})]}),e.jsx("div",{className:"space-y-4",children:Object.keys(i.gearRequirements).length===0?e.jsx("div",{className:"p-6 text-center bg-gray-50 dark:bg-gray-800 rounded-md text-gray-500 dark:text-gray-400",children:"No gear requirements defined"}):Object.entries(i.gearRequirements).map(([p,v])=>{const T=k===p;return e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800 rounded-md border border-gray-200 dark:border-gray-700 overflow-hidden",children:[e.jsxs("div",{className:"flex justify-between items-center p-3 cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-700",onClick:()=>x(T?"":p),children:[e.jsxs("h4",{className:"font-medium flex items-center",children:[e.jsx("span",{className:`mr-2 transform transition-transform ${T?"rotate-90":""}`,children:"▶"}),p]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:[v.length," item(s)"]}),e.jsx("button",{type:"button",onClick:b=>{b.stopPropagation();const{[p]:D,...J}=i.gearRequirements;h(B=>({...B,gearRequirements:J})),k===p&&x("")},className:"text-red-500 hover:text-red-700 p-1",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})]}),T&&e.jsx("div",{className:"p-4 border-t border-gray-200 dark:border-gray-700",children:o.units.items.length===0?e.jsx("p",{className:"text-center text-gray-500 dark:text-gray-400 py-2",children:"No items available. Create some items first."}):e.jsx("div",{className:"space-y-2",children:e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-2",children:o.units.items.map((b,D)=>{var B;const J=v.includes(D);return e.jsxs("div",{className:"flex items-center p-2 border border-gray-200 dark:border-gray-700 rounded-md hover:bg-gray-100 dark:hover:bg-gray-700",children:[e.jsx("input",{type:"checkbox",id:`${p}-item-${D}`,checked:J,onChange:()=>{const G={...i.gearRequirements};J?G[p]=G[p].filter(K=>K!==D):G[p]=[...G[p],D],h(K=>({...K,gearRequirements:G}))},className:"form-checkbox h-4 w-4 text-primary rounded"}),e.jsxs("div",{className:"flex items-center ml-2 flex-1",children:[e.jsx("div",{className:"h-10 w-10 flex-shrink-0 mr-3 bg-gray-200 dark:bg-gray-600 rounded-md overflow-hidden",children:b.imageId&&o.units.imageMap.get(b.imageId)?e.jsx("img",{src:b.imageId&&((B=o.units.imageMap.get(b.imageId))==null?void 0:B.data),alt:b.name,className:"h-full w-full object-cover"}):e.jsx("div",{className:"flex items-center justify-center h-full w-full",children:e.jsx("svg",{className:"h-6 w-6 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})})})}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:`${p}-item-${D}`,className:"block text-sm font-medium cursor-pointer",children:b.name}),e.jsx("span",{className:`text-xs ${ft(b.rarity)}`,children:b.rarity}),b.slotType&&e.jsxs("span",{className:"text-xs text-gray-500 dark:text-gray-400 ml-2",children:["(",b.slotType,")"]})]})]})]},D)})})})})]},p)})})]}),e.jsxs("div",{className:"flex justify-end space-x-2",children:[M&&e.jsx("button",{type:"button",onClick:()=>{N(!1),A(-1),r()},className:"px-4 py-2 bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200 rounded-md",children:"Cancel"}),e.jsx("button",{type:"button",onClick:r,className:"px-4 py-2 bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200 rounded-md",children:"Clear"}),e.jsxs("button",{type:"submit",className:"px-4 py-2 bg-primary text-white rounded-md",children:[M?"Update":"Create"," Unit"]})]})]})]})}var rt=(o=>(o.WEAPON="weapon",o.ARMOR="armor",o.HELMET="helmet",o.GLOVES="gloves",o.BOOTS="boots",o.ACCESSORY="accessory",o.HEAD="head",o.BODY="body",o.OFF_HAND="offHand",o))(rt||{});function vt({unitIndex:o,onClose:R}){const{state:i,updateState:h}=xe(),w=i.units.units[o],[a,k]=u.useState(w.equipment||{head:null,body:null,weapon:null,offHand:null,accessory:null}),x=M=>{var N;return!M||!i.units.imageMap.has(M)?"":(N=i.units.imageMap.get(M))==null?void 0:N.data},f=M=>i.units.items.filter(N=>N.slotType===M),S=(M,N)=>{k(I=>({...I,[M]:N}))},L=()=>{const M=[...i.units.units];M[o]={...M[o],equipment:a},h("units.units",M),R()},C=M=>({head:"Head",body:"Body",weapon:"Weapon",offHand:"Off Hand",accessory:"Accessory",helmet:"Helmet",armor:"Armor",gloves:"Gloves",boots:"Boots"})[M]||M;return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 p-6 rounded-lg max-w-2xl w-full",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs("h2",{className:"text-xl font-bold",children:["Equipment: ",w.name]}),e.jsx("button",{onClick:R,className:"text-gray-500 hover:text-gray-700",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsx("div",{className:"mb-4",children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:Object.values(rt).map(M=>{var N,I,A;return e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700 p-3 rounded-md",children:[e.jsx("h3",{className:"text-sm font-medium mb-2",children:C(M)}),e.jsxs("div",{className:"flex items-center mb-2",children:[e.jsx("div",{className:"w-12 h-12 bg-gray-200 dark:bg-gray-600 rounded-md overflow-hidden mr-3",children:a[M]!==null&&a[M]!==void 0&&e.jsx("img",{src:x((N=i.units.items[a[M]])==null?void 0:N.imageId),alt:(I=i.units.items[a[M]])==null?void 0:I.name,className:"w-full h-full object-contain"})}),e.jsx("div",{children:a[M]!==null&&a[M]!==void 0?e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"font-medium",children:(A=i.units.items[a[M]])==null?void 0:A.name}),e.jsx("button",{onClick:()=>S(M,null),className:"text-xs text-red-500 hover:text-red-700",children:"Remove"})]}):e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"No item equipped"})})]}),e.jsxs("div",{className:"mt-2",children:[e.jsx("label",{className:"block text-xs font-medium mb-1",children:"Select item"}),e.jsxs("select",{className:"w-full px-2 py-1 text-sm border border-gray-300 dark:border-gray-600 rounded-md",value:a[M]!==null&&a[M]!==void 0?a[M]:"",onChange:P=>S(M,P.target.value?parseInt(P.target.value):null),children:[e.jsx("option",{value:"",children:"None"}),f(M).map(P=>{const U=i.units.items.findIndex(j=>j===P);return e.jsxs("option",{value:U,children:[P.name," (",P.rarity,")"]},U)})]})]})]},M)})})}),e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsx("button",{onClick:R,className:"px-4 py-2 bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200 rounded-md",children:"Cancel"}),e.jsx("button",{onClick:L,className:"px-4 py-2 bg-primary text-white rounded-md",children:"Save Equipment"})]})]})})}function Nt(){const{state:o,updateState:R}=xe(),[i,h]=u.useState(o.units.sorting||"name-asc"),[w,a]=u.useState(o.units.elementFilter||"all"),[k,x]=u.useState(!1),[f,S]=u.useState(null),L=j=>{var O;return!j||!o.units.imageMap.has(j)?"":(O=o.units.imageMap.get(j))==null?void 0:O.data},C=j=>{const O=j.target.value;h(O),R("units.sorting",O)},M=j=>{const O=j.target.value;a(O),R("units.elementFilter",O)},N=j=>{if(confirm(`Are you sure you want to delete the unit "${o.units.units[j].name}"?`)){const O=[...o.units.units];O.splice(j,1),R("units.units",O)}},I=j=>{alert(`Edit unit ${o.units.units[j].name} (to be implemented)`)},A=j=>{S(j),x(!0)};let P=[...o.units.units];switch(w!=="all"&&(P=P.filter(j=>j.element===w)),i){case"name-asc":P.sort((j,O)=>j.name.localeCompare(O.name));break;case"name-desc":P.sort((j,O)=>O.name.localeCompare(j.name));break;case"rarity":P.sort((j,O)=>{var t,s;const Z=((t=o.units.rarities.find(d=>d.id===j.rarity))==null?void 0:t.value)||0,n=((s=o.units.rarities.find(d=>d.id===O.rarity))==null?void 0:s.value)||0;return Z-n});break;case"rarity-desc":P.sort((j,O)=>{var t,s;const Z=((t=o.units.rarities.find(d=>d.id===j.rarity))==null?void 0:t.value)||0;return(((s=o.units.rarities.find(d=>d.id===O.rarity))==null?void 0:s.value)||0)-Z});break}const U=j=>{if(j<=0)return"0.00%";const O=j/100,Z=(O*O-.1)/5*100;return Math.max(0,Z).toFixed(2)+"%"};return e.jsxs("div",{children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center mb-4 space-y-2 md:space-y-0",children:[e.jsx("h2",{className:"text-xl font-semibold",children:"Unit Catalog"}),e.jsxs("div",{className:"flex flex-col sm:flex-row space-y-2 sm:space-y-0 sm:space-x-2",children:[e.jsxs("select",{className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-700 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100",value:i,onChange:C,children:[e.jsx("option",{value:"name-asc",children:"Name (A-Z)"}),e.jsx("option",{value:"name-desc",children:"Name (Z-A)"}),e.jsx("option",{value:"rarity",children:"Rarity (Low to High)"}),e.jsx("option",{value:"rarity-desc",children:"Rarity (High to Low)"})]}),e.jsxs("select",{className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-700 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100",value:w,onChange:M,children:[e.jsx("option",{value:"all",children:"All Elements"}),e.jsx("option",{value:"fire",children:"Fire"}),e.jsx("option",{value:"water",children:"Water"}),e.jsx("option",{value:"earth",children:"Earth"}),e.jsx("option",{value:"air",children:"Air"}),e.jsx("option",{value:"electricity",children:"Electricity"}),e.jsx("option",{value:"chaos",children:"Chaos"}),e.jsx("option",{value:"order",children:"Order"})]})]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:P.length===0?e.jsx("p",{className:"col-span-full text-center text-gray-500 dark:text-gray-400 py-8",children:o.units.units.length===0?"No units created yet. Start by creating a unit.":"No units match the selected filter."}):P.map((j,O)=>{const Z=o.units.units.findIndex(t=>t===j),n=o.units.rarities.find(t=>t.id===j.rarity);return e.jsxs("div",{className:`bg-white dark:bg-gray-700 rounded-lg p-4 border border-gray-200 dark:border-gray-600 shadow-sm hover:shadow-md transition-shadow unit-card-${j.rarity}`,children:[e.jsxs("div",{className:"flex items-center mb-3",children:[e.jsx("div",{className:"h-16 w-16 bg-gray-100 dark:bg-gray-800 rounded-md overflow-hidden flex items-center justify-center mr-3",children:j.imageId?e.jsx("img",{src:L(j.imageId),className:"h-full w-full object-contain",alt:j.name}):e.jsx("div",{className:"flex items-center justify-center h-full w-full text-gray-400",children:e.jsx("svg",{className:"h-8 w-8",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})})})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-bold truncate unit-name",children:j.name}),e.jsx("p",{className:`text-sm capitalize rarity-text rarity-${j.rarity}`,children:(n==null?void 0:n.name)||j.rarity}),e.jsx("span",{className:`inline-block px-2 py-0.5 rounded text-xs bg-${j.element} bg-opacity-20 text-${j.element} mt-1`,children:j.element.charAt(0).toUpperCase()+j.element.slice(1)})]})]}),e.jsxs("div",{className:"grid grid-cols-3 grid-rows-2 gap-2 mb-3",children:[e.jsxs("div",{className:"bg-gray-100 dark:bg-gray-800 p-2 rounded",children:[e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Health"}),e.jsx("p",{className:"font-medium",children:j.stats.health})]}),e.jsxs("div",{className:"bg-gray-100 dark:bg-gray-800 p-2 rounded",children:[e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Speed"}),e.jsx("p",{className:"font-medium",children:j.stats.speed})]}),e.jsxs("div",{className:"bg-gray-100 dark:bg-gray-800 p-2 rounded",children:[e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Dodge"}),e.jsx("p",{className:"font-medium",children:U(j.stats.speed)})]}),e.jsxs("div",{className:"bg-gray-100 dark:bg-gray-800 p-2 rounded col-span-2",children:[e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Phys Def"}),e.jsx("p",{className:"font-medium",children:j.stats.physDefense})]}),e.jsxs("div",{className:"bg-gray-100 dark:bg-gray-800 p-2 rounded",children:[e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Magic Def"}),e.jsx("p",{className:"font-medium",children:j.stats.magicDefense})]})]}),e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsx("button",{onClick:()=>A(Z),className:"px-3 py-1 bg-blue-500 text-white rounded-md text-sm",children:"Equipment"}),e.jsx("button",{onClick:()=>I(Z),className:"px-3 py-1 bg-primary text-white rounded-md text-sm",children:"Edit"}),e.jsx("button",{onClick:()=>N(Z),className:"px-3 py-1 bg-red-500 text-white rounded-md text-sm",children:"Delete"})]})]},O)})}),k&&f!==null&&e.jsx(vt,{unitIndex:f,onClose:()=>x(!1)})]})}function kt(){const{state:o,updateState:R}=xe(),[i,h]=u.useState({name:"",rarity:"common",imageId:null}),[w,a]=u.useState(null),[k,x]=u.useState(null),[f,S]=u.useState(!1),[L,C]=u.useState(-1),M=U=>{const{name:j,value:O}=U.target;h(Z=>({...Z,[j]:O})),w&&a(null)},N=U=>{h(j=>({...j,imageId:U}))},I=()=>i.name.trim()?!0:(a("Please enter an item name"),!1),A=U=>{if(U.preventDefault(),!I())return;const j={name:i.name.trim(),rarity:i.rarity,imageId:i.imageId};if(f&&L>=0){const O=[...o.units.items];O[L]={...j,slotType:null},R("units.items",O),x("Item updated successfully!")}else R("units.items",[...o.units.items,j]),x("Item created successfully!");P()},P=()=>{h({name:"",rarity:"common",imageId:null}),S(!1),C(-1)};return e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold mb-4",children:f?"Edit Item":"Create Item"}),w&&e.jsx("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4",children:w}),k&&e.jsx("div",{className:"bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded mb-4",children:k}),e.jsxs("form",{onSubmit:A,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Item Name"}),e.jsx("input",{type:"text",name:"name",value:i.name,onChange:M,className:"w-full px-3 py-2 bg-gray-100 dark:bg-gray-800 border border-gray-300 dark:border-gray-700 rounded-md text-gray-700 dark:text-gray-300",placeholder:"Enter item name"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Rarity"}),e.jsx("select",{name:"rarity",value:i.rarity,onChange:M,className:"w-full px-3 py-2 bg-gray-100 dark:bg-gray-800 border border-gray-300 dark:border-gray-700 rounded-md text-gray-700 dark:text-gray-300",children:o.units.rarities.map(U=>e.jsx("option",{value:U.id,children:U.name},U.id))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Item Image"}),e.jsx(Fe,{onImageUpload:N,currentImageId:i.imageId,size:"md"})]}),e.jsxs("div",{className:"flex justify-end space-x-2",children:[f&&e.jsx("button",{type:"button",onClick:()=>{S(!1),C(-1),P()},className:"px-4 py-2 bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200 rounded-md",children:"Cancel"}),e.jsx("button",{type:"button",onClick:P,className:"px-4 py-2 bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200 rounded-md",children:"Clear"}),e.jsxs("button",{type:"submit",className:"px-4 py-2 bg-primary text-white rounded-md",children:[f?"Update":"Create"," Item"]})]})]})]})}function wt(){const{state:o,updateState:R}=xe(),[i,h]=u.useState(o.units.itemSorting||"name-asc"),w=S=>{var L;return!S||!o.units.imageMap.has(S)?"":(L=o.units.imageMap.get(S))==null?void 0:L.data},a=S=>{const L=S.target.value;h(L),R("units.itemSorting",L)},k=S=>{if(confirm(`Are you sure you want to delete the item "${o.units.items[S].name}"?`)){let L=!1;if(o.units.units.forEach(M=>{if(M.gearRequirements){for(const N of Object.values(M.gearRequirements))if(Array.isArray(N)&&N.includes(S)){L=!0;break}}}),L){alert("This item is used by one or more units and cannot be deleted.");return}const C=[...o.units.items];C.splice(S,1),R("units.items",C)}},x=S=>{alert(`Edit item ${o.units.items[S].name} (to be implemented)`)};let f=[...o.units.items];switch(i){case"name-asc":f.sort((S,L)=>S.name.localeCompare(L.name));break;case"name-desc":f.sort((S,L)=>L.name.localeCompare(S.name));break;case"rarity":f.sort((S,L)=>{var N,I;const C=((N=o.units.rarities.find(A=>A.id===S.rarity))==null?void 0:N.value)||0,M=((I=o.units.rarities.find(A=>A.id===L.rarity))==null?void 0:I.value)||0;return C-M});break;case"rarity-desc":f.sort((S,L)=>{var N,I;const C=((N=o.units.rarities.find(A=>A.id===S.rarity))==null?void 0:N.value)||0;return(((I=o.units.rarities.find(A=>A.id===L.rarity))==null?void 0:I.value)||0)-C});break}return e.jsxs("div",{children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center mb-4 space-y-2 sm:space-y-0",children:[e.jsx("h2",{className:"text-xl font-semibold",children:"Item Catalog"}),e.jsx("div",{className:"flex space-x-2",children:e.jsxs("select",{className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-700 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100",value:i,onChange:a,children:[e.jsx("option",{value:"name-asc",children:"Name (A-Z)"}),e.jsx("option",{value:"name-desc",children:"Name (Z-A)"}),e.jsx("option",{value:"rarity",children:"Rarity (Low to High)"}),e.jsx("option",{value:"rarity-desc",children:"Rarity (High to Low)"})]})})]}),e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-4",children:f.length===0?e.jsx("p",{className:"col-span-full text-center text-gray-500 dark:text-gray-400 py-8",children:"No items created yet. Start by creating an item."}):f.map((S,L)=>{const C=o.units.items.findIndex(N=>N===S),M=o.units.rarities.find(N=>N.id===S.rarity);return e.jsxs("div",{className:"bg-white dark:bg-gray-700 rounded-lg p-4 border border-gray-200 dark:border-gray-600 shadow-sm hover:shadow-md transition-shadow flex flex-col items-center text-center",children:[e.jsx("div",{className:"w-20 h-20 bg-gray-100 dark:bg-gray-800 rounded-md overflow-hidden flex items-center justify-center mb-3",children:S.imageId?e.jsx("img",{src:w(S.imageId),className:"h-full w-full object-contain",alt:S.name}):e.jsx("div",{className:"flex items-center justify-center h-full w-full text-gray-400",children:e.jsx("svg",{className:"h-8 w-8",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})})})}),e.jsx("h3",{className:"font-medium",children:S.name}),e.jsx("p",{className:`text-sm capitalize ${M?`text-${S.rarity}`:""}`,children:(M==null?void 0:M.name)||S.rarity}),e.jsxs("div",{className:"flex justify-center space-x-2 mt-3",children:[e.jsx("button",{onClick:()=>x(C),className:"px-2 py-1 bg-primary text-white rounded text-xs",children:"Edit"}),e.jsx("button",{onClick:()=>k(C),className:"px-2 py-1 bg-red-500 text-white rounded text-xs",children:"Delete"})]})]},L)})})]})}function Ct({isOpen:o,onClose:R,onSave:i,initialEffect:h,effectTypes:w}){const[a,k]=u.useState({type:"",targetType:"single",element:"",value:0,duration:1,specificFields:{}}),[x,f]=u.useState(null);u.useEffect(()=>{k(h||{type:w.length>0?w[0].id:"",targetType:"single",element:"",value:0,duration:1,specificFields:{}})},[h,w]),u.useEffect(()=>{C()},[a.type]);const S=N=>{const{name:I,value:A}=N.target;k(P=>({...P,[I]:I==="value"||I==="duration"?parseFloat(A):A}))},L=N=>{const{name:I,value:A}=N.target;k(P=>({...P,specificFields:{...P.specificFields,[I]:N.target.type==="number"?parseFloat(A):A}}))},C=()=>{var I,A,P,U;let N=null;a.type==="damage"?N=e.jsx("div",{className:"space-y-3",children:e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Damage Type"}),e.jsxs("select",{name:"damageType",value:((I=a.specificFields)==null?void 0:I.damageType)||"physical",onChange:L,className:"w-full px-3 py-2 bg-gray-100 dark:bg-gray-800 border border-gray-300 dark:border-gray-700 rounded-md text-gray-700 dark:text-gray-300",children:[e.jsx("option",{value:"physical",children:"Physical"}),e.jsx("option",{value:"magical",children:"Magical"}),e.jsx("option",{value:"true",children:"True (ignores defense)"})]})]})}):a.type==="heal"?N=e.jsx("div",{className:"space-y-3",children:e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Heal Type"}),e.jsxs("select",{name:"healType",value:((A=a.specificFields)==null?void 0:A.healType)||"flat",onChange:L,className:"w-full px-3 py-2 bg-gray-100 dark:bg-gray-800 border border-gray-300 dark:border-gray-700 rounded-md text-gray-700 dark:text-gray-300",children:[e.jsx("option",{value:"flat",children:"Flat Amount"}),e.jsx("option",{value:"percentage",children:"Percentage of Max Health"}),e.jsx("option",{value:"overtime",children:"Over Time"})]})]})}):(a.type==="buff"||a.type==="debuff")&&(N=e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Stat Affected"}),e.jsxs("select",{name:"statAffected",value:((P=a.specificFields)==null?void 0:P.statAffected)||"attack",onChange:L,className:"w-full px-3 py-2 bg-gray-100 dark:bg-gray-800 border border-gray-300 dark:border-gray-700 rounded-md text-gray-700 dark:text-gray-300",children:[e.jsx("option",{value:"attack",children:"Attack"}),e.jsx("option",{value:"defense",children:"Defense"}),e.jsx("option",{value:"speed",children:"Speed"}),e.jsx("option",{value:"dodge",children:"Dodge"}),e.jsx("option",{value:"accuracy",children:"Accuracy"}),e.jsx("option",{value:"critRate",children:"Crit Rate"}),e.jsx("option",{value:"critDamage",children:"Crit Damage"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Value Type"}),e.jsxs("select",{name:"valueType",value:((U=a.specificFields)==null?void 0:U.valueType)||"flat",onChange:L,className:"w-full px-3 py-2 bg-gray-100 dark:bg-gray-800 border border-gray-300 dark:border-gray-700 rounded-md text-gray-700 dark:text-gray-300",children:[e.jsx("option",{value:"flat",children:"Flat Value"}),e.jsx("option",{value:"percentage",children:"Percentage"})]})]})]})),f(N)},M=()=>{i(a),R()};return o?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 p-6 rounded-lg max-w-lg w-full",children:[e.jsx("h2",{className:"text-xl font-bold mb-4",children:h?"Edit Effect":"Add Effect"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Effect Type"}),e.jsx("select",{name:"type",value:a.type,onChange:S,className:"w-full px-3 py-2 bg-gray-100 dark:bg-gray-800 border border-gray-300 dark:border-gray-700 rounded-md text-gray-700 dark:text-gray-300",children:w.map(N=>e.jsx("option",{value:N.id,children:N.name},N.id))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Target Type"}),e.jsxs("select",{name:"targetType",value:a.targetType,onChange:S,className:"w-full px-3 py-2 bg-gray-100 dark:bg-gray-800 border border-gray-300 dark:border-gray-700 rounded-md text-gray-700 dark:text-gray-300",children:[e.jsx("option",{value:"single",children:"Single Target"}),e.jsx("option",{value:"all",children:"All Enemies"}),e.jsx("option",{value:"random",children:"Random Enemy"}),e.jsx("option",{value:"self",children:"Self"}),e.jsx("option",{value:"ally",children:"Single Ally"}),e.jsx("option",{value:"all_allies",children:"All Allies"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Element"}),e.jsxs("select",{name:"element",value:a.element,onChange:S,className:"w-full px-3 py-2 bg-gray-100 dark:bg-gray-800 border border-gray-300 dark:border-gray-700 rounded-md text-gray-700 dark:text-gray-300",children:[e.jsx("option",{value:"",children:"None"}),e.jsx("option",{value:"fire",children:"Fire"}),e.jsx("option",{value:"water",children:"Water"}),e.jsx("option",{value:"earth",children:"Earth"}),e.jsx("option",{value:"air",children:"Air"}),e.jsx("option",{value:"electricity",children:"Electricity"}),e.jsx("option",{value:"chaos",children:"Chaos"}),e.jsx("option",{value:"order",children:"Order"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Value"}),e.jsx("input",{type:"number",name:"value",value:a.value,onChange:S,className:"w-full px-3 py-2 bg-gray-100 dark:bg-gray-800 border border-gray-300 dark:border-gray-700 rounded-md text-gray-700 dark:text-gray-300"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Duration (turns)"}),e.jsx("input",{type:"number",name:"duration",value:a.duration,onChange:S,className:"w-full px-3 py-2 bg-gray-100 dark:bg-gray-800 border border-gray-300 dark:border-gray-700 rounded-md text-gray-700 dark:text-gray-300",min:"1"})]})]}),x]}),e.jsxs("div",{className:"flex justify-end space-x-2 mt-6",children:[e.jsx("button",{onClick:R,className:"px-4 py-2 bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200 rounded-md",children:"Cancel"}),e.jsxs("button",{onClick:M,className:"px-4 py-2 bg-primary text-white rounded-md",children:[h?"Update":"Add"," Effect"]})]})]})}):null}function St(){const{state:o,updateState:R}=xe(),[i,h]=u.useState({name:"",type:"",cooldown:"",description:"",targetType:"",iconId:null}),[w,a]=u.useState([]),[k,x]=u.useState(null),[f,S]=u.useState(null),[L,C]=u.useState(!1),[M,N]=u.useState(-1),[I,A]=u.useState(!1),[P,U]=u.useState(null),j=[{id:"damage",name:"Damage",color:"bg-red-500"},{id:"heal",name:"Heal",color:"bg-green-500"},{id:"buff",name:"Buff",color:"bg-blue-500"},{id:"debuff",name:"Debuff",color:"bg-purple-500"},{id:"shield",name:"Shield",color:"bg-yellow-500"},{id:"special",name:"Special",color:"bg-indigo-500"}],O=T=>{const{name:b,value:D}=T.target;h(J=>({...J,[b]:D})),k&&x(null)},Z=T=>{h(b=>({...b,iconId:T}))},n=T=>{T!==void 0&&T>=0&&T<w.length?U(T):U(null),A(!0)},t=T=>{if(P!==null){const b=[...w];b[P]=T,a(b)}else a([...w,T])},s=T=>{if(confirm("Are you sure you want to delete this effect?")){const b=[...w];b.splice(T,1),a(b)}},d=()=>i.name.trim()?i.type?i.targetType?i.description.trim()?!0:(x("Please enter a description"),!1):(x("Please select a target type"),!1):(x("Please select an ability type"),!1):(x("Please enter an ability name"),!1),r=T=>{if(T.preventDefault(),!d())return;const b={name:i.name.trim(),type:i.type,cooldown:parseInt(i.cooldown)||0,description:i.description.trim(),targetType:i.targetType,iconId:i.iconId,effects:w};if(L&&M>=0){const D=[...o.units.abilities];D[M]=b,R("units.abilities",D),S("Ability updated successfully!")}else R("units.abilities",[...o.units.abilities,b]),S("Ability created successfully!");y()},y=()=>{h({name:"",type:"",cooldown:"",description:"",targetType:"",iconId:null}),a([]),C(!1),N(-1)},p=T=>{const b=j.find(D=>D.id===T);return b?b.color:"bg-gray-500"},v=T=>{var D,J,B,G,K,ie;let b="";switch(T.type){case"damage":const E=((D=T.specificFields)==null?void 0:D.damageType)||"physical";b=`Deals ${T.value} ${E} damage`;break;case"heal":const V=((J=T.specificFields)==null?void 0:J.healType)||"flat";V==="flat"?b=`Heals for ${T.value} health`:V==="percentage"?b=`Heals for ${T.value}% of max health`:b=`Heals ${T.value} health per turn`;break;case"buff":const c=((B=T.specificFields)==null?void 0:B.statAffected)||"attack",F=((G=T.specificFields)==null?void 0:G.valueType)||"flat";b=`Increases ${c} by ${T.value}${F==="percentage"?"%":""}`;break;case"debuff":const g=((K=T.specificFields)==null?void 0:K.statAffected)||"attack",W=((ie=T.specificFields)==null?void 0:ie.valueType)||"flat";b=`Decreases ${g} by ${T.value}${W==="percentage"?"%":""}`;break;case"shield":b=`Provides a shield of ${T.value} points`;break;case"special":b=`Special effect with value ${T.value}`;break;default:b=`Effect with value ${T.value}`}return T.duration>1&&(b+=` for ${T.duration} turns`),b};return e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold mb-4",children:L?"Edit Ability":"Create Ability"}),k&&e.jsx("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4",children:k}),f&&e.jsx("div",{className:"bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded mb-4",children:f}),e.jsxs("form",{onSubmit:r,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Ability Name"}),e.jsx("input",{type:"text",name:"name",value:i.name,onChange:O,className:"w-full px-3 py-2 bg-gray-100 dark:bg-gray-800 border border-gray-300 dark:border-gray-700 rounded-md text-gray-700 dark:text-gray-300",placeholder:"Enter ability name"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Type"}),e.jsxs("select",{name:"type",value:i.type,onChange:O,className:"w-full px-3 py-2 bg-gray-100 dark:bg-gray-800 border border-gray-300 dark:border-gray-700 rounded-md text-gray-700 dark:text-gray-300",children:[e.jsx("option",{value:"",children:"Select type"}),e.jsx("option",{value:"active",children:"Active"}),e.jsx("option",{value:"passive",children:"Passive"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Cooldown (turns)"}),e.jsx("input",{type:"number",name:"cooldown",value:i.cooldown,onChange:O,className:"w-full px-3 py-2 bg-gray-100 dark:bg-gray-800 border border-gray-300 dark:border-gray-700 rounded-md text-gray-700 dark:text-gray-300",placeholder:"Turns",min:"0"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Target Type"}),e.jsxs("select",{name:"targetType",value:i.targetType,onChange:O,className:"w-full px-3 py-2 bg-gray-100 dark:bg-gray-800 border border-gray-300 dark:border-gray-700 rounded-md text-gray-700 dark:text-gray-300",children:[e.jsx("option",{value:"",children:"Select target type"}),e.jsx("option",{value:"single",children:"Single Target"}),e.jsx("option",{value:"all",children:"All Enemies"}),e.jsx("option",{value:"random",children:"Random Enemy"}),e.jsx("option",{value:"self",children:"Self"}),e.jsx("option",{value:"ally",children:"Single Ally"}),e.jsx("option",{value:"all_allies",children:"All Allies"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Description"}),e.jsx("textarea",{name:"description",value:i.description,onChange:O,className:"w-full px-3 py-2 bg-gray-100 dark:bg-gray-800 border border-gray-300 dark:border-gray-700 rounded-md text-gray-700 dark:text-gray-300",rows:3,placeholder:"Describe this ability..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Icon"}),e.jsx(Fe,{onImageUpload:Z,currentImageId:i.iconId,size:"md"})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("label",{className:"block text-sm font-medium",children:"Effects"}),e.jsx("button",{type:"button",onClick:()=>n(),className:"px-3 py-1.5 bg-primary bg-opacity-10 text-primary rounded-md text-sm hover:bg-opacity-20 transition-colors",children:"Add Effect"})]}),e.jsx("div",{className:"bg-gray-100 dark:bg-gray-800 p-4 rounded-md",children:w.length===0?e.jsx("p",{className:"text-gray-500 dark:text-gray-400 text-center",children:"No effects added yet"}):e.jsx("div",{className:"space-y-3",children:w.map((T,b)=>e.jsxs("div",{className:"bg-white dark:bg-gray-700 p-3 rounded-md shadow-sm",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:`inline-block w-3 h-3 rounded-full ${p(T.type)} mr-2`}),e.jsx("span",{className:"font-medium capitalize",children:T.type}),T.element&&e.jsx("span",{className:`ml-2 px-2 py-0.5 text-xs rounded bg-${T.element} bg-opacity-20 text-${T.element}`,children:T.element})]}),e.jsxs("div",{className:"flex space-x-1",children:[e.jsx("button",{type:"button",onClick:()=>n(b),className:"p-1 text-primary hover:text-primary-dark",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{d:"M13.586 3.586a2 2 0 112.828 2.828l-.793.793-2.828-2.828.793-.793zM11.379 5.793L3 14.172V17h2.828l8.38-8.379-2.83-2.828z"})})}),e.jsx("button",{type:"button",onClick:()=>s(b),className:"p-1 text-red-500 hover:text-red-700",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z",clipRule:"evenodd"})})})]})]}),e.jsx("p",{className:"text-sm",children:v(T)}),e.jsxs("div",{className:"mt-1 flex space-x-3 text-xs text-gray-500 dark:text-gray-400",children:[e.jsxs("div",{children:["Target: ",T.targetType.replace("_"," ")]}),T.duration>1&&e.jsxs("div",{children:["Duration: ",T.duration," turns"]})]})]},b))})})]}),e.jsxs("div",{className:"flex justify-end space-x-2",children:[L&&e.jsx("button",{type:"button",onClick:()=>{C(!1),N(-1),y()},className:"px-4 py-2 bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200 rounded-md",children:"Cancel"}),e.jsx("button",{type:"button",onClick:y,className:"px-4 py-2 bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200 rounded-md",children:"Clear"}),e.jsxs("button",{type:"submit",className:"px-4 py-2 bg-primary text-white rounded-md",children:[L?"Update":"Create"," Ability"]})]})]}),e.jsx(Ct,{isOpen:I,onClose:()=>A(!1),onSave:t,initialEffect:P!==null?w[P]:null,effectTypes:j})]})}function It(){const{state:o,updateState:R}=xe(),[i,h]=u.useState(o.units.abilitySorting||"name-asc"),[w,a]=u.useState("all"),k=I=>{var A;return!I||!o.units.imageMap.has(I)?"":(A=o.units.imageMap.get(I))==null?void 0:A.data},x=I=>{const A=I.target.value;h(A),R("units.abilitySorting",A)},f=I=>{a(I.target.value)},S=I=>{if(confirm(`Are you sure you want to delete the ability "${o.units.abilities[I].name}"?`)){const A=[...o.units.abilities];A.splice(I,1),R("units.abilities",A)}},L=I=>{alert(`Edit ability ${o.units.abilities[I].name} (to be implemented)`)};let C=[...o.units.abilities];switch(w!=="all"&&(C=C.filter(I=>!I.effects||I.effects.length===0?!1:I.effects.some(A=>A.type===w))),i){case"name-asc":C.sort((I,A)=>I.name.localeCompare(A.name));break;case"name-desc":C.sort((I,A)=>A.name.localeCompare(I.name));break;case"type":C.sort((I,A)=>I.type.localeCompare(A.type));break}const M=I=>{switch(I){case"active":return"bg-blue-500";case"passive":return"bg-green-500";default:return"bg-gray-500"}},N=I=>{switch(I){case"damage":return"bg-red-500";case"heal":return"bg-green-500";case"buff":return"bg-blue-500";case"debuff":return"bg-purple-500";case"shield":return"bg-yellow-500";case"special":return"bg-indigo-500";default:return"bg-gray-500"}};return e.jsxs("div",{children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center mb-4 space-y-2 sm:space-y-0",children:[e.jsx("h2",{className:"text-xl font-semibold",children:"Ability Catalog"}),e.jsxs("div",{className:"flex flex-col sm:flex-row space-y-2 sm:space-y-0 sm:space-x-2",children:[e.jsxs("select",{className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-700 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100",value:i,onChange:x,children:[e.jsx("option",{value:"name-asc",children:"Name (A-Z)"}),e.jsx("option",{value:"name-desc",children:"Name (Z-A)"}),e.jsx("option",{value:"type",children:"Type"})]}),e.jsxs("select",{className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-700 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100",value:w,onChange:f,children:[e.jsx("option",{value:"all",children:"All Effects"}),e.jsx("option",{value:"damage",children:"Damage"}),e.jsx("option",{value:"heal",children:"Heal"}),e.jsx("option",{value:"buff",children:"Buff"}),e.jsx("option",{value:"debuff",children:"Debuff"}),e.jsx("option",{value:"shield",children:"Shield"}),e.jsx("option",{value:"special",children:"Special"})]})]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:C.length===0?e.jsx("p",{className:"col-span-full text-center text-gray-500 dark:text-gray-400 py-8",children:o.units.abilities.length===0?"No abilities created yet. Start by creating an ability.":"No abilities match the selected filter."}):C.map((I,A)=>{const P=o.units.abilities.findIndex(U=>U===I);return e.jsxs("div",{className:"bg-white dark:bg-gray-700 rounded-lg p-4 border border-gray-200 dark:border-gray-600 shadow-sm hover:shadow-md transition-shadow",children:[e.jsxs("div",{className:"flex items-center mb-3",children:[e.jsx("div",{className:"h-12 w-12 bg-gray-100 dark:bg-gray-800 rounded-md overflow-hidden flex items-center justify-center mr-3",children:I.iconId?e.jsx("img",{src:k(I.iconId),className:"h-full w-full object-contain",alt:I.name}):e.jsx("div",{className:"flex items-center justify-center h-full w-full text-gray-400",children:e.jsx("svg",{className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 10V3L4 14h7v7l9-11h-7z"})})})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold",children:I.name}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:`inline-block w-2 h-2 rounded-full ${M(I.type)} mr-1`}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 capitalize",children:I.type})]})]})]}),e.jsx("p",{className:"text-sm italic mb-3",children:I.description}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 mb-3",children:[e.jsxs("div",{className:"bg-gray-100 dark:bg-gray-800 p-2 rounded",children:[e.jsx("span",{className:"block text-xs text-gray-500 dark:text-gray-400",children:"Cooldown"}),e.jsxs("span",{className:"text-sm",children:[I.cooldown," turns"]})]}),e.jsxs("div",{className:"bg-gray-100 dark:bg-gray-800 p-2 rounded",children:[e.jsx("span",{className:"block text-xs text-gray-500 dark:text-gray-400",children:"Target"}),e.jsx("span",{className:"text-sm capitalize",children:I.targetType.replace(/_/g," ")})]})]}),I.effects&&I.effects.length>0&&e.jsxs("div",{className:"mb-3",children:[e.jsx("h4",{className:"text-xs font-medium text-gray-500 dark:text-gray-400 mb-2",children:"Effects:"}),e.jsx("div",{className:"space-y-1",children:I.effects.map((U,j)=>e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:`inline-block w-2 h-2 rounded-full ${N(U.type)} mr-1`}),e.jsxs("span",{className:"text-xs capitalize",children:[U.type,U.element&&e.jsxs("span",{className:`ml-1 text-${U.element}`,children:["(",U.element,")"]}),U.value&&e.jsx("span",{className:"ml-1",children:U.value}),U.duration>1&&e.jsxs("span",{className:"ml-1",children:["for ",U.duration," turns"]})]})]},j))})]}),e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsx("button",{onClick:()=>L(P),className:"px-3 py-1 bg-primary text-white rounded-md text-sm",children:"Edit"}),e.jsx("button",{onClick:()=>S(P),className:"px-3 py-1 bg-red-500 text-white rounded-md text-sm",children:"Delete"})]})]},A)})})]})}function et(){const[o,R]=u.useState("unit-creator"),i=()=>{const h=[{id:"unit-creator",label:"Create Unit"},{id:"unit-catalog",label:"Units"},{id:"item-creator",label:"Create Item"},{id:"item-catalog",label:"Items"},{id:"ability-creator",label:"Create Ability"},{id:"ability-catalog",label:"Abilities"}];return e.jsx("div",{className:"border-b border-gray-200 dark:border-gray-700",children:e.jsx("ul",{className:"flex flex-wrap -mb-px",children:h.map(w=>e.jsx("li",{className:"mr-2",children:e.jsx("button",{onClick:()=>R(w.id),className:`inline-block p-4 border-b-2 rounded-t-lg ${o===w.id?"border-primary text-primary":"border-transparent hover:text-primary hover:border-primary"}`,children:w.label})},w.id))})})};return e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-md p-6",children:[e.jsx("h1",{className:"text-2xl font-bold mb-6",children:"Unit Builder"}),e.jsx(i,{}),e.jsxs("div",{className:"mt-6",children:[o==="unit-creator"&&e.jsx(jt,{}),o==="unit-catalog"&&e.jsx(Nt,{}),o==="item-creator"&&e.jsx(kt,{}),o==="item-catalog"&&e.jsx(wt,{}),o==="ability-creator"&&e.jsx(St,{}),o==="ability-catalog"&&e.jsx(It,{})]})]})}const Xe=["Еда","Напитки","Насекомые","Плоды","Ингредиент","Урожай","Рыба","Грибы"],Tt=({editingRecipeId:o,onSaveComplete:R})=>{const{state:i,updateState:h}=xe(),w=je(),[a,k]=u.useState([]),[x,f]=u.useState(""),[S,L]=u.useState(""),[C,M]=u.useState("general"),[N,I]=u.useState(""),[A,P]=u.useState(""),[U,j]=u.useState([]),[O,Z]=u.useState("grid"),[n,t]=u.useState("name"),[s,d]=u.useState(!1),[r,y]=u.useState([]),p=u.useRef(null),v=c=>c&&Ee(c,i)||"",b=w.comparisonItems.filter(c=>c.selectedCategories&&c.selectedCategories.some(F=>Xe.includes(F))).filter(c=>{const F=U.length===0||c.selectedCategories&&c.selectedCategories.some(W=>U.includes(W)),g=!A||c.name&&c.name.toLowerCase().includes(A.toLowerCase())||c.subType&&c.subType.toLowerCase().includes(A.toLowerCase());return F&&g});u.useEffect(()=>{if(o){const c=i.mixingSystem.recipes.find(F=>F.id===o);c&&(k(c.ingredients),f(c.result.name),L(c.result.imageId),M(c.result.foodType),I(c.result.description||""))}else k([]),f(""),L(""),M("general"),I("")},[o,i.mixingSystem.recipes]);const D=c=>{if(!a.find(F=>F.name===c.name)&&(k([...a,c]),!r.some(F=>F.name===c.name))){const F=[c,...r.slice(0,7)];y(F)}},J=c=>{k(a.filter((F,g)=>g!==c))},B=c=>{j(F=>F.includes(c)?F.filter(g=>g!==c):[...F,c])},G=()=>{j([]),P(""),t("name"),d(!1)},K=(c,F)=>{p.current=F,c.dataTransfer.effectAllowed="move",setTimeout(()=>{c.currentTarget.classList.add("opacity-50")},0)},ie=c=>{p.current=null,c.currentTarget&&c.currentTarget.classList&&c.currentTarget.classList.remove("opacity-50")},E=()=>{if(!x||a.length===0){alert("Пожалуйста, заполните все необходимые поля!");return}const c={id:o||`recipe-${Date.now()}`,name:x,ingredients:a,result:{name:x,imageId:S,foodType:C,description:N}};if(o){const F=i.mixingSystem.recipes.map(g=>g.id===o?c:g);h("mixingSystem.recipes",F)}else h("mixingSystem.recipes",[...i.mixingSystem.recipes,c]);k([]),f(""),L(""),M("general"),I(""),alert(`Рецепт "${x}" успешно сохранен!`),R()},V=c=>{if(!c.selectedCategories||c.selectedCategories.length===0)return null;const F=O==="grid"?c.selectedCategories.slice(0,2):c.selectedCategories;return e.jsxs("div",{className:"flex flex-wrap gap-1 mt-1",children:[F.map(g=>e.jsx("span",{className:"text-xs px-1.5 py-0.5 bg-blue-900/40 text-blue-300 rounded-full",children:g},g)),O==="grid"&&c.selectedCategories.length>2&&e.jsxs("span",{className:"text-xs px-1.5 py-0.5 bg-gray-700 text-gray-400 rounded-full",children:["+",c.selectedCategories.length-2]})]})};return e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-gray-800 border border-gray-700 p-4 rounded-lg shadow",children:[e.jsx("h2",{className:"text-lg font-semibold mb-4 text-gray-100",children:"Ингредиенты рецепта"}),e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"text-md font-medium mb-3 text-gray-200",children:"Выбранные ингредиенты"}),a.length===0?e.jsx("p",{className:"text-gray-400 mb-4 p-4 border border-dashed border-gray-600 rounded-lg text-center",children:"Нет выбранных ингредиентов. Добавьте ингредиенты из списка ниже."}):e.jsx("div",{className:"space-y-3 mb-4",children:a.map((c,F)=>e.jsxs("div",{className:"relative flex items-center bg-gray-700 p-3 rounded-lg hover:bg-gray-600 transition-colors border border-gray-600",children:[e.jsx("div",{className:"flex-shrink-0 mr-3",children:c.imageId?e.jsx("img",{src:v(c.imageId),alt:c.name,className:"w-12 h-12 object-cover rounded-md"}):e.jsx("div",{className:"w-12 h-12 bg-gray-600 rounded-md flex items-center justify-center",children:e.jsx("span",{className:"text-xs text-gray-400",children:"Нет изображения"})})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium text-gray-100",children:c.name}),e.jsxs("div",{className:"flex items-center flex-wrap gap-1 mt-1",children:[c.subType&&e.jsx("span",{className:"text-xs text-gray-400 mr-1",children:c.subType}),V(c)]})]}),e.jsx("button",{onClick:()=>J(F),className:"ml-2 bg-red-500/20 hover:bg-red-500/40 text-red-300 w-8 h-8 rounded-full flex items-center justify-center",children:"×"})]},F))})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-md font-medium mb-3 text-gray-200",children:"Выбрать ингредиенты"}),e.jsxs("div",{className:"mb-2 text-xs text-gray-400",children:["Разрешены категории: ",Xe.join(", ")]}),e.jsxs("div",{className:"mb-4 space-y-3",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx("input",{type:"text",value:A,onChange:c=>P(c.target.value),placeholder:"Поиск ингредиентов...",className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded text-gray-200 placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-primary"}),A&&e.jsx("button",{onClick:()=>P(""),className:"absolute right-2 top-2 text-gray-400 hover:text-gray-200",children:"×"})]}),e.jsxs("div",{className:"flex border border-gray-600 rounded overflow-hidden",children:[e.jsx("button",{onClick:()=>Z("list"),className:`px-2 py-1 ${O==="list"?"bg-blue-600 text-white":"bg-gray-700 text-gray-300"}`,title:"Список",children:"☰"}),e.jsx("button",{onClick:()=>Z("grid"),className:`px-2 py-1 ${O==="grid"?"bg-blue-600 text-white":"bg-gray-700 text-gray-300"}`,title:"Сетка",children:"▦"})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-2 items-center",children:[e.jsx("span",{className:"text-sm text-gray-300",children:"Фильтры:"}),e.jsx("div",{className:"flex items-center",children:e.jsx("button",{onClick:()=>d(!s),className:`px-2 py-1 text-xs rounded ${s?"bg-blue-600 text-white":"bg-gray-700 text-gray-200 hover:bg-gray-600"}`,children:"Недавние"})}),e.jsxs("div",{className:"flex items-center ml-2",children:[e.jsx("span",{className:"text-sm text-gray-300 mr-1",children:"Сортировка:"}),e.jsxs("select",{value:n,onChange:c=>t(c.target.value),className:"bg-gray-700 border border-gray-600 rounded text-gray-200 text-sm py-1",children:[e.jsx("option",{value:"name",children:"По имени"}),e.jsx("option",{value:"category",children:"По категории"})]})]}),(U.length>0||A||s)&&e.jsx("button",{onClick:G,className:"px-2 py-1 text-xs bg-red-500/40 text-red-300 rounded hover:bg-red-500/60",children:"Сбросить"})]}),e.jsx("div",{className:"flex flex-wrap gap-1",children:Xe.map(c=>e.jsx("button",{onClick:()=>B(c),className:`px-2 py-1 text-xs rounded ${U.includes(c)?"bg-blue-600 text-white":"bg-gray-700 text-gray-200 hover:bg-gray-600"}`,children:c},c))})]}),s&&r.length>0&&e.jsxs("div",{className:"mb-4",children:[e.jsx("h4",{className:"text-sm font-medium mb-2 text-gray-300",children:"Недавно использованные"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:r.map((c,F)=>e.jsxs("div",{className:"bg-gray-700 rounded p-2 flex items-center cursor-pointer hover:bg-gray-600",onClick:()=>D(c),children:[c.imageId&&e.jsx("img",{src:v(c.imageId),alt:c.name,className:"w-6 h-6 object-cover rounded mr-1"}),e.jsx("span",{className:"text-sm text-gray-200",children:c.name})]},F))})]}),e.jsx("div",{className:"border border-gray-700 rounded",children:O==="list"?e.jsx("div",{className:"max-h-[400px] overflow-y-auto",children:b.length===0?e.jsx("div",{className:"p-4 text-center text-gray-400",children:"Ничего не найдено"}):b.map((c,F)=>e.jsx("div",{className:"p-3 border-b border-gray-700 hover:bg-gray-700 transition-colors cursor-pointer",onClick:()=>D(c),draggable:!0,onDragStart:g=>K(g,c),onDragEnd:ie,children:e.jsxs("div",{className:"flex items-center",children:[c.imageId?e.jsx("div",{className:"w-10 h-10 mr-3 flex-shrink-0",children:e.jsx("img",{src:v(c.imageId),alt:c.name,className:"w-full h-full object-cover rounded"})}):e.jsx("div",{className:"w-10 h-10 mr-3 bg-gray-700 rounded flex items-center justify-center flex-shrink-0",children:e.jsx("span",{className:"text-xs text-gray-500",children:"Нет"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-gray-200",children:c.name}),V(c),c.subType&&e.jsx("span",{className:"text-xs text-gray-400",children:c.subType})]}),e.jsx("button",{onClick:g=>{g.stopPropagation(),D(c)},className:"ml-2 px-3 py-1 bg-blue-500 text-white text-sm rounded hover:bg-blue-600",children:"Добавить"})]})},F))}):e.jsx("div",{className:"max-h-[400px] overflow-y-auto p-2",children:b.length===0?e.jsx("div",{className:"p-4 text-center text-gray-400",children:"Ничего не найдено"}):e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 gap-2",children:b.map((c,F)=>e.jsx("div",{className:"p-2 border border-gray-700 rounded-lg bg-gray-800 hover:bg-gray-700 transition-colors cursor-pointer",onClick:()=>D(c),draggable:!0,onDragStart:g=>K(g,c),onDragEnd:ie,children:e.jsxs("div",{className:"flex flex-col items-center",children:[c.imageId?e.jsx("div",{className:"w-16 h-16 mb-1",children:e.jsx("img",{src:v(c.imageId),alt:c.name,className:"w-full h-full object-cover rounded"})}):e.jsx("div",{className:"w-16 h-16 mb-1 bg-gray-700 rounded flex items-center justify-center",children:e.jsx("span",{className:"text-xs text-gray-500",children:"Нет изображения"})}),e.jsx("p",{className:"text-sm text-center text-gray-200 truncate w-full",children:c.name}),c.subType&&e.jsx("p",{className:"text-xs text-center text-gray-400 truncate w-full",children:c.subType}),e.jsx("div",{className:"flex justify-center flex-wrap mt-1",children:V(c)})]})},F))})})})]})]}),e.jsxs("div",{className:"bg-gray-800 border border-gray-700 p-4 rounded-lg shadow",children:[e.jsx("h2",{className:"text-lg font-semibold mb-4 text-gray-100",children:"Результат рецепта"}),e.jsxs("div",{className:"space-y-5",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block mb-2 text-gray-200",children:"Название блюда"}),e.jsx("input",{type:"text",value:x,onChange:c=>f(c.target.value),placeholder:"Введите название блюда",className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded text-gray-200 placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-2 text-gray-200",children:"Тип еды"}),e.jsxs("select",{value:C,onChange:c=>M(c.target.value),className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded text-gray-200 focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent",children:[e.jsx("option",{value:"general",children:"Обычное блюдо"}),e.jsx("option",{value:"meat",children:"Мясное блюдо"}),e.jsx("option",{value:"fish",children:"Рыбное блюдо"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-2 text-gray-200",children:"Изображение"}),e.jsxs("div",{className:"bg-gray-700 p-4 rounded-lg border border-gray-600",children:[e.jsx(Fe,{onUpload:c=>L(c)}),S?e.jsx("div",{className:"mt-4 flex justify-center",children:e.jsx("div",{className:"w-40 h-40 rounded-lg overflow-hidden border border-gray-600",children:e.jsx("img",{src:v(S),alt:x,className:"w-full h-full object-cover"})})}):e.jsx("div",{className:"mt-4 flex justify-center",children:e.jsx("div",{className:"w-40 h-40 border border-dashed border-gray-500 rounded-lg flex items-center justify-center bg-gray-800",children:e.jsx("span",{className:"text-gray-400 text-center px-4",children:"Изображение будет отображаться здесь"})})})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-2 text-gray-200",children:"Описание (необязательно)"}),e.jsx("textarea",{value:N,onChange:c=>I(c.target.value),placeholder:"Опишите блюдо...",className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded h-32 text-gray-200 placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent"})]}),e.jsxs("div",{className:"mt-6 p-4 bg-gray-900 rounded-lg border border-gray-700",children:[e.jsx("h3",{className:"text-md font-medium mb-3 text-gray-200",children:"Предпросмотр рецепта"}),e.jsxs("div",{className:"flex items-center mb-3",children:[S?e.jsx("img",{src:v(S),alt:x||"Предпросмотр",className:"w-16 h-16 object-cover rounded-lg mr-3"}):e.jsx("div",{className:"w-16 h-16 bg-gray-800 rounded-lg flex items-center justify-center mr-3",children:e.jsx("span",{className:"text-xs text-gray-500",children:"Нет изображения"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-100",children:x||"Название блюда"}),e.jsx("div",{className:"flex items-center mt-1",children:e.jsx("span",{className:`text-xs px-2 py-0.5 rounded-full ${C==="meat"?"bg-red-900/40 text-red-300":C==="fish"?"bg-blue-900/40 text-blue-300":"bg-green-900/40 text-green-300"}`,children:C==="meat"?"Мясное":C==="fish"?"Рыбное":"Обычное"})})]})]}),N&&e.jsx("p",{className:"text-sm text-gray-400 mb-3",children:N}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-300 mb-1",children:"Ингредиенты:"}),a.length===0?e.jsx("p",{className:"text-xs text-gray-500",children:"Нет ингредиентов"}):e.jsx("div",{className:"flex flex-wrap gap-1",children:a.map((c,F)=>e.jsx("span",{className:"text-xs px-2 py-0.5 bg-gray-700 text-gray-300 rounded-full",children:c.name},F))})]})]}),e.jsx("div",{className:"pt-4 text-center",children:e.jsx("button",{onClick:E,disabled:!x||a.length===0,className:`px-6 py-3 rounded-lg font-semibold ${x&&a.length>0?"bg-primary text-white hover:bg-opacity-90":"bg-gray-700 text-gray-500 cursor-not-allowed"}`,children:o?"Обновить рецепт":"Создать рецепт"})})]})]})]})},Mt=({onEditRecipe:o,onCreateRecipe:R})=>{const{state:i,updateState:h}=xe(),{recipes:w}=i.mixingSystem,[a,k]=u.useState(""),[x,f]=u.useState([]),[S,L]=u.useState("grid"),[C,M]=u.useState("name"),N=n=>n&&Ee(n,i)||"",A=[...w.filter(n=>{const t=x.length===0||x.includes(n.result.foodType),s=!a||n.result.name.toLowerCase().includes(a.toLowerCase())||n.ingredients.some(d=>d.name.toLowerCase().includes(a.toLowerCase()));return t&&s})].sort((n,t)=>{if(C==="name")return n.result.name.localeCompare(t.result.name);{const s=n.result.foodType.localeCompare(t.result.foodType);return s!==0?s:n.result.name.localeCompare(t.result.name)}}),P=n=>{window.confirm("Вы уверены, что хотите удалить этот рецепт?")&&h("mixingSystem.recipes",w.filter(t=>t.id!==n))},U=n=>{f(t=>t.includes(n)?t.filter(s=>s!==n):[...t,n])},j=()=>{f([]),k(""),M("name")},O=n=>{switch(n){case"meat":return"Мясное";case"fish":return"Рыбное";case"general":return"Обычное";default:return"Неизвестно"}},Z=n=>{switch(n){case"meat":return"bg-red-900/40 text-red-300";case"fish":return"bg-blue-900/40 text-blue-300";case"general":return"bg-green-900/40 text-green-300";default:return"bg-gray-700 text-gray-300"}};return e.jsxs("div",{className:"bg-gray-800 border border-gray-700 p-4 rounded-lg shadow",children:[e.jsx("h2",{className:"text-lg font-semibold mb-4 text-gray-100",children:"Список рецептов смешивания"}),e.jsxs("div",{className:"mb-6 space-y-3",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx("input",{type:"text",value:a,onChange:n=>k(n.target.value),placeholder:"Поиск рецептов...",className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded text-gray-200 placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-primary"}),a&&e.jsx("button",{onClick:()=>k(""),className:"absolute right-2 top-2 text-gray-400 hover:text-gray-200",children:"×"})]}),e.jsxs("div",{className:"flex border border-gray-600 rounded overflow-hidden",children:[e.jsx("button",{onClick:()=>L("list"),className:`px-2 py-1 ${S==="list"?"bg-blue-600 text-white":"bg-gray-700 text-gray-300"}`,title:"Список",children:"☰"}),e.jsx("button",{onClick:()=>L("grid"),className:`px-2 py-1 ${S==="grid"?"bg-blue-600 text-white":"bg-gray-700 text-gray-300"}`,title:"Сетка",children:"▦"})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-2 items-center",children:[e.jsx("span",{className:"text-sm text-gray-300",children:"Фильтры:"}),e.jsxs("div",{className:"flex flex-wrap gap-1",children:[e.jsx("button",{onClick:()=>U("meat"),className:`px-2 py-1 text-xs rounded ${x.includes("meat")?"bg-red-600 text-white":"bg-gray-700 text-gray-200 hover:bg-gray-600"}`,children:"Мясное"}),e.jsx("button",{onClick:()=>U("fish"),className:`px-2 py-1 text-xs rounded ${x.includes("fish")?"bg-blue-600 text-white":"bg-gray-700 text-gray-200 hover:bg-gray-600"}`,children:"Рыбное"}),e.jsx("button",{onClick:()=>U("general"),className:`px-2 py-1 text-xs rounded ${x.includes("general")?"bg-green-600 text-white":"bg-gray-700 text-gray-200 hover:bg-gray-600"}`,children:"Обычное"})]}),e.jsxs("div",{className:"flex items-center ml-2",children:[e.jsx("span",{className:"text-sm text-gray-300 mr-1",children:"Сортировка:"}),e.jsxs("select",{value:C,onChange:n=>M(n.target.value),className:"bg-gray-700 border border-gray-600 rounded text-gray-200 text-sm py-1",children:[e.jsx("option",{value:"name",children:"По имени"}),e.jsx("option",{value:"type",children:"По типу"})]})]}),(x.length>0||a)&&e.jsx("button",{onClick:j,className:"px-2 py-1 text-xs bg-red-500/40 text-red-300 rounded hover:bg-red-500/60",children:"Сбросить"})]})]}),A.length===0?e.jsx("div",{className:"text-center py-8 text-gray-400",children:w.length===0?e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"mb-2",children:"У вас пока нет созданных рецептов"}),e.jsx("button",{onClick:R,className:"px-4 py-2 bg-primary text-white rounded hover:bg-opacity-90",children:"Создать рецепт"})]}):e.jsx("p",{children:"Не найдено рецептов, соответствующих фильтрам"})}):S==="list"?e.jsx("div",{className:"space-y-4",children:A.map(n=>e.jsx("div",{className:"border border-gray-700 rounded-lg p-4 hover:bg-gray-700/50 transition-colors",children:e.jsxs("div",{className:"flex",children:[e.jsx("div",{className:"w-20 h-20 rounded overflow-hidden flex-shrink-0 mr-4",children:n.result.imageId?e.jsx("img",{src:N(n.result.imageId),alt:n.result.name,className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full bg-gray-700 flex items-center justify-center",children:e.jsx("span",{className:"text-xs text-gray-500",children:"Нет фото"})})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-gray-100 text-lg",children:n.result.name}),e.jsx("div",{className:"mt-1",children:e.jsx("span",{className:`text-xs px-2 py-0.5 rounded-full ${Z(n.result.foodType)}`,children:O(n.result.foodType)})}),n.result.description&&e.jsx("p",{className:"text-sm text-gray-400 mt-1 line-clamp-2",children:n.result.description})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{onClick:()=>o(n.id),className:"px-3 py-1 bg-blue-500/30 hover:bg-blue-500/50 text-blue-300 text-sm rounded transition-colors",children:"Редактировать"}),e.jsx("button",{onClick:()=>P(n.id),className:"px-3 py-1 bg-red-500/30 hover:bg-red-500/50 text-red-300 text-sm rounded transition-colors",children:"Удалить"})]})]}),e.jsxs("div",{className:"mt-3",children:[e.jsx("p",{className:"text-sm font-medium text-gray-300 mb-1",children:"Ингредиенты:"}),e.jsx("div",{className:"flex flex-wrap gap-1 mt-1",children:n.ingredients.map((t,s)=>e.jsxs("div",{className:"flex items-center bg-gray-700 rounded px-2 py-1",children:[t.imageId&&e.jsx("img",{src:N(t.imageId),alt:t.name,className:"w-4 h-4 object-cover rounded mr-1"}),e.jsx("span",{className:"text-xs text-gray-300",children:t.name})]},s))})]})]})]})},n.id))}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:A.map(n=>e.jsxs("div",{className:"border border-gray-700 rounded-lg p-4 hover:bg-gray-700/50 transition-colors flex flex-col",children:[e.jsx("div",{className:"w-full h-40 rounded overflow-hidden mb-3",children:n.result.imageId?e.jsx("img",{src:N(n.result.imageId),alt:n.result.name,className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full bg-gray-700 flex items-center justify-center",children:e.jsx("span",{className:"text-gray-500",children:"Нет изображения"})})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsx("h3",{className:"font-medium text-gray-100",children:n.result.name}),e.jsx("span",{className:`text-xs px-2 py-0.5 rounded-full ${Z(n.result.foodType)}`,children:O(n.result.foodType)})]}),n.result.description&&e.jsx("p",{className:"text-sm text-gray-400 mb-3 line-clamp-2",children:n.result.description}),e.jsxs("div",{className:"mb-3",children:[e.jsx("p",{className:"text-sm font-medium text-gray-300 mb-1",children:"Ингредиенты:"}),e.jsx("div",{className:"flex flex-wrap gap-1",children:n.ingredients.map((t,s)=>e.jsx("span",{className:"text-xs px-2 py-0.5 bg-gray-700 text-gray-300 rounded-full",children:t.name},s))})]})]}),e.jsxs("div",{className:"flex space-x-2 pt-2 mt-auto border-t border-gray-700",children:[e.jsx("button",{onClick:()=>o(n.id),className:"flex-1 px-3 py-1.5 bg-blue-500/30 hover:bg-blue-500/50 text-blue-300 text-sm rounded transition-colors",children:"Редактировать"}),e.jsx("button",{onClick:()=>P(n.id),className:"flex-1 px-3 py-1.5 bg-red-500/30 hover:bg-red-500/50 text-red-300 text-sm rounded transition-colors",children:"Удалить"})]})]},n.id))})]})},Je=["Еда","Напитки","Насекомые","Плоды","Ингредиент","Урожай","Рыба","Грибы"],Ft=()=>{const{state:o}=xe(),R=je(),[i,h]=u.useState([null,null,null]),[w,a]=u.useState(null),[k,x]=u.useState(!1),[f,S]=u.useState([]),[L,C]=u.useState(""),[M,N]=u.useState("grid"),[I,A]=u.useState(!1),[P,U]=u.useState([]),[j,O]=u.useState("name"),[Z,n]=u.useState(null),t=u.useRef(null),s=u.useRef(null),d=$=>Ee($,o)||"",r=i.some($=>$===null),y=$=>{const X=i.findIndex(ee=>ee===null);if(X!==-1&&(J($,X),!P.some(ee=>ee.name===$.name))){const ee=[$,...P.slice(0,7)];U(ee)}},v=R.comparisonItems.filter($=>$.selectedCategories&&$.selectedCategories.some(X=>Je.includes(X))).filter($=>{const X=f.length===0||$.selectedCategories&&$.selectedCategories.some(te=>f.includes(te)),ee=!L||$.name&&$.name.toLowerCase().includes(L.toLowerCase())||$.subType&&$.subType.toLowerCase().includes(L.toLowerCase());return X&&ee}),T=[...v].sort(($,X)=>{if(j==="name")return $.name.localeCompare(X.name);{const ee=$.selectedCategories&&$.selectedCategories[0]||"",te=X.selectedCategories&&X.selectedCategories[0]||"",de=ee.localeCompare(te);return de!==0?de:$.name.localeCompare(X.name)}}),b=$=>{S(X=>X.includes($)?X.filter(ee=>ee!==$):[...X,$])},D=()=>{S([]),C(""),O("name"),A(!1)},J=($,X)=>{const ee=[...i];ee[X]=$,h(ee),a(null)},B=$=>{const X=[...i];X[$]=null,h(X),a(null)},G=($,X)=>{t.current=X,$.dataTransfer.effectAllowed="move",setTimeout(()=>{$.currentTarget.classList.add("opacity-50")},0)},K=$=>{t.current=null,s.current=null,$.currentTarget.classList.remove("opacity-50")},ie=($,X)=>{$.preventDefault(),s.current=X},E=($,X)=>{if($.preventDefault(),t.current&&(J(t.current,X),!P.some(ee=>ee.name===t.current.name))){const ee=[t.current,...P.slice(0,7)];U(ee)}t.current=null,s.current=null},V=()=>{h([null,null,null]),a(null)},c=()=>{x(!0),setTimeout(()=>{const $=i.filter(ee=>ee!==null),X=g($);if(X)a({...X.result,isSuccess:!0});else{const ee=W($),te=o.mixingSystem.spoiledFood.find(de=>de.type===ee);a({name:(te==null?void 0:te.name)||"Испорченная еда",imageId:(te==null?void 0:te.imageId)||"",foodType:ee,isSuccess:!1,description:(te==null?void 0:te.description)||"Что-то пошло не так..."})}x(!1)},1500)},F=$=>{if(!$.selectedCategories||$.selectedCategories.length===0)return null;const X=M==="grid"?$.selectedCategories.slice(0,2):$.selectedCategories;return e.jsxs("div",{className:"flex flex-wrap gap-1 mt-1 justify-center",children:[X.map(ee=>e.jsx("span",{className:"text-xs px-1.5 py-0.5 bg-blue-900/40 text-blue-300 rounded-full",children:ee},ee)),M==="grid"&&$.selectedCategories.length>2&&e.jsxs("span",{className:"text-xs px-1.5 py-0.5 bg-gray-700 text-gray-400 rounded-full",children:["+",$.selectedCategories.length-2]})]})},g=$=>{if($.length===0)return null;const X=$.map(ee=>ee.name).sort();return o.mixingSystem.recipes.find(ee=>{const te=ee.ingredients.map(de=>de.name).sort();return X.length!==te.length?!1:X.every((de,Ce)=>de===te[Ce])})},W=$=>{const X=$.some(te=>{var de;return((de=te.selectedCategories)==null?void 0:de.includes("Мясо"))||te.subType==="Мясной"||te.name&&te.name.toLowerCase().includes("мясо")}),ee=$.some(te=>{var de;return((de=te.selectedCategories)==null?void 0:de.includes("Рыба"))||te.subType==="Рыбный"||te.name&&te.name.toLowerCase().includes("рыба")});return X?"meat":ee?"fish":"general"},z=($,X)=>Z!==X?null:e.jsx("div",{className:"absolute right-0 mt-10 bg-gray-800 border border-gray-700 rounded shadow-lg z-10",children:e.jsx("ul",{children:i.map((ee,te)=>e.jsx("li",{children:e.jsx("button",{onClick:()=>{J($,te),n(null)},disabled:ee!==null,className:`w-full text-left px-4 py-2 ${ee===null?"hover:bg-gray-700 text-gray-200":"text-gray-500 cursor-not-allowed"}`,children:ee===null?`Добавить в слот ${te+1}`:`Слот ${te+1} занят`})},te))})}),Y=i.some($=>$!==null);return u.useEffect(()=>{const $=()=>{n(null)};return document.addEventListener("mousedown",$),()=>{document.removeEventListener("mousedown",$)}},[]),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-gray-800 border border-gray-700 p-4 rounded-lg shadow",children:[e.jsx("h2",{className:"text-lg font-semibold mb-4 text-gray-100",children:"Тестирование станции смешивания"}),e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h3",{className:"text-md font-medium text-gray-200",children:"Ингредиенты"}),e.jsx("button",{onClick:V,className:`text-xs px-2 py-1 text-red-400 border border-red-500 rounded hover:bg-red-500 hover:text-white transition-colors ${Y?"":"opacity-50 cursor-not-allowed"}`,disabled:!Y,children:"Очистить все"})]}),e.jsx("div",{className:"flex flex-col space-y-6",children:i.map(($,X)=>e.jsxs("div",{className:`relative aspect-[3/1] border-2 ${$?"border-solid border-blue-600/40":"border-dashed"} rounded-lg flex items-center justify-center overflow-hidden p-4
                ${s.current===X?"border-blue-500 bg-blue-900/20":"dark:border-gray-600"}
                `,onDragOver:ee=>ie(ee,X),onDrop:ee=>E(ee,X),children:[e.jsx("div",{className:"absolute left-0 top-0 p-2",children:e.jsx("div",{className:"w-8 h-8 bg-blue-500 rounded-full flex items-center justify-center shadow-lg",children:e.jsx("span",{className:"text-white text-base font-bold",children:X+1})})}),$?e.jsxs("div",{className:"flex w-full h-full pl-10",children:[e.jsx("div",{className:"flex-shrink-0 flex items-center",children:$.imageId?e.jsx("div",{className:"w-16 h-16 mr-4",children:e.jsx("img",{src:d($.imageId),alt:$.name,className:"w-full h-full object-cover rounded shadow-md"})}):e.jsx("div",{className:"w-16 h-16 mr-4 bg-gray-700 rounded-lg flex items-center justify-center",children:e.jsx("span",{className:"text-xs text-gray-500",children:"Нет изображения"})})}),e.jsxs("div",{className:"flex-1 flex flex-col justify-center mr-8",children:[e.jsx("p",{className:"font-semibold text-gray-100 text-base mb-1 truncate",children:$.name}),$.subType&&e.jsx("p",{className:"text-xs text-gray-400 mb-1",children:$.subType}),e.jsx("div",{className:"flex flex-wrap gap-1",children:$.selectedCategories&&$.selectedCategories.map(ee=>e.jsx("span",{className:"text-xs px-1.5 py-0.5 bg-blue-900/40 text-blue-300 rounded-full",children:ee},ee))})]}),e.jsx("div",{className:"flex-shrink-0 flex items-center",children:e.jsx("button",{onClick:()=>B(X),className:"bg-red-500/20 hover:bg-red-500/40 text-red-300 w-8 h-8 rounded-full flex items-center justify-center",children:"×"})})]}):e.jsx("div",{className:"flex items-center justify-center w-full h-full pl-8",children:e.jsx("span",{className:"text-gray-500",children:"Пустой слот"})})]},X))})]}),e.jsx("div",{className:"mb-4 text-center",children:e.jsx("button",{onClick:c,disabled:!Y||k,className:`px-6 py-3 rounded-lg font-semibold ${Y&&!k?"bg-primary text-white hover:bg-opacity-90":"bg-gray-700 text-gray-500 cursor-not-allowed"}`,children:k?"Смешивание...":"Смешать ингредиенты"})}),w&&e.jsxs("div",{className:"mt-6 p-4 border rounded-lg dark:border-gray-700",children:[e.jsx("h3",{className:"text-lg font-medium mb-2 text-gray-100",children:"Результат:"}),e.jsxs("div",{className:"flex flex-col md:flex-row items-center space-y-4 md:space-y-0 md:space-x-4",children:[e.jsx("div",{className:"w-24 h-24 bg-gray-700 rounded-lg flex items-center justify-center",children:w.imageId?e.jsx("img",{src:d(w.imageId),alt:w.name,className:"w-full h-full object-cover rounded-lg"}):e.jsx("span",{className:"text-gray-500 text-sm text-center px-2",children:"Нет изображения"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-semibold text-lg text-gray-100",children:w.name}),e.jsx("p",{className:`text-sm ${w.isSuccess?"text-green-400":"text-red-400"}`,children:w.isSuccess?"Успешно приготовлено!":"Испорчено!"}),w.description&&e.jsx("p",{className:"mt-2 text-sm text-gray-300",children:w.description})]})]})]})]}),e.jsxs("div",{className:"bg-gray-800 border border-gray-700 p-4 rounded-lg shadow",children:[e.jsx("h2",{className:"text-lg font-semibold mb-4 text-gray-100",children:"Доступные ингредиенты"}),e.jsxs("div",{className:"mb-2 text-xs text-gray-400",children:["Разрешены категории: ",Je.join(", ")]}),e.jsxs("div",{className:"mb-4 space-y-3",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx("input",{type:"text",value:L,onChange:$=>C($.target.value),placeholder:"Поиск ингредиентов...",className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded text-gray-200 placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-primary"}),L&&e.jsx("button",{onClick:()=>C(""),className:"absolute right-2 top-2 text-gray-400 hover:text-gray-200",children:"×"})]}),e.jsxs("div",{className:"flex border border-gray-600 rounded overflow-hidden",children:[e.jsx("button",{onClick:()=>N("list"),className:`px-2 py-1 ${M==="list"?"bg-blue-600 text-white":"bg-gray-700 text-gray-300"}`,title:"Список",children:"☰"}),e.jsx("button",{onClick:()=>N("grid"),className:`px-2 py-1 ${M==="grid"?"bg-blue-600 text-white":"bg-gray-700 text-gray-300"}`,title:"Сетка",children:"▦"})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-2 items-center",children:[e.jsx("span",{className:"text-sm text-gray-300",children:"Фильтры:"}),e.jsx("div",{className:"flex items-center",children:e.jsx("button",{onClick:()=>A(!I),className:`px-2 py-1 text-xs rounded ${I?"bg-blue-600 text-white":"bg-gray-700 text-gray-200 hover:bg-gray-600"}`,children:"Недавние"})}),e.jsxs("div",{className:"flex items-center ml-2",children:[e.jsx("span",{className:"text-sm text-gray-300 mr-1",children:"Сортировка:"}),e.jsxs("select",{value:j,onChange:$=>O($.target.value),className:"bg-gray-700 border border-gray-600 rounded text-gray-200 text-sm py-1",children:[e.jsx("option",{value:"name",children:"По имени"}),e.jsx("option",{value:"category",children:"По категории"})]})]}),(f.length>0||L||I)&&e.jsx("button",{onClick:D,className:"px-2 py-1 text-xs bg-red-500/40 text-red-300 rounded hover:bg-red-500/60",children:"Сбросить"})]}),e.jsx("div",{className:"flex flex-wrap gap-1",children:Je.map($=>e.jsx("button",{onClick:()=>b($),className:`px-2 py-1 text-xs rounded ${f.includes($)?"bg-blue-600 text-white":"bg-gray-700 text-gray-200 hover:bg-gray-600"}`,children:$},$))})]}),I&&P.length>0&&e.jsxs("div",{className:"mb-4",children:[e.jsx("h3",{className:"text-md font-medium mb-2 text-gray-200",children:"Недавно использованные"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:P.map(($,X)=>e.jsxs("div",{className:"bg-gray-700 rounded p-2 flex items-center cursor-pointer hover:bg-gray-600",onClick:()=>y($),children:[$.imageId&&e.jsx("img",{src:d($.imageId),alt:$.name,className:"w-6 h-6 object-cover rounded mr-1"}),e.jsx("span",{className:"text-sm text-gray-200",children:$.name})]},X))})]}),M==="list"?e.jsx("div",{className:"max-h-[500px] overflow-y-auto border border-gray-700 rounded",children:v.length===0?e.jsx("div",{className:"p-4 text-center text-gray-400",children:"Ничего не найдено"}):T.map(($,X)=>e.jsx("div",{className:"p-3 border-b border-gray-700 hover:bg-gray-700 transition-colors",draggable:!0,onDragStart:ee=>G(ee,$),onDragEnd:K,children:e.jsxs("div",{className:"flex items-center",children:[$.imageId?e.jsx("div",{className:"w-10 h-10 mr-3 flex-shrink-0",children:e.jsx("img",{src:d($.imageId),alt:$.name,className:"w-full h-full object-cover rounded"})}):e.jsx("div",{className:"w-10 h-10 mr-3 bg-gray-700 rounded flex items-center justify-center flex-shrink-0",children:e.jsx("span",{className:"text-xs text-gray-500",children:"Нет"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-gray-200",children:$.name}),F($),$.subType&&e.jsx("span",{className:"text-xs text-gray-400",children:$.subType})]}),e.jsx("div",{className:"relative",children:r?e.jsx("button",{onClick:()=>y($),className:"px-3 py-1 bg-blue-500 text-white rounded hover:bg-blue-600",children:"Добавить"}):e.jsxs("div",{className:"relative",children:[e.jsx("button",{onClick:ee=>{ee.stopPropagation(),n(X)},className:"px-3 py-1 bg-blue-500 text-white rounded hover:bg-blue-600",children:"Выбрать слот"}),z($,X)]})})]})},X))}):e.jsx("div",{className:"max-h-[500px] overflow-y-auto",children:v.length===0?e.jsx("div",{className:"p-4 text-center text-gray-400",children:"Ничего не найдено"}):e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 gap-2",children:T.map(($,X)=>e.jsx("div",{className:"p-2 border border-gray-700 rounded-lg bg-gray-800 hover:bg-gray-700 transition-colors cursor-pointer",onClick:()=>r?y($):n(X),draggable:!0,onDragStart:ee=>G(ee,$),onDragEnd:K,children:e.jsxs("div",{className:"flex flex-col items-center",children:[$.imageId?e.jsx("div",{className:"w-16 h-16 mb-1",children:e.jsx("img",{src:d($.imageId),alt:$.name,className:"w-full h-full object-cover rounded"})}):e.jsx("div",{className:"w-16 h-16 mb-1 bg-gray-700 rounded flex items-center justify-center",children:e.jsx("span",{className:"text-xs text-gray-500",children:"Нет изображения"})}),e.jsx("p",{className:"text-sm text-center text-gray-200 truncate w-full",children:$.name}),$.subType&&e.jsx("p",{className:"text-xs text-center text-gray-400 truncate w-full",children:$.subType}),e.jsx("div",{className:"flex justify-center flex-wrap mt-1",children:F($)}),z($,X)]})},X))})})]})]})},Et=()=>{const{state:o,updateState:R}=xe(),{spoiledFood:i}=o.mixingSystem,[h,w]=u.useState(null),[a,k]=u.useState(""),[x,f]=u.useState(""),[S,L]=u.useState(""),C=P=>Ee(P,o)||"",M=P=>{const U=i.find(j=>j.type===P);U&&(w(P),k(U.name),f(U.imageId||""),L(U.description||""))},N=()=>{if(!h)return;const P=i.map(U=>U.type===h?{...U,name:a,imageId:x,description:S}:U);R("mixingSystem.spoiledFood",P),w(null),k(""),f(""),L("")},I=()=>{w(null),k(""),f(""),L("")},A=P=>{switch(P){case"meat":return"Мясная испорченная";case"fish":return"Рыбная испорченная";case"general":return"Обычная испорченная";default:return"Неизвестный тип"}};return e.jsxs("div",{className:"bg-white dark:bg-gray-800 p-4 rounded-lg shadow",children:[e.jsx("h2",{className:"text-lg font-semibold mb-4 text-gray-900 dark:text-gray-100",children:"Настройки испорченной еды"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:i.map(P=>e.jsxs("div",{className:"border rounded-lg p-4 dark:border-gray-700",children:[e.jsx("h3",{className:"font-medium text-center mb-2 text-gray-900 dark:text-gray-100",children:A(P.type)}),h===P.type?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm mb-1 text-gray-700 dark:text-gray-300",children:"Название"}),e.jsx("input",{type:"text",value:a,onChange:U=>k(U.target.value),className:"w-full px-3 py-2 border rounded bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 dark:border-gray-600"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm mb-1 text-gray-700 dark:text-gray-300",children:"Описание"}),e.jsx("textarea",{value:S,onChange:U=>L(U.target.value),className:"w-full px-3 py-2 border rounded bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 dark:border-gray-600",rows:3})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm mb-1 text-gray-700 dark:text-gray-300",children:"Изображение"}),e.jsx(Fe,{onUpload:U=>f(U)}),x&&e.jsx("div",{className:"mt-2 flex justify-center",children:e.jsx("img",{src:C(x),alt:a,className:"w-20 h-20 object-cover rounded"})})]}),e.jsxs("div",{className:"flex space-x-2 pt-2",children:[e.jsx("button",{onClick:N,className:"flex-1 px-4 py-2 bg-primary text-white rounded hover:bg-opacity-90",children:"Сохранить"}),e.jsx("button",{onClick:I,className:"flex-1 px-4 py-2 bg-gray-300 dark:bg-gray-700 text-gray-800 dark:text-gray-200 rounded hover:bg-opacity-90",children:"Отмена"})]})]}):e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"mb-2 flex justify-center",children:P.imageId?e.jsx("img",{src:C(P.imageId),alt:P.name,className:"w-24 h-24 object-cover rounded"}):e.jsx("div",{className:"w-24 h-24 bg-gray-200 dark:bg-gray-600 rounded flex items-center justify-center",children:e.jsx("span",{className:"text-gray-400 dark:text-gray-500",children:"Нет изображения"})})}),e.jsx("p",{className:"mb-2 text-gray-900 dark:text-gray-100",children:P.name||"Без названия"}),P.description&&e.jsx("p",{className:"mb-4 text-sm text-gray-600 dark:text-gray-400",children:P.description}),e.jsx("button",{onClick:()=>M(P.type),className:"px-4 py-2 bg-blue-500 hover:bg-blue-600 text-white rounded w-full transition",children:"Редактировать"})]})]},P.type))})]})};function $t(){const[o,R]=u.useState("recipes"),[i,h]=u.useState(null),w=f=>{console.log("Editing recipe with ID:",f),h(f),R("editor")},a=()=>{console.log("Creating new recipe"),h(null),R("editor")},k=()=>{console.log("Save complete, returning to recipes"),R("recipes")},x=()=>{const f=[{id:"recipes",label:"Рецепты"},{id:"editor",label:"Редактор"},{id:"simulator",label:"Тестирование"},{id:"spoiled",label:"Испорченная еда"}];return e.jsx("div",{className:"border-b border-gray-200 dark:border-gray-700",children:e.jsx("ul",{className:"flex flex-wrap -mb-px",children:f.map(S=>e.jsx("li",{className:"mr-2",children:e.jsx("button",{onClick:()=>{R(S.id),S.id!=="editor"&&h(null)},className:`inline-block p-4 border-b-2 rounded-t-lg ${o===S.id?"border-primary text-primary":"border-transparent hover:text-primary hover:border-primary"}`,children:S.label})},S.id))})})};return e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-md p-6",children:[e.jsx("h1",{className:"text-2xl font-bold mb-6",children:"Система Смешивания"}),e.jsx(x,{}),e.jsxs("div",{className:"mt-6",children:[o==="recipes"&&e.jsx(Mt,{onEditRecipe:w,onCreateRecipe:a}),o==="editor"&&e.jsx(Tt,{editingRecipeId:i,onSaveComplete:k}),o==="simulator"&&e.jsx(Ft,{}),o==="spoiled"&&e.jsx(Et,{})]})]})}const Dt=()=>{var x,f,S;const[o,R]=u.useState(""),[i,h]=u.useState("basics"),w={basics:{title:"Основы языка",items:[{name:"do",description:"Контейнер для выполнения последовательности действий.",syntax:`do
(
  // действия
)`,example:`do
(
  playdialog "100"
)`},{name:"condition",description:"Проверка условия для выполнения действий.",syntax:`condition
(
  // условие
) description "описание"`,example:`condition
(
  true
) description "Всегда истинно"`}]},actions:{title:"Действия",items:[{name:"playdialog",description:"Воспроизведение диалога с указанным идентификатором.",syntax:"playdialog <ID> [параметры]",example:'playdialog "100" starttime'},{name:"teleportnpcactortopoint",description:"Телепортация NPC в указанную локацию.",syntax:"teleportnpcactortopoint <NPC_ID> <точка_назначения>",example:'teleportnpcactortopoint "Guard_01" "Checkpoint"'},{name:"grant",description:"Предоставление награды или предмета игроку.",syntax:"grant <предмет>",example:'grant "gold_100"'},{name:"showpopup",description:"Отображение всплывающего окна с сообщением.",syntax:"showpopup <ID_сообщения>",example:'showpopup "quest_completed"'},{name:"showvfx",description:"Показать визуальный эффект.",syntax:"showvfx <ID_эффекта>",example:'showvfx "magic_glow"'},{name:"hidevfx",description:"Скрыть визуальный эффект.",syntax:"hidevfx <ID_эффекта>",example:'hidevfx "magic_glow"'},{name:"setdialogvariable",description:"Установка значения переменной диалога.",syntax:"setdialogvariable <имя_переменной> <значение>",example:'setdialogvariable "hasMetGuard" true'},{name:"givequest",description:"Выдача задания игроку.",syntax:"givequest <ID_задания>",example:'givequest "mainquest_01"'}]},conditions:{title:"Условия",items:[{name:"in",description:"Проверка наличия объекта в списке с возможными фильтрами.",syntax:"in <объект>([фильтры]) [N rows]",example:'in "inventory"() 1 rows'},{name:"isinrange",description:"Проверка, находится ли объект в пределах досягаемости.",syntax:"isinrange <объект>",example:'isinrange "NPC_Guard"'},{name:"Операторы сравнения",description:"Операторы для сравнения значений: ==, !=, <, >, <=, >=",syntax:"<значение1> <оператор> <значение2>",example:"questProgress > 5"},{name:"Логические операторы",description:"Операторы для комбинирования условий: and, or",syntax:"<условие1> and/or <условие2>",example:'isinrange "NPC_Guard" and questStatus == "active"'}]},values:{title:"Значения и константы",items:[{name:"starttime",description:"Время начала события или скрипта.",syntax:"starttime",example:'playdialog "intro" starttime'},{name:"blockstarttime",description:"Время начала текущего блока кода.",syntax:"blockstarttime",example:'playdialog "reminder" blockstarttime'},{name:"true/false",description:"Логические константы для условий.",syntax:"true / false",example:`condition
(
  true
)`},{name:"Строки",description:"Текстовые значения, заключенные в кавычки.",syntax:'"текст"',example:'"NPC_Guard", "PlayerHome"'},{name:"Числа",description:"Числовые значения для счетчиков, индексов и т.д.",syntax:"123, 45.67",example:'setdialogvariable "questProgress" 5'}]}},a=Object.entries(w).reduce((L,[C,M])=>{const N=M.items.filter(I=>I.name.toLowerCase().includes(o.toLowerCase())||I.description.toLowerCase().includes(o.toLowerCase()));return N.length>0&&(L[C]={title:M.title,items:N}),L},{}),k=Object.keys(o?a:w);return e.jsxs("div",{className:"bg-gray-800 rounded-lg p-4 mt-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h2",{className:"text-lg font-semibold text-white",children:"Справочник NeoRust"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",value:o,onChange:L=>R(L.target.value),placeholder:"Поиск...",className:"bg-gray-700 text-white p-2 pl-8 rounded w-64 focus:outline-none focus:ring-2 focus:ring-blue-500"}),e.jsx("svg",{className:"absolute left-2 top-2.5 w-4 h-4 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})]})]}),e.jsx("div",{className:"flex mb-4 border-b border-gray-700 overflow-x-auto",children:k.map(L=>e.jsx("button",{onClick:()=>h(L),className:`px-4 py-2 ${i===L?"text-white border-b-2 border-blue-500 font-medium":"text-gray-400 hover:text-white"}`,children:o?a[L].title:w[L].title},L))}),e.jsx("div",{className:"reference-content overflow-y-auto max-h-[500px]",children:k.length>0?e.jsx("div",{children:(S=o?(x=a[i])==null?void 0:x.items:(f=w[i])==null?void 0:f.items)==null?void 0:S.map((L,C)=>e.jsxs("div",{className:"mb-4 p-3 bg-gray-900 rounded",children:[e.jsx("h3",{className:"text-blue-400 font-semibold",children:L.name}),e.jsx("p",{className:"text-gray-300 text-sm mt-1",children:L.description}),e.jsxs("div",{className:"mt-2",children:[e.jsx("h4",{className:"text-xs text-gray-500 uppercase",children:"Синтаксис:"}),e.jsx("pre",{className:"mt-1 bg-gray-800 p-2 rounded text-green-300 text-sm overflow-x-auto",children:L.syntax})]}),e.jsxs("div",{className:"mt-2",children:[e.jsx("h4",{className:"text-xs text-gray-500 uppercase",children:"Пример:"}),e.jsx("pre",{className:"mt-1 bg-gray-800 p-2 rounded text-yellow-300 text-sm overflow-x-auto",children:L.example})]})]},C))}):e.jsx("div",{className:"text-center py-6 text-gray-400",children:"По вашему запросу ничего не найдено."})})]})},Lt=()=>{const o=u.useRef(null),[R,i]=u.useState(""),[h,w]=u.useState(!1),[a,k]=u.useState(null),[x,f]=u.useState("");u.useEffect(()=>{(()=>{if(document.getElementById("blockly-scripts")){w(!0);return}const s=document.createElement("div");s.id="blockly-scripts",document.body.appendChild(s);const d=["https://unpkg.com/blockly/blockly_compressed.js","https://unpkg.com/blockly/blocks_compressed.js","https://unpkg.com/blockly/javascript_compressed.js","https://unpkg.com/blockly/msg/en.js"];let r=0;d.forEach(y=>{const p=document.createElement("script");p.src=y,p.async=!1,p.onload=()=>{r++,r===d.length&&(console.log("Все скрипты Blockly загружены!"),w(!0))},p.onerror=v=>{console.error("Ошибка загрузки скрипта:",y,v)},s.appendChild(p)})})()},[]),u.useEffect(()=>{if(!h)return;const t=document.createElement("div");t.style.display="none",document.body.appendChild(t);const s=document.createElement("xml");s.id="toolbox";const d=(b,D,J)=>{const B=document.createElement("category");return B.setAttribute("name",b),B.setAttribute("colour",D),J.forEach(G=>{const K=document.createElement("block");K.setAttribute("type",G),B.appendChild(K)}),B},r=d("Структура","#5D5CDE",["do_action","condition_block"]),y=d("Действия","#3B82F6",["grant","showpopup","showvfx","hidevfx","givequest","teleportnpcactortopoint_dual","playdialog_with_params","setdialogvariable_dual","playdialog","setdialogvariable","teleportnpcactortopoint"]),p=d("Условия","#8B5CF6",["in_condition","isinrange_condition","logic_compare","logic_operation"]),v=d("Значения","#10B981",["text","math_number","starttime_constant","blockstarttime_constant","true_constant","false_constant"]),T=d("Вспомогательные","#64748B",["key_value_pair"]);s.appendChild(r),s.appendChild(y),s.appendChild(p),s.appendChild(v),s.appendChild(T),t.appendChild(s)},[h]),u.useEffect(()=>{if(!(!h||!o.current))try{I();const t=document.getElementById("toolbox"),s=window.Blockly.inject(o.current,{toolbox:t,theme:S(),grid:{spacing:25,length:1,colour:"#32374a",snap:!0},zoom:{controls:!0,wheel:!0,startScale:.9,maxScale:3,minScale:.3,scaleSpeed:1.1},trashcan:!0});k(s),s.addChangeListener(()=>{try{const d=[],r=L(s,d),y=M(r);i(y),f(d.join(`
`))}catch(d){console.error("Ошибка генерации кода:",d),f(`Ошибка: ${d instanceof Error?d.message:"Неизвестная ошибка"}
${d instanceof Error?d.stack:""}`)}})}catch(t){console.error("Ошибка инициализации Blockly:",t)}},[h]);const S=()=>window.Blockly.Theme.defineTheme("dark",{base:window.Blockly.Themes.Classic,componentStyles:{workspaceBackgroundColour:"#1a1d29",toolboxBackgroundColour:"#252836",flyoutBackgroundColour:"#252836",toolboxForegroundColour:"#ddd",flyoutForegroundColour:"#ddd",scrollbarColour:"#32374a",scrollbarOpacity:.5}}),L=(t,s=[])=>{const d=t.getTopBlocks(!0);s.push(`Найдено ${d.length} верхних блоков`);const r=[],y=new Set;return d.forEach((p,v)=>{s.push(`Анализ верхнего блока #${v+1}: ${p.type}`);const T=C(p,0,s,y);T&&r.push(T)}),r},C=(t,s=0,d=[],r=new Set)=>{if(!t)return null;const y="  ".repeat(s);if(r.has(t.id))return d.push(`${y}Блок с ID ${t.id} уже был обработан, пропускаем`),null;r.add(t.id);const p=t.type;d.push(`${y}Блок типа: ${p}, ID: ${t.id}`);const v={id:t.id,type:p,inputs:{},next:null,fields:{}},T=t.inputList.reduce((D,J)=>(J.fieldRow.forEach(B=>{B.name&&(D[B.name]=B.getValue())}),D),{});v.fields=T,d.push(`${y}Поля: ${JSON.stringify(T)}`),t.inputList.forEach(D=>{const J=D.name;if(D.connection&&D.connection.targetBlock()){const B=D.connection.targetBlock();if(d.push(`${y}Вход "${J}" соединен с блоком типа: ${B.type}`),D.type===1)v.inputs[J]=C(B,s+1,d,r);else if(D.type===3){const G=[];let K=B;for(;K;){d.push(`${y}  Блок в statement ${J}: ${K.type}`);const ie=C(K,s+1,d,r);ie&&G.push(ie),K=K.getNextBlock()}v.inputs[J]=G}}else d.push(`${y}Вход "${J}" не имеет соединения`)});const b=t.getNextBlock();return b&&(d.push(`${y}Следующий блок: ${b.type}`),v.next=C(b,s,d,r)),v},M=t=>{let s="";const d=new Set;return t.forEach(r=>{d.has(r.id)||(s+=N(r,0,d))}),s},N=(t,s=0,d=new Set)=>{if(!t||d.has(t.id))return"";d.add(t.id);const r="  ".repeat(s);let y="";switch(t.type){case"do_action":{y+=`${r}do
${r}(
`,t.inputs.ACTIONS&&Array.isArray(t.inputs.ACTIONS)&&t.inputs.ACTIONS.length>0&&t.inputs.ACTIONS.forEach(p=>{y+=N(p,s+1,d)}),y+=`${r})
`;break}case"condition_block":{y+=`${r}condition
${r}(
`,t.inputs.CONDITION?y+=`${r}  ${N(t.inputs.CONDITION,s+2,d)}`:y+=`${r}  true`,y+=`
${r})`,t.fields.DESCRIPTION&&(y+=` description "${t.fields.DESCRIPTION}"`),y+=`
`;break}case"in_condition":{let p='""';t.inputs.OBJECT&&(p=N(t.inputs.OBJECT,0,d)),y=`in ${p}(`,t.inputs.FILTERS&&Array.isArray(t.inputs.FILTERS)&&t.inputs.FILTERS.length>0&&(y+=`
`,t.inputs.FILTERS.forEach(v=>{y+=N(v,s+1,d)})),y+=")",t.fields.ROWS&&parseInt(t.fields.ROWS)>0&&(y+=` ${t.fields.ROWS} rows`);break}case"isinrange_condition":{let p='""';t.inputs.OBJECT&&(p=N(t.inputs.OBJECT,0,d)),y=`isinrange ${p}`;break}case"teleportnpcactortopoint_dual":{let p='""',v='""';t.inputs.NPC_ID&&(p=N(t.inputs.NPC_ID,0,d)),t.inputs.LOCATION&&(v=N(t.inputs.LOCATION,0,d)),y=`${r}teleportnpcactortopoint ${p} ${v}
`;break}case"playdialog_with_params":{let p='""',v="";t.inputs.DIALOG_ID&&(p=N(t.inputs.DIALOG_ID,0,d)),t.inputs.PARAMS&&(v=" "+N(t.inputs.PARAMS,0,d)),y=`${r}playdialog ${p}${v}
`;break}case"setdialogvariable_dual":{let p='""',v='""';t.inputs.VAR_NAME&&(p=N(t.inputs.VAR_NAME,0,d)),t.inputs.VALUE&&(v=N(t.inputs.VALUE,0,d)),y=`${r}setdialogvariable ${p} ${v}
`;break}case"key_value_pair":{let p='""',v='""';return t.inputs.KEY&&(p=N(t.inputs.KEY,0,d)),t.inputs.VALUE&&(v=N(t.inputs.VALUE,0,d)),`${p}=${v}`}case"true_constant":return"true";case"false_constant":return"false";case"starttime_constant":return"starttime";case"blockstarttime_constant":return"blockstarttime";case"text":return`"${t.fields.TEXT}"`;case"math_number":return t.fields.NUM.toString();default:if(["grant","playdialog","showpopup","showvfx","hidevfx","setdialogvariable","givequest","teleportnpcactortopoint"].includes(t.type)){let v='""';t.inputs.VALUE&&(v=N(t.inputs.VALUE,0,d)),y=`${r}${t.type} ${v}
`}}return t.next&&(y+=N(t.next,s,d)),y},I=()=>{const{Blockly:t}=window;t.Blocks.do_action={init:function(){this.appendDummyInput().appendField("do"),this.appendStatementInput("ACTIONS").setCheck(null),this.setPreviousStatement(!0,null),this.setNextStatement(!0,null),this.setColour("#5D5CDE"),this.setTooltip("Блок действий")}},t.Blocks.condition_block={init:function(){this.appendDummyInput().appendField("condition"),this.appendValueInput("CONDITION").setCheck("Boolean"),this.appendDummyInput().appendField("description").appendField(new t.FieldTextInput(""),"DESCRIPTION"),this.setPreviousStatement(!0,null),this.setNextStatement(!0,null),this.setColour("#5D5CDE"),this.setTooltip("Блок условия")}},t.Blocks.in_condition={init:function(){this.appendValueInput("OBJECT").setCheck("String").appendField("in"),this.appendStatementInput("FILTERS").setCheck(null),this.appendDummyInput().appendField("rows").appendField(new t.FieldNumber(0,0),"ROWS"),this.setOutput(!0,"Boolean"),this.setColour("#8B5CF6"),this.setTooltip("Проверка наличия в списке объектов")}},t.Blocks.isinrange_condition={init:function(){this.appendValueInput("OBJECT").setCheck("String").appendField("isinrange"),this.setOutput(!0,"Boolean"),this.setColour("#8B5CF6"),this.setTooltip("Проверка нахождения рядом с объектом")}},t.Blocks.true_constant={init:function(){this.appendDummyInput().appendField("true"),this.setOutput(!0,"Boolean"),this.setColour("#10B981"),this.setTooltip("Логическая константа true")}},t.Blocks.false_constant={init:function(){this.appendDummyInput().appendField("false"),this.setOutput(!0,"Boolean"),this.setColour("#10B981"),this.setTooltip("Логическая константа false")}},t.Blocks.starttime_constant={init:function(){this.appendDummyInput().appendField("starttime"),this.setOutput(!0,null),this.setColour("#10B981"),this.setTooltip("Время начала события")}},t.Blocks.blockstarttime_constant={init:function(){this.appendDummyInput().appendField("blockstarttime"),this.setOutput(!0,null),this.setColour("#10B981"),this.setTooltip("Время начала текущего блока")}},["grant","showpopup","showvfx","hidevfx","givequest"].forEach(r=>{t.Blocks[r]={init:function(){this.appendValueInput("VALUE").setCheck(null).appendField(r),this.setPreviousStatement(!0,null),this.setNextStatement(!0,null),this.setColour("#3B82F6"),this.setTooltip(`Действие ${r}`)}}}),t.Blocks.teleportnpcactortopoint_dual={init:function(){this.appendDummyInput().appendField("teleportnpcactortopoint"),this.appendValueInput("NPC_ID").setCheck("String").appendField("NPC ID"),this.appendValueInput("LOCATION").setCheck("String").appendField("Локация"),this.setPreviousStatement(!0,null),this.setNextStatement(!0,null),this.setColour("#3B82F6"),this.setTooltip("Телепортирует NPC в указанную локацию")}},t.Blocks.playdialog_with_params={init:function(){this.appendDummyInput().appendField("playdialog"),this.appendValueInput("DIALOG_ID").setCheck(["Number","String"]).appendField("ID диалога"),this.appendValueInput("PARAMS").setCheck("String").appendField("Параметры").setAlign(t.ALIGN_RIGHT),this.setPreviousStatement(!0,null),this.setNextStatement(!0,null),this.setColour("#3B82F6"),this.setTooltip("Воспроизводит диалог с указанным ID и опциональными параметрами")}},t.Blocks.setdialogvariable_dual={init:function(){this.appendDummyInput().appendField("setdialogvariable"),this.appendValueInput("VAR_NAME").setCheck("String").appendField("Имя переменной"),this.appendValueInput("VALUE").setCheck(null).appendField("Значение"),this.setPreviousStatement(!0,null),this.setNextStatement(!0,null),this.setColour("#3B82F6"),this.setTooltip("Устанавливает значение переменной диалога")}},["playdialog","setdialogvariable","teleportnpcactortopoint"].forEach(r=>{t.Blocks[r]={init:function(){this.appendValueInput("VALUE").setCheck(null).appendField(r),this.setPreviousStatement(!0,null),this.setNextStatement(!0,null),this.setColour("#3B82F6"),this.setTooltip(`Действие ${r} (устаревший формат)`)}}}),t.Blocks.key_value_pair={init:function(){this.appendValueInput("KEY").setCheck("String").appendField("Ключ"),this.appendValueInput("VALUE").setCheck(null).appendField("Значение"),this.setOutput(!0,"KeyValuePair"),this.setColour("#64748B"),this.setTooltip("Пара ключ-значение для использования в параметрах")}}},A=()=>{const t=new Blob([R],{type:"text/plain"}),s=URL.createObjectURL(t),d=document.createElement("a");d.href=s,d.download="neorustscript.txt",d.click(),URL.revokeObjectURL(s)},P=()=>{if(a)try{let t,s;if(window.Blockly.Xml&&typeof window.Blockly.Xml.workspaceToDom=="function")console.log("Используем стандартный Blockly.Xml"),t=window.Blockly.Xml.workspaceToDom,s=window.Blockly.Xml.domToText;else if(window.Blockly.utils&&window.Blockly.utils.xml&&typeof window.Blockly.utils.xml.workspaceToDom=="function")console.log("Используем Blockly.utils.xml"),t=window.Blockly.utils.xml.workspaceToDom,s=window.Blockly.utils.xml.domToText;else throw new Error("Не удалось найти функции XML в API Blockly");const d=t(a),r=s(d),y=new Blob([r],{type:"application/xml"}),p=URL.createObjectURL(y),v=document.createElement("a");v.href=p,v.download="neorustscript.xml",v.click(),URL.revokeObjectURL(p)}catch(t){console.error("Ошибка при сохранении XML:",t),f(`Ошибка при сохранении XML: ${t instanceof Error?t.message:"Неизвестная ошибка"}
${t instanceof Error?t.stack:""}`)}},U=()=>{if(!a)return;const t=document.createElement("input");t.type="file",t.accept=".xml",t.onchange=s=>{var y;const d=(y=s.target.files)==null?void 0:y[0];if(!d)return;const r=new FileReader;r.onload=p=>{var v;try{const T=(v=p.target)==null?void 0:v.result;console.log("Загруженный XML:",T.substring(0,100)+"...");let b;window.Blockly.Xml&&typeof window.Blockly.Xml.textToDom=="function"?(console.log("Используем стандартный Blockly.Xml.textToDom"),b=window.Blockly.Xml.textToDom):window.Blockly.utils&&window.Blockly.utils.xml&&typeof window.Blockly.utils.xml.textToDom=="function"?(console.log("Используем Blockly.utils.xml.textToDom"),b=window.Blockly.utils.xml.textToDom):(console.log("Используем DOMParser для разбора XML"),b=B=>new DOMParser().parseFromString(B,"text/xml").documentElement);let D;if(window.Blockly.Xml&&typeof window.Blockly.Xml.domToWorkspace=="function")console.log("Используем стандартный Blockly.Xml.domToWorkspace"),D=window.Blockly.Xml.domToWorkspace;else if(window.Blockly.utils&&window.Blockly.utils.xml&&typeof window.Blockly.utils.xml.domToWorkspace=="function")console.log("Используем Blockly.utils.xml.domToWorkspace"),D=window.Blockly.utils.xml.domToWorkspace;else throw new Error("Не удалось найти функцию domToWorkspace в API Blockly");const J=b(T);console.log("Разобранный DOM:",J),a.clear(),D(J,a),setTimeout(()=>{const B=[],G=L(a,B),K=M(G);i(K),f(B.join(`
`))},100)}catch(T){console.error("Ошибка при загрузке файла:",T),f(`Ошибка при загрузке XML: ${T instanceof Error?T.message:"Неизвестная ошибка"}
${T instanceof Error?T.stack:""}`)}},r.readAsText(d)},t.click()},j=()=>{if(a)try{const t=[],s=L(a,t),d=M(s);i(d),f(t.join(`
`))}catch(t){console.error("Ошибка при обновлении кода:",t)}},O=()=>{a&&(a.clear(),i(""),f(""))},[Z,n]=u.useState(!1);return e.jsxs("div",{className:"bg-gray-900 p-5 min-h-screen",children:[e.jsxs("div",{className:"flex flex-col mb-4",children:[e.jsx("h1",{className:"text-xl font-semibold text-white mb-2",children:"NeoRust Script Editor"}),e.jsx("p",{className:"text-gray-400 text-sm mb-4",children:"Визуальный редактор для создания скриптов на языке NeoRust. Используйте блоки для построения логики квестов, событий и диалогов без необходимости писать код вручную."}),e.jsxs("div",{className:"flex flex-wrap gap-2 mb-2",children:[e.jsx("button",{onClick:P,className:"px-3 py-1.5 bg-blue-600 hover:bg-blue-700 text-white rounded text-sm",children:"Сохранить XML"}),e.jsx("button",{onClick:U,className:"px-3 py-1.5 bg-green-600 hover:bg-green-700 text-white rounded text-sm",children:"Загрузить XML"}),e.jsx("button",{onClick:A,className:"px-3 py-1.5 bg-purple-600 hover:bg-purple-700 text-white rounded text-sm",children:"Экспорт кода"}),e.jsx("button",{onClick:j,className:"px-3 py-1.5 bg-yellow-600 hover:bg-yellow-700 text-white rounded text-sm",children:"Обновить код"}),e.jsx("button",{onClick:O,className:"px-3 py-1.5 bg-red-600 hover:bg-red-700 text-white rounded text-sm",children:"Очистить"}),e.jsx("button",{onClick:()=>n(!Z),className:"px-3 py-1.5 bg-gray-600 hover:bg-gray-700 text-white rounded text-sm",children:Z?"Скрыть отладку":"Показать отладку"})]})]}),e.jsxs("div",{className:"flex flex-col md:flex-row gap-4",style:{height:Z?"auto":"70vh"},children:[e.jsx("div",{className:"flex-1 bg-[#171923] border border-gray-700 rounded-lg overflow-hidden",style:{height:"70vh"},children:e.jsx("div",{ref:o,className:"w-full h-full"})}),e.jsxs("div",{className:"md:w-1/3 flex flex-col",children:[e.jsx("div",{className:"bg-gray-800 rounded-t-lg p-2 text-white font-medium",children:"Сгенерированный код"}),e.jsx("textarea",{value:R,readOnly:!0,className:"w-full h-[calc(70vh-40px)] p-3 font-mono text-sm text-gray-300 bg-gray-800 rounded-b-lg resize-none border-none focus:outline-none",placeholder:"Здесь появится сгенерированный код..."}),Z&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"bg-gray-800 rounded-t-lg p-2 text-white font-medium mt-4",children:"Отладочная информация"}),e.jsx("textarea",{value:x,readOnly:!0,className:"w-full h-64 p-3 font-mono text-xs text-gray-300 bg-gray-800 rounded-b-lg resize-none border-none focus:outline-none"})]})]})]}),e.jsx(Dt,{})]})};function At(){const{currentConfig:o,updateConfig:R}=je(),[i,h]=u.useState({baseTimesByComplexity:{"Очень легко":20,Легко:30,Средне:45,Сложно:60,"Очень сложно":90},ingredientBaseTime:3,ingredientScalingFactor:.7,levelMultiplier:.2,categoryTimeMultipliers:{}});u.useEffect(()=>{if(o.craftTimeConfig)h(o.craftTimeConfig);else{const C={};Object.keys(o.categories||{}).forEach(N=>{C[N]=1});const M={baseTimesByComplexity:{"Очень легко":20,Легко:30,Средне:45,Сложно:60,"Очень сложно":90},ingredientBaseTime:3,ingredientScalingFactor:.7,levelMultiplier:.2,categoryTimeMultipliers:C};h(M),R({craftTimeConfig:M})}},[o.id]);const w=u.useCallback(()=>{console.log("Scheduling debounced update for craftTimeConfig");const C=setTimeout(()=>{console.log("Applying delayed craftTimeConfig update with new version"),R({craftTimeConfig:{...i,version:Date.now()}})},500);return()=>{console.log("Clearing previous craftTimeConfig update timeout"),clearTimeout(C)}},[i,R]);u.useEffect(()=>{if(Object.keys(i).length>0)return w()},[i,w]);const a=(C,M)=>{const N=parseInt(M);isNaN(N)||N<0||h(I=>({...I,baseTimesByComplexity:{...I.baseTimesByComplexity,[C]:N}}))},k=C=>{const M=parseFloat(C);isNaN(M)||M<0||h(N=>({...N,ingredientBaseTime:M}))},x=C=>{const M=parseFloat(C);isNaN(M)||M<0||M>2||h(N=>({...N,ingredientScalingFactor:M}))},f=C=>{const M=parseFloat(C);isNaN(M)||M<-.5||M>.5||h(N=>({...N,levelMultiplier:M}))},S=(C,M)=>{const N=parseFloat(M);isNaN(N)||N<0||h(I=>({...I,categoryTimeMultipliers:{...I.categoryTimeMultipliers,[C]:N}}))},L=()=>{console.log("Manually applying craftTimeConfig changes"),R({craftTimeConfig:{...i,version:Date.now()}})};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700 p-4 rounded-lg",children:[e.jsx("h2",{className:"text-lg font-semibold mb-4",children:"Base Crafting Time by Complexity"}),e.jsx("div",{className:"space-y-3",children:Object.entries(i.baseTimesByComplexity).map(([C,M])=>e.jsxs("div",{className:"flex items-center",children:[e.jsx("label",{className:"w-1/2 text-sm",children:C}),e.jsxs("div",{className:"w-1/2 flex items-center",children:[e.jsx("input",{type:"number",value:M,onChange:N=>a(C,N.target.value),min:"1",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-800"}),e.jsx("span",{className:"ml-2 text-sm",children:"sec"})]})]},C))})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700 p-4 rounded-lg",children:[e.jsx("h2",{className:"text-lg font-semibold mb-4",children:"Ingredient Processing Parameters"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("label",{className:"w-1/2 text-sm",children:"Base Time per Ingredient"}),e.jsxs("div",{className:"w-1/2 flex items-center",children:[e.jsx("input",{type:"number",value:i.ingredientBaseTime,onChange:C=>k(C.target.value),min:"0",step:"0.5",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-800"}),e.jsx("span",{className:"ml-2 text-sm",children:"sec"})]})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("label",{className:"w-1/2 text-sm",children:"Quantity Scaling Factor"}),e.jsx("input",{type:"number",value:i.ingredientScalingFactor,onChange:C=>x(C.target.value),min:"0",max:"2",step:"0.1",className:"w-1/2 px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-800"})]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"1 = linear scaling, < 1 = diminishing returns"})]})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700 p-4 rounded-lg",children:[e.jsx("h2",{className:"text-lg font-semibold mb-4",children:"Recipe Level Impact"}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("label",{className:"w-1/2 text-sm",children:"Level Multiplier"}),e.jsx("input",{type:"number",value:i.levelMultiplier,onChange:C=>f(C.target.value),min:"-0.5",max:"0.5",step:"0.01",className:"w-1/2 px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-800"})]}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Positive value = more time with each level",e.jsx("br",{}),"Negative value = less time with each level"]})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700 p-4 rounded-lg",children:[e.jsx("h2",{className:"text-lg font-semibold mb-4",children:"Time Multipliers by Category"}),e.jsx("div",{className:"space-y-3",children:Object.entries(i.categoryTimeMultipliers||{}).map(([C,M])=>e.jsxs("div",{className:"flex items-center",children:[e.jsx("label",{className:"w-1/2 text-sm",children:C}),e.jsx("input",{type:"number",value:M,onChange:N=>S(C,N.target.value),min:"0.1",max:"5",step:"0.1",className:"w-1/2 px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-800"})]},C))})]}),e.jsx("div",{className:"flex justify-end mt-4",children:e.jsx("button",{onClick:L,className:"px-4 py-2 bg-blue-600 dark:bg-blue-500 text-white rounded-md hover:bg-blue-700 dark:hover:bg-blue-600 transition",children:"Apply Changes"})})]})}const Vt=()=>{const{currentConfig:o,updateConfig:R,setCurrentSeason:i}=je(),[h,w]=u.useState(""),[a,k]=u.useState(null),[x,f]=u.useState(null),S=o.seasons||["Весна","Лето","Осень","Зима"],L=o.currentSeason||S[0],C=()=>{if(!h.trim())return;if(S.includes(h)){alert(`Сезон "${h}" уже существует`);return}const j=[...S,h],O={...o.seasonalCategoryModifiers||{}};Object.keys(o.categories).forEach(n=>{O[n]||(O[n]={}),O[n][h]=1});const Z={...o.seasonalSubTypeModifiers||{}};o.subTypeModifiers&&Object.keys(o.subTypeModifiers).forEach(n=>{Z[n]||(Z[n]={}),Z[n][h]=1}),R({seasons:j,seasonalCategoryModifiers:O,seasonalSubTypeModifiers:Z}),w("")},M=j=>{if(S.length<=1){alert("Должен оставаться хотя бы один сезон");return}if(L===j){alert("Нельзя удалить текущий сезон. Сначала переключитесь на другой сезон.");return}const O=S.filter(t=>t!==j),Z={...o.seasonalCategoryModifiers||{}};Object.keys(Z).forEach(t=>{if(Z[t][j]){const{[j]:s,...d}=Z[t];Z[t]=d}});const n={...o.seasonalSubTypeModifiers||{}};Object.keys(n).forEach(t=>{if(n[t][j]){const{[j]:s,...d}=n[t];n[t]=d}}),R({seasons:O,seasonalCategoryModifiers:Z,seasonalSubTypeModifiers:n})},N=j=>{i(j)},I=(j,O,Z)=>{const n={...o.seasonalCategoryModifiers||{}};n[j]||(n[j]={}),n[j][O]=Z,R({seasonalCategoryModifiers:n})},A=(j,O,Z)=>{const n={...o.seasonalSubTypeModifiers||{}};n[j]||(n[j]={}),n[j][O]=Z,R({seasonalSubTypeModifiers:n})},P=Object.keys(o.categories||{}),U=Object.keys(o.subTypeModifiers||{});return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-sm p-4",children:[e.jsx("h2",{className:"text-lg font-semibold mb-4",children:"Управление сезонами"}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Текущий сезон"}),e.jsx("select",{value:L||"",onChange:j=>{const O=j.target.value;N(O)},className:"w-full px-3 py-2 border border-gray-600 dark:border-gray-700 rounded-md bg-gray-100 dark:bg-gray-800 text-gray-900 dark:text-gray-100",children:S.map(j=>e.jsx("option",{value:j,children:j},j))})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Добавить новый сезон"}),e.jsxs("div",{className:"flex",children:[e.jsx("input",{type:"text",value:h,onChange:j=>w(j.target.value),placeholder:"Название сезона",className:"flex-1 px-3 py-2 border border-gray-600 dark:border-gray-700 rounded-md bg-gray-100 dark:bg-gray-800 text-gray-900 dark:text-gray-100"}),e.jsx("button",{onClick:C,className:"px-4 py-2 bg-primary text-white rounded-r-md hover:bg-opacity-90",children:"Добавить"})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium mb-2",children:"Список сезонов"}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-2",children:S.map(j=>e.jsxs("div",{className:"flex items-center justify-between border border-gray-300 dark:border-gray-600 rounded-md p-2",children:[e.jsx("span",{children:j}),e.jsx("button",{onClick:()=>M(j),className:"text-red-500 hover:text-red-700",disabled:j===L,title:j===L?"Нельзя удалить текущий сезон":"Удалить сезон",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z",clipRule:"evenodd"})})})]},j))})]})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-sm p-4",children:[e.jsx("h2",{className:"text-lg font-semibold mb-4",children:"Сезонные модификаторы категорий"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-300 dark:divide-gray-600",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"py-2 text-left",children:"Категория"}),S.map(j=>e.jsx("th",{className:"py-2 text-center",children:j},j)),e.jsx("th",{className:"py-2"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200 dark:divide-gray-700",children:P.map(j=>e.jsxs("tr",{children:[e.jsx("td",{className:"py-2",children:j}),S.map(O=>{var n,t;const Z=((t=(n=o.seasonalCategoryModifiers)==null?void 0:n[j])==null?void 0:t[O])||1;return e.jsx("td",{className:"py-2 text-center",children:a===j?e.jsx("input",{type:"number",value:Z,onChange:s=>I(j,O,parseFloat(s.target.value)),step:"0.05",min:"0.1",max:"5",className:"w-16 px-2 py-1 border border-gray-300 dark:border-gray-600 rounded"}):e.jsxs("span",{className:Z!==1?"font-bold":"",children:[Z.toFixed(2),"×"]})},O)}),e.jsx("td",{className:"py-2 text-right",children:e.jsx("button",{onClick:()=>k(a===j?null:j),className:`px-3 py-1 rounded ${a===j?"bg-green-500 text-white":"bg-blue-500 text-white"}`,children:a===j?"Готово":"Изменить"})})]},j))})]})})]}),U.length>0&&e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-sm p-4",children:[e.jsx("h2",{className:"text-lg font-semibold mb-4",children:"Сезонные модификаторы подтипов"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-300 dark:divide-gray-600",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"py-2 text-left",children:"Подтип"}),S.map(j=>e.jsx("th",{className:"py-2 text-center",children:j},j)),e.jsx("th",{className:"py-2"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200 dark:divide-gray-700",children:U.map(j=>e.jsxs("tr",{children:[e.jsx("td",{className:"py-2",children:j}),S.map(O=>{var n,t;const Z=((t=(n=o.seasonalSubTypeModifiers)==null?void 0:n[j])==null?void 0:t[O])||1;return e.jsx("td",{className:"py-2 text-center",children:x===j?e.jsx("input",{type:"number",value:Z,onChange:s=>A(j,O,parseFloat(s.target.value)),step:"0.05",min:"0.1",max:"5",className:"w-16 px-2 py-1 border border-gray-300 dark:border-gray-600 rounded"}):e.jsxs("span",{className:Z!==1?"font-bold":"",children:[Z.toFixed(2),"×"]})},O)}),e.jsx("td",{className:"py-2 text-right",children:e.jsx("button",{onClick:()=>f(x===j?null:j),className:`px-3 py-1 rounded ${x===j?"bg-green-500 text-white":"bg-blue-500 text-white"}`,children:x===j?"Готово":"Изменить"})})]},j))})]})})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-sm p-4",children:[e.jsx("h2",{className:"text-lg font-semibold mb-4",children:"Настройки урожая"}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Множитель дня роста урожая"}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"number",value:o.growthDayMultiplier||5,onChange:j=>R({growthDayMultiplier:parseFloat(j.target.value)}),step:"0.5",min:"0.5",className:"w-24 px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md"}),e.jsx("span",{className:"ml-2 text-sm text-gray-500 dark:text-gray-400",children:"валюты за день роста"})]}),e.jsx("p",{className:"mt-1 text-xs text-gray-500 dark:text-gray-400",children:"Этот множитель используется при расчете стоимости урожая и определяет, сколько валюты добавляется к стоимости за каждый день роста."})]})]})]})};function Rt(){const o=je(),{state:R,updateState:i}=xe(),{currentConfig:h,updateConfig:w}=o,[a,k]=u.useState(""),[x,f]=u.useState("general");u.useEffect(()=>{if(!h.subTypeModifiers||Object.keys(h.subTypeModifiers||{}).length===0){const n=R.balance.savedConfigs.find(t=>t.id==="default")||(R.balance.savedConfigs.length>0?R.balance.savedConfigs[0]:null);n&&n.subTypeModifiers&&Object.keys(n.subTypeModifiers).length>0&&w({subTypeModifiers:{...n.subTypeModifiers}})}},[h,R.balance.savedConfigs,w]);const S=()=>{if(!a.trim()){alert("Please enter a configuration name");return}console.log("Создаем новую конфигурацию из параметров:",a);const n=`config-${Date.now()}`,t=JSON.parse(JSON.stringify(h));if(t.id=n,t.name=a,t.createdAt=new Date().toISOString(),!t.subTypeModifiers||Object.keys(t.subTypeModifiers).length===0){const d=R.balance.savedConfigs.find(r=>r.id==="default");d&&d.subTypeModifiers&&(t.subTypeModifiers={...d.subTypeModifiers})}console.log("Новая конфигурация:",t);const s=[...R.balance.savedConfigs,t];i("balance",{currentConfig:t,savedConfigs:s,comparisonItems:R.balance.comparisonItems}),k(""),alert(`Configuration "${a}" has been created`)},L=n=>{const t=parseFloat(n.target.value);!isNaN(t)&&t>0&&w({baseValue:t})},C=(n,t)=>{const s=parseFloat(t.target.value);!isNaN(s)&&s>=0&&s<=1&&w({weights:{...h.weights,[n]:s}})},M=n=>{const t=parseFloat(n.target.value);!isNaN(t)&&t>=0&&w({tierMultiplier:t})},N=(n,t)=>{const s=parseFloat(t.target.value);!isNaN(s)&&s>=0&&w({categories:{...h.categories,[n]:s}})},I=(n,t)=>{const s=parseFloat(t.target.value);!isNaN(s)&&s>=0&&w({mechanics:{...h.mechanics,[n]:s}})},A=(n,t)=>{const s=parseFloat(t.target.value);!isNaN(s)&&s>=0&&w({modifiers:{...h.modifiers,[n]:s}})},P=(n,t)=>{const s=parseFloat(t.target.value);!isNaN(s)&&s>=0&&w({frequencyTypes:{...h.frequencyTypes,[n]:s}})},U=(n,t)=>{const s=parseFloat(t.target.value);!isNaN(s)&&s>=0&&w({craftComplexityTypes:{...h.craftComplexityTypes,[n]:s}})},j=(n,t)=>{const s=parseFloat(t.target.value);!isNaN(s)&&s>=0&&w({subTypeModifiers:{...h.subTypeModifiers||{},[n]:s}})},O=()=>{const n=R.balance.savedConfigs.find(t=>t.id==="default");n&&n.subTypeModifiers&&w({subTypeModifiers:{...n.subTypeModifiers}})},Z=()=>{switch(x){case"general":return e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700 p-4 rounded-lg",children:[e.jsx("h2",{className:"text-lg font-semibold mb-4",children:"Базовые параметры"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Базовая ценность"}),e.jsx("input",{type:"number",value:h.baseValue,onChange:L,min:"1",step:"1",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-800"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Множитель Тира (+% per tier)"}),e.jsx("input",{type:"number",value:h.tierMultiplier,onChange:M,min:"0",step:"0.05",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-800"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Каждый уровень Тира выше 1, добавляет процент к множителю"})]})]})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700 p-4 rounded-lg",children:[e.jsx("h2",{className:"text-lg font-semibold mb-4",children:"Общий вес Формул"}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mb-4",children:"Для более правильного баланса, сумма весов должна быть равна 1"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Вес Категории (W1)"}),e.jsx("input",{type:"number",value:h.weights.categoryWeight,onChange:n=>C("categoryWeight",n),min:"0",max:"1",step:"0.05",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-800"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Вес Тира (W2)"}),e.jsx("input",{type:"number",value:h.weights.tierWeight,onChange:n=>C("tierWeight",n),min:"0",max:"1",step:"0.05",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-800"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Вес Механики (W3)"}),e.jsx("input",{type:"number",value:h.weights.mechanicWeight,onChange:n=>C("mechanicWeight",n),min:"0",max:"1",step:"0.05",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-800"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Вес Модификатора (W4)"}),e.jsx("input",{type:"number",value:h.weights.modifiersWeight,onChange:n=>C("modifiersWeight",n),min:"0",max:"1",step:"0.05",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-800"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Вес Локации (W5)"}),e.jsx("input",{type:"number",value:h.weights.locationsWeight,onChange:n=>C("locationsWeight",n),min:"0",max:"1",step:"0.05",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-800"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Вес частоты появления (W6)"}),e.jsx("input",{type:"number",value:h.weights.frequencyWeight||.1,onChange:n=>C("frequencyWeight",n),min:"0",max:"1",step:"0.05",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-800"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Вес Сложности крафта (W7)"}),e.jsx("input",{type:"number",value:h.weights.craftComplexityWeight||.1,onChange:n=>C("craftComplexityWeight",n),min:"0",max:"1",step:"0.05",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-800"})]}),e.jsx("div",{className:"p-3 bg-white dark:bg-gray-800 rounded-md",children:e.jsxs("div",{className:"text-sm",children:["Всего: ",e.jsx("span",{className:Math.abs(h.weights.categoryWeight+h.weights.tierWeight+h.weights.mechanicWeight+h.weights.modifiersWeight+h.weights.locationsWeight+(h.weights.frequencyWeight||0)+(h.weights.craftComplexityWeight||0)-1)<.01?"text-green-500":"text-red-500",children:(h.weights.categoryWeight+h.weights.tierWeight+h.weights.mechanicWeight+h.weights.modifiersWeight+h.weights.locationsWeight+(h.weights.frequencyWeight||0)+(h.weights.craftComplexityWeight||0)).toFixed(2)})]})})]})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 p-4 rounded-lg shadow-sm mb-4",children:[e.jsx("h3",{className:"text-lg font-medium mb-4",children:"Торговые модификаторы"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Скидка продажи (%)"}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"number",value:Math.round(h.sellDiscount*100),onChange:n=>{const t=parseInt(n.target.value);isNaN(t)||w({sellDiscount:t/100})},className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-700 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100",min:"0",max:"100",step:"1"}),e.jsx("span",{className:"ml-2",children:"%"})]}),e.jsx("p",{className:"mt-1 text-xs text-gray-500 dark:text-gray-400",children:"Скидка, применяемая при продаже предметов торговцам"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Наценка покупки (%)"}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"number",value:Math.round(h.buyMarkup*100),onChange:n=>{const t=parseInt(n.target.value);isNaN(t)||w({buyMarkup:t/100})},className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-700 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100",min:"0",max:"100",step:"1"}),e.jsx("span",{className:"ml-2",children:"%"})]}),e.jsx("p",{className:"mt-1 text-xs text-gray-500 dark:text-gray-400",children:"Наценка, применяемая при покупке товаров у продавцов"})]})]})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700 p-4 rounded-lg",children:[e.jsx("h2",{className:"text-lg font-semibold mb-4",children:"Сохранить конфигурацию"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Название конфигурации"}),e.jsx("input",{type:"text",value:a,onChange:n=>k(n.target.value),placeholder:"Enter configuration name",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-800"})]}),e.jsx("button",{onClick:S,className:"w-full px-4 py-2 bg-primary text-white rounded-md hover:bg-opacity-90 transition",children:"Сохранить конфигурацию"})]})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700 p-4 rounded-lg",children:[e.jsx("h2",{className:"text-lg font-semibold mb-4",children:"Множитель Категории"}),e.jsx("div",{className:"space-y-3",children:Object.entries(h.categories).map(([n,t])=>e.jsxs("div",{className:"flex items-center",children:[e.jsx("label",{className:"w-1/2 text-sm",children:n}),e.jsx("input",{type:"number",value:t,onChange:s=>N(n,s),min:"0",step:"0.1",className:"w-1/2 px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-800"})]},n))})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700 p-4 rounded-lg",children:[e.jsx("h2",{className:"text-lg font-semibold mb-4",children:"Множитель Механики"}),e.jsx("div",{className:"space-y-3",children:Object.entries(h.mechanics).map(([n,t])=>e.jsxs("div",{className:"flex items-center",children:[e.jsx("label",{className:"w-1/2 text-sm",children:n}),e.jsx("input",{type:"number",value:t,onChange:s=>I(n,s),min:"0",step:"0.1",className:"w-1/2 px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-800"})]},n))})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700 p-4 rounded-lg",children:[e.jsx("h2",{className:"text-lg font-semibold mb-4",children:"Множитель Модификатора"}),e.jsx("div",{className:"space-y-3",children:Object.entries(h.modifiers).map(([n,t])=>e.jsxs("div",{className:"flex items-center",children:[e.jsx("label",{className:"w-1/2 text-sm",children:n}),e.jsx("input",{type:"number",value:t,onChange:s=>A(n,s),min:"0",step:"0.1",className:"w-1/2 px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-800"})]},n))})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700 p-4 rounded-lg",children:[e.jsx("h2",{className:"text-lg font-semibold mb-4",children:"Множитель Локации"}),e.jsx("div",{className:"space-y-3",children:Object.entries(h.locations).map(([n,t])=>e.jsxs("div",{className:"flex items-center",children:[e.jsx("label",{className:"w-1/2 text-sm",children:n}),e.jsx("input",{type:"number",value:t,onChange:s=>{const d=parseFloat(s.target.value);!isNaN(d)&&d>=0&&w({locations:{...h.locations,[n]:d}})},min:"0",step:"0.1",className:"w-1/2 px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-800"})]},n))})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700 p-4 rounded-lg",children:[e.jsx("h2",{className:"text-lg font-semibold mb-4",children:"Множитель частоты появления"}),e.jsx("div",{className:"space-y-3",children:Object.entries(h.frequencyTypes||{}).map(([n,t])=>e.jsxs("div",{className:"flex items-center",children:[e.jsx("label",{className:"w-1/2 text-sm",children:n}),e.jsx("input",{type:"number",value:t,onChange:s=>P(n,s),min:"0",step:"0.1",className:"w-1/2 px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-800"})]},n))})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700 p-4 rounded-lg",children:[e.jsx("h2",{className:"text-lg font-semibold mb-4",children:"Множитель Сложности крафта"}),e.jsx("div",{className:"space-y-3",children:Object.entries(h.craftComplexityTypes||{}).map(([n,t])=>e.jsxs("div",{className:"flex items-center",children:[e.jsx("label",{className:"w-1/2 text-sm",children:n}),e.jsx("input",{type:"number",value:t,onChange:s=>U(n,s),min:"0",step:"0.1",className:"w-1/2 px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-800"})]},n))})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700 p-4 rounded-lg",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h2",{className:"text-lg font-semibold",children:"Модификаторы подтипов"}),e.jsx("button",{onClick:O,className:"px-3 py-1 bg-blue-500 text-white text-sm rounded hover:bg-blue-600",children:"Сбросить к дефолтным"})]}),e.jsx("div",{className:"space-y-3",children:Object.entries(h.subTypeModifiers||{}).map(([n,t])=>e.jsxs("div",{className:"flex items-center",children:[e.jsx("label",{className:"w-1/2 text-sm",children:n}),e.jsx("input",{type:"number",value:t,onChange:s=>j(n,s),min:"0",step:"0.1",className:"w-1/2 px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-800"})]},n))}),e.jsx("p",{className:"mt-3 text-sm text-gray-500 dark:text-gray-400",children:"Множитель определяет, как подтип влияет на базовую стоимость предмета."})]})]})]});case"craftTime":return e.jsx(At,{});case"seasonal":return e.jsx(Vt,{});default:return null}};return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-wrap border-b border-gray-300 dark:border-gray-700",children:[e.jsx("button",{className:`px-4 py-2 text-sm font-medium ${x==="general"?"text-primary border-b-2 border-primary":"text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300"}`,onClick:()=>f("general"),children:"Основные настройки"}),e.jsx("button",{className:`px-4 py-2 text-sm font-medium ${x==="craftTime"?"text-primary border-b-2 border-primary":"text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300"}`,onClick:()=>f("craftTime"),children:"Настройки времени крафта"}),e.jsx("button",{className:`px-4 py-2 text-sm font-medium ${x==="seasonal"?"text-primary border-b-2 border-primary":"text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300"}`,onClick:()=>f("seasonal"),children:"Сезонные настройки"})]}),Z()]})}function Bt(){const o=je(),{state:R,updateState:i}=xe(),{savedConfigs:h,loadConfig:w,deleteConfig:a,currentConfig:k}=o,[x,f]=u.useState(""),[S,L]=u.useState(!1),[C,M]=u.useState([]),[N,I]=u.useState("weights"),A=u.useMemo(()=>C.length===0?[k]:C.map(r=>h.find(y=>y.id===r)||k),[C,h,k]),P=u.useMemo(()=>{const r=document.documentElement.classList.contains("dark"),y=["categoryWeight","tierWeight","mechanicWeight","modifiersWeight","locationsWeight","frequencyWeight","craftComplexityWeight"],p={categoryWeight:"Категория",tierWeight:"Тир",mechanicWeight:"Механика",modifiersWeight:"Модификаторы",locationsWeight:"Локации",frequencyWeight:"Частота",craftComplexityWeight:"Сложность Крафта"},v=["#3B82F6","#10B981","#EC4899","#F59E0B","#8B5CF6"],T=[{},{type:"line",backgroundColor:"rgba(0, 0, 0, 0.1)"},{type:"crosshatch",backgroundColor:"rgba(0, 0, 0, 0.1)"}];return{backgroundColor:"transparent",title:{text:"Сравнение весовых коэффициентов",left:"center",textStyle:{color:r?"#ccc":"#333"}},tooltip:{trigger:"axis",axisPointer:{type:"shadow"},backgroundColor:r?"rgba(30, 30, 30, 0.9)":"rgba(255, 255, 255, 0.9)",borderColor:r?"#555":"#ddd",textStyle:{color:r?"#fff":"#333"}},legend:{data:A.map(b=>b.name),top:"bottom",textStyle:{color:r?"#ccc":"#333"}},grid:{left:"3%",right:"4%",bottom:"20%",top:"15%",containLabel:!0},xAxis:{type:"category",data:y.map(b=>p[b]||b),axisLabel:{color:r?"#ccc":"#333",rotate:y.length>6?45:0,fontSize:12,interval:0},axisLine:{lineStyle:{color:r?"rgba(255, 255, 255, 0.2)":"rgba(0, 0, 0, 0.2)"}}},yAxis:{type:"value",name:"Значение веса",nameTextStyle:{color:r?"#ccc":"#333"},axisLabel:{color:r?"#ccc":"#333"},splitLine:{lineStyle:{color:r?"rgba(255, 255, 255, 0.1)":"rgba(0, 0, 0, 0.1)"}}},series:A.map((b,D)=>({name:b.name,type:"bar",barMaxWidth:50,barGap:"10%",data:y.map(J=>({value:b.weights[J]||0,itemStyle:{color:v[D%v.length],decal:D>0?T[D%T.length]:void 0}})),emphasis:{itemStyle:{shadowBlur:10,shadowOffsetX:0,shadowColor:"rgba(0, 0, 0, 0.5)"}},label:{show:!0,position:"top",formatter:"{c}",color:r?"#ccc":"#333",fontSize:10}}))}},[A]),U=u.useMemo(()=>{if(A.length===0)return{};const r=document.documentElement.classList.contains("dark"),y=new Set;A.forEach(b=>{Object.keys(b.categories||{}).forEach(D=>y.add(D))});const p=Array.from(y).sort(),v=["#3B82F6","#10B981","#EC4899","#F59E0B","#8B5CF6"],T=[{},{type:"line",backgroundColor:"rgba(0, 0, 0, 0.1)"},{type:"crosshatch",backgroundColor:"rgba(0, 0, 0, 0.1)"}];return{backgroundColor:"transparent",title:{text:"Сравнение значений категорий",left:"center",textStyle:{color:r?"#ccc":"#333"}},tooltip:{trigger:"axis",axisPointer:{type:"shadow"},backgroundColor:r?"rgba(30, 30, 30, 0.9)":"rgba(255, 255, 255, 0.9)",borderColor:r?"#555":"#ddd",textStyle:{color:r?"#fff":"#333"}},legend:{data:A.map(b=>b.name),top:"bottom",textStyle:{color:r?"#ccc":"#333"}},dataZoom:p.length>8?[{type:"slider",show:!0,xAxisIndex:[0],start:0,end:Math.min(100,8/p.length*100),textStyle:{color:r?"#ccc":"#333"}}]:[],grid:{left:"3%",right:"4%",bottom:p.length>8?"25%":"20%",top:"15%",containLabel:!0},xAxis:{type:"category",data:p,axisLabel:{interval:0,rotate:45,fontSize:10,color:r?"#ccc":"#333"},axisLine:{lineStyle:{color:r?"rgba(255, 255, 255, 0.2)":"rgba(0, 0, 0, 0.2)"}}},yAxis:{type:"value",name:"Множитель категории",nameTextStyle:{color:r?"#ccc":"#333"},axisLabel:{color:r?"#ccc":"#333"},splitLine:{lineStyle:{color:r?"rgba(255, 255, 255, 0.1)":"rgba(0, 0, 0, 0.1)"}}},series:A.map((b,D)=>({name:b.name,type:"bar",barMaxWidth:40,barGap:"10%",data:p.map(J=>({value:b.categories[J]||0,itemStyle:{color:v[D%v.length],decal:D>0?T[D%T.length]:void 0}})),emphasis:{itemStyle:{shadowBlur:10,shadowOffsetX:0,shadowColor:"rgba(0, 0, 0, 0.5)"}},label:{show:!1,position:"top",formatter:"{c}",color:r?"#ccc":"#333"}}))}},[A,N]),j=u.useMemo(()=>{if(A.length===0)return{};const r=document.documentElement.classList.contains("dark"),y=new Set;A.forEach(b=>{Object.keys(b.mechanics||{}).forEach(D=>y.add(D))});const p=Array.from(y).sort(),v=["#3B82F6","#10B981","#EC4899","#F59E0B","#8B5CF6"],T=[{},{type:"line",backgroundColor:"rgba(0, 0, 0, 0.1)"},{type:"crosshatch",backgroundColor:"rgba(0, 0, 0, 0.1)"}];return{backgroundColor:"transparent",title:{text:"Сравнение значений механик",left:"center",textStyle:{color:r?"#ccc":"#333"}},tooltip:{trigger:"axis",axisPointer:{type:"shadow"},backgroundColor:r?"rgba(30, 30, 30, 0.9)":"rgba(255, 255, 255, 0.9)",borderColor:r?"#555":"#ddd",textStyle:{color:r?"#fff":"#333"}},legend:{data:A.map(b=>b.name),top:"bottom",textStyle:{color:r?"#ccc":"#333"}},dataZoom:p.length>8?[{type:"slider",show:!0,xAxisIndex:[0],start:0,end:Math.min(100,8/p.length*100),textStyle:{color:r?"#ccc":"#333"}}]:[],grid:{left:"3%",right:"4%",bottom:p.length>8?"25%":"20%",top:"15%",containLabel:!0},xAxis:{type:"category",data:p,axisLabel:{interval:0,rotate:30,fontSize:10,color:r?"#ccc":"#333"},axisLine:{lineStyle:{color:r?"rgba(255, 255, 255, 0.2)":"rgba(0, 0, 0, 0.2)"}}},yAxis:{type:"value",name:"Множитель механики",nameTextStyle:{color:r?"#ccc":"#333"},axisLabel:{color:r?"#ccc":"#333"},splitLine:{lineStyle:{color:r?"rgba(255, 255, 255, 0.1)":"rgba(0, 0, 0, 0.1)"}}},series:A.map((b,D)=>({name:b.name,type:"bar",barMaxWidth:40,barGap:"10%",data:p.map(J=>({value:b.mechanics[J]||0,itemStyle:{color:v[D%v.length],decal:D>0?T[D%T.length]:void 0}})),emphasis:{itemStyle:{shadowBlur:10,shadowOffsetX:0,shadowColor:"rgba(0, 0, 0, 0.5)"}},label:{show:!1,position:"top",formatter:"{c}",color:r?"#ccc":"#333"}}))}},[A,N]),O=u.useMemo(()=>{if(A.length===0)return{};const r=document.documentElement.classList.contains("dark"),y=new Set;A.forEach(b=>{Object.keys(b.modifiers||{}).forEach(D=>y.add(D))});const p=Array.from(y).sort(),v=["#3B82F6","#10B981","#EC4899","#F59E0B","#8B5CF6"],T=[{},{type:"line",backgroundColor:"rgba(0, 0, 0, 0.1)"},{type:"crosshatch",backgroundColor:"rgba(0, 0, 0, 0.1)"}];return{backgroundColor:"transparent",title:{text:"Сравнение значений модификаторов",left:"center",textStyle:{color:r?"#ccc":"#333"}},tooltip:{trigger:"axis",axisPointer:{type:"shadow"},backgroundColor:r?"rgba(30, 30, 30, 0.9)":"rgba(255, 255, 255, 0.9)",borderColor:r?"#555":"#ddd",textStyle:{color:r?"#fff":"#333"}},legend:{data:A.map(b=>b.name),top:"bottom",textStyle:{color:r?"#ccc":"#333"}},dataZoom:p.length>8?[{type:"slider",show:!0,xAxisIndex:[0],start:0,end:Math.min(100,8/p.length*100),textStyle:{color:r?"#ccc":"#333"}}]:[],grid:{left:"3%",right:"4%",bottom:p.length>8?"25%":"20%",top:"15%",containLabel:!0},xAxis:{type:"category",data:p,axisLabel:{interval:0,rotate:30,fontSize:10,color:r?"#ccc":"#333"},axisLine:{lineStyle:{color:r?"rgba(255, 255, 255, 0.2)":"rgba(0, 0, 0, 0.2)"}}},yAxis:{type:"value",name:"Множитель модификатора",nameTextStyle:{color:r?"#ccc":"#333"},axisLabel:{color:r?"#ccc":"#333"},splitLine:{lineStyle:{color:r?"rgba(255, 255, 255, 0.1)":"rgba(0, 0, 0, 0.1)"}}},series:A.map((b,D)=>({name:b.name,type:"bar",barMaxWidth:50,barGap:"10%",data:p.map(J=>({value:b.modifiers[J]||0,itemStyle:{color:v[D%v.length],decal:D>0?T[D%T.length]:void 0}})),emphasis:{itemStyle:{shadowBlur:10,shadowOffsetX:0,shadowColor:"rgba(0, 0, 0, 0.5)"}},label:{show:!1,position:"top",formatter:"{c}",color:r?"#ccc":"#333"}}))}},[A,N]),Z=()=>{if(!x.trim()){alert("Please enter a name for the new configuration");return}console.log("Создаем новую конфигурацию:",x);const r=`config-${Date.now()}`,y=JSON.parse(JSON.stringify(k));y.id=r,y.name=x,y.createdAt=new Date().toISOString(),console.log("Новая конфигурация:",y);const p=[...h,y];try{i("balance",{currentConfig:y,savedConfigs:p,comparisonItems:R.balance.comparisonItems}),console.log("Состояние обновлено. Новая текущая конфигурация:",y.id),f(""),L(!1)}catch(v){console.error("Ошибка при обновлении состояния:",v),alert(`Ошибка: ${v}`)}},n=r=>{M(y=>y.includes(r)?y.filter(p=>p!==r):[...y,r].slice(-3))},t=()=>{console.log("Текущие конфигурации:",{current:k,saved:h})},s=()=>{console.log("Диагностика Crafting System:"),console.log(`Всего рецептов: ${R.craftSystem.recipes.length}`),console.log(`nextRecipeId: ${R.craftSystem.nextRecipeId}`),console.log(`nextVariantId: ${R.craftSystem.nextVariantId}`);const r=R.craftSystem.recipes.map(T=>T.id);console.log("ID всех рецептов:",r),new Set(r).size!==r.length&&console.error("ВНИМАНИЕ: Обнаружены дублирующиеся ID рецептов!");const p=R.craftSystem.recipes.flatMap(T=>T.variants);console.log(`Всего вариантов: ${p.length}`);const v=R.craftSystem.recipes.filter(T=>!T.variants||T.variants.length===0);v.length>0&&console.error(`ВНИМАНИЕ: ${v.length} рецептов без вариантов!`)};if(h.length===0)return e.jsx("div",{className:"bg-gray-50 dark:bg-gray-700 p-6 rounded-lg text-center",children:e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Пока нет сохраненных конфигураций. Сохраните конфигурацию на вкладке Параметры баланса."})});const d=r=>{try{const y=new Date(r);return new Intl.DateTimeFormat("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}).format(y)}catch{return r}};return e.jsxs("div",{className:"space-y-6",children:[C.length>0&&e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700 p-4 rounded-lg",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h2",{className:"text-lg font-semibold",children:"Configuration Comparison"}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{onClick:()=>I("weights"),className:`px-3 py-1 rounded text-sm ${N==="weights"?"bg-blue-500 text-white":"bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300"}`,children:"Weights"}),e.jsx("button",{onClick:()=>I("categories"),className:`px-3 py-1 rounded text-sm ${N==="categories"?"bg-blue-500 text-white":"bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300"}`,children:"Categories"}),e.jsx("button",{onClick:()=>I("mechanics"),className:`px-3 py-1 rounded text-sm ${N==="mechanics"?"bg-blue-500 text-white":"bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300"}`,children:"Mechanics"}),e.jsx("button",{onClick:()=>I("modifiers"),className:`px-3 py-1 rounded text-sm ${N==="modifiers"?"bg-blue-500 text-white":"bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300"}`,children:"Modifiers"})]})]}),e.jsxs("div",{className:"h-80",children:[N==="weights"&&e.jsx(Ne,{options:P}),N==="categories"&&e.jsx(Ne,{options:U}),N==="mechanics"&&e.jsx(Ne,{options:j}),N==="modifiers"&&e.jsx(Ne,{options:O})]}),e.jsx("div",{className:"mt-2 text-sm text-center text-gray-500 dark:text-gray-400",children:"Select up to 3 configurations to compare their parameters"})]}),e.jsxs("div",{className:"p-3 bg-yellow-100 dark:bg-yellow-900/30 text-xs font-mono overflow-auto",children:[e.jsxs("div",{children:["Current Config ID: ",e.jsx("span",{className:"font-bold",children:k.id})]}),e.jsxs("div",{children:["Current Config Name: ",e.jsx("span",{className:"font-bold",children:k.name})]}),e.jsxs("div",{children:["Saved Configs: ",e.jsx("span",{className:"font-bold",children:h.length})]}),e.jsxs("div",{children:["Saved Config IDs: ",e.jsx("span",{className:"font-bold",children:h.map(r=>r.id).join(", ")})]})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700 p-4 rounded-lg",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h2",{className:"text-lg font-semibold",children:"Сохраненные конфигурации"}),S?e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("input",{type:"text",value:x,onChange:r=>f(r.target.value),placeholder:"New config name",className:"px-3 py-1 border border-gray-300 dark:border-gray-600 rounded-md text-sm bg-white dark:bg-gray-800"}),e.jsx("button",{onClick:Z,className:"px-3 py-1 bg-green-500 text-white rounded-md text-sm hover:bg-green-600",children:"Save"}),e.jsx("button",{onClick:()=>L(!1),className:"px-3 py-1 bg-gray-300 dark:bg-gray-600 text-gray-800 dark:text-gray-200 rounded-md text-sm",children:"Cancel"})]}):e.jsx("button",{onClick:()=>L(!0),className:"px-3 py-1 bg-primary text-white rounded-md text-sm hover:bg-opacity-90",children:"Create New Config"})]}),e.jsxs("div",{className:"flex space-x-2 mb-4",children:[e.jsx("button",{onClick:t,className:"px-2 py-1 bg-gray-200 dark:bg-gray-700 text-xs rounded",children:"Debug: Log configs"}),e.jsx("button",{onClick:()=>window.location.reload(),className:"px-2 py-1 bg-blue-200 dark:bg-blue-700 text-xs rounded",children:"Refresh Page"}),e.jsx("button",{onClick:s,className:"px-2 py-1 bg-yellow-200 dark:bg-yellow-700 text-xs rounded",children:"Debug: Craft System"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"text-sm text-gray-500 mb-2",children:["Showing ",h.length," configurations",C.length>0&&` (${C.length} selected for comparison)`]}),h.map(r=>e.jsxs("div",{className:`p-4 rounded-lg border ${k.id===r.id?"border-primary bg-primary bg-opacity-10":C.includes(r.id)?"border-blue-500 bg-blue-50 dark:bg-blue-900/20":"border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800"}`,children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{className:"flex gap-2 items-start",children:[e.jsx("div",{children:e.jsx("input",{type:"checkbox",id:`compare-${r.id}`,checked:C.includes(r.id),onChange:()=>n(r.id),className:"h-4 w-4 text-blue-500 focus:ring-blue-400"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-lg mb-1",children:r.name}),e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:["ID: ",r.id," • Version: ",r.version," • Created: ",d(r.createdAt)]})]})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{onClick:()=>w(r.id),className:`px-3 py-1 rounded-md text-sm ${k.id===r.id?"bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200 cursor-default":"bg-primary text-white hover:bg-opacity-90"}`,disabled:k.id===r.id,children:k.id===r.id?"Current":"Load"}),r.id!=="default"&&e.jsx("button",{onClick:()=>a(r.id),className:"px-3 py-1 bg-red-500 text-white rounded-md text-sm hover:bg-red-600",children:"Delete"})]})]}),e.jsxs("div",{className:"mt-3 grid grid-cols-2 md:grid-cols-4 gap-3 text-sm",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-gray-500 dark:text-gray-400",children:"Базовая ценность"}),e.jsx("div",{children:r.baseValue})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-gray-500 dark:text-gray-400",children:"Множитель Тира"}),e.jsxs("div",{children:[(r.tierMultiplier*100).toFixed(0),"%"]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-gray-500 dark:text-gray-400",children:"Вес Категории"}),e.jsx("div",{children:r.weights.categoryWeight.toFixed(2)})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-gray-500 dark:text-gray-400",children:"Вес Тира"}),e.jsx("div",{children:r.weights.tierWeight.toFixed(2)})]})]})]},r.id))]})]})]})}function Ot({recipes:o,onSelectRecipe:R,selectedRecipeId:i}={}){const{state:h}=xe(),w=je(),[a,k]=u.useState(""),[x,f]=u.useState(null),S=o||h.craftSystem.recipes||[],L=i!==void 0?i:x,C=n=>{R?R(n):f(n)},M=n=>{var t,s;if(!n)return null;try{const d=(t=h.resources.imageMap)==null?void 0:t.get(n);if(d)return typeof d.data=="string"&&d.data.startsWith("data:")?d.data:`data:${d.type};base64,${d.data}`;const r=(s=h.units.imageMap)==null?void 0:s.get(n);return r?typeof r.data=="string"&&r.data.startsWith("data:")?r.data:`data:${r.type};base64,${r.data}`:null}catch(d){return console.error(`Ошибка при получении URL изображения (ID: ${n}):`,d),null}},N=n=>{const t=S.find(r=>r.resultItemName===n&&r.imageId);if(t!=null&&t.imageId)return M(t.imageId);const s=h.balance.comparisonItems.find(r=>r.name===n);if(s!=null&&s.imageId)return M(s.imageId);const d=h.resources.items.find(r=>r.name===n);return d!=null&&d.imageId?M(d.imageId):null},I=u.useMemo(()=>{const n=h.resources.items.map(t=>({name:t.name,tier:1,mechanic:"Найти в мире",selectedCategories:[t.category],selectedModifiers:[],selectedLocations:[],frequencyType:"Часто встречаемый",craftComplexity:"Не крафтиться",imageId:t.imageId||null}));return[...h.balance.comparisonItems,...n]},[h.resources.items,h.balance.comparisonItems]),A=n=>{const t=I.find(s=>s.name===n);return(t==null?void 0:t.tier)||1},P=n=>{const t=I.find(s=>s.name===n);return(t==null?void 0:t.craftComplexity)||"Средне"},j=[...(S==null?void 0:S.filter(n=>n.name.toLowerCase().includes(a.toLowerCase())||n.resultItemName.toLowerCase().includes(a.toLowerCase())))||[]].sort((n,t)=>n.id===L?-1:t.id===L?1:n.name.localeCompare(t.name)),O=u.useMemo(()=>j.map(n=>{const t=n.variants.map(D=>{const J=ht(D.ingredients,I,w.currentConfig);return{id:D.id,name:D.name,cost:J}}),s=t.length>0?Math.min(...t.map(D=>D.cost)):0,d=pt(n,I,w.currentConfig),r=d-s,y=A(n.resultItemName);let p;try{const D=Ke(n,I,w.currentConfig);p=we(D.totalTime)}catch(D){console.error("Error calculating craft time for",n.name,":",D);const J=P(n.resultItemName),B=Qe(J,n.level,w.currentConfig);p=we(B)}const v=M(n.imageId),T=N(n.resultItemName);return{recipe:n,tier:y,ingredientsCost:s,craftValue:d,profit:r,craftTime:p,imageUrl:v||T}}),[j,I,w.currentConfig,A]),Z=n=>({Оружие:"⚔️",Броня:"🛡️",Еда:"🍲",Ресурсы:"🧰",Инструменты:"🔨",Алхимия:"⚗️",Магия:"✨",Прочее:"📦"})[n]||"📄";return e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-sm p-4 border border-gray-300 dark:border-gray-700",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h2",{className:"text-lg font-semibold",children:"Recipe List"}),e.jsx("button",{onClick:()=>C(""),className:"px-3 py-1 bg-primary text-white rounded-md hover:bg-opacity-90 transition",children:"New Recipe"})]}),e.jsx("div",{className:"mb-4",children:e.jsx("input",{type:"text",placeholder:"Search recipes...",value:a,onChange:n=>k(n.target.value),className:"w-full px-3 py-2 border border-gray-600 dark:border-gray-700 rounded-md bg-gray-100 dark:bg-gray-800 text-gray-900 dark:text-gray-100"})}),e.jsx("div",{className:"space-y-3 overflow-y-auto max-h-[calc(100vh-280px)]",children:j.length===0?e.jsx("div",{className:"text-center py-8 text-gray-500 dark:text-gray-400 border border-dashed border-gray-500 dark:border-gray-600 rounded-md bg-gray-50 dark:bg-gray-900/30",children:"No recipes found. Create your first recipe!"}):O.map(({recipe:n,tier:t,profit:s,craftTime:d,imageUrl:r})=>e.jsxs("div",{className:`p-3 rounded-lg border ${n.id===L?"border-primary bg-primary/5 dark:bg-primary/10":"border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-800/50"} hover:bg-gray-100 dark:hover:bg-gray-700/50 transition-colors cursor-pointer`,onClick:()=>C(n.id),children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx("div",{className:"w-10 h-10 flex items-center justify-center bg-gray-200 dark:bg-gray-700 rounded-md text-lg overflow-hidden",children:r?e.jsx("img",{src:r,alt:n.name,className:"w-full h-full object-cover"}):Z(n.category)}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium",children:n.name}),e.jsxs("div",{className:"text-sm text-gray-600 dark:text-gray-400 flex items-center",children:[e.jsxs("span",{children:["Result: ",n.resultAmount,"x ",n.resultItemName]}),e.jsxs("span",{className:"mx-1 text-xs px-1.5 py-0.5 rounded bg-blue-100 dark:bg-blue-900/50 text-blue-800 dark:text-blue-300 ml-2",children:["T",t]})]})]})]}),e.jsxs("div",{className:`text-sm font-medium px-2 py-1 rounded ${s>0?"bg-green-100 dark:bg-green-900/30 text-green-800 dark:text-green-300":"bg-red-100 dark:bg-red-900/30 text-red-800 dark:text-red-300"}`,children:[s>0?"+":"",Math.round(s)]})]}),e.jsxs("div",{className:"mt-2 grid grid-cols-2 gap-2 text-xs text-gray-500 dark:text-gray-400",children:[e.jsxs("div",{children:[e.jsx("span",{className:"inline-block mr-1",children:"⏱️"}),d]}),e.jsxs("div",{children:[e.jsx("span",{className:"inline-block mr-1",children:"🔄"}),n.variants.length," variant",n.variants.length!==1?"s":""]}),n.variants.length>0&&n.variants[0].ingredients.length>0&&e.jsx("div",{className:"col-span-2 mt-1 pt-1 border-t border-gray-200 dark:border-gray-700",children:e.jsxs("div",{className:"flex flex-wrap gap-1 mt-1",children:[n.variants[0].ingredients.slice(0,3).map(y=>{const p=N(y.itemName);return e.jsxs("span",{className:"px-1.5 py-0.5 bg-gray-200 dark:bg-gray-700 rounded flex items-center",children:[p&&e.jsx("div",{className:"w-4 h-4 mr-1 rounded-full overflow-hidden",children:e.jsx("img",{src:p,alt:y.itemName,className:"w-full h-full object-cover"})}),y.itemName," (",y.amount,"x)"]},y.itemName)}),n.variants[0].ingredients.length>3&&e.jsxs("span",{className:"px-1.5 py-0.5 bg-gray-200 dark:bg-gray-700 rounded",children:["+",n.variants[0].ingredients.length-3," more"]})]})})]})]},n.id))})]})}function Pt({selectedRecipeId:o,onRecipeSaved:R}){var B,G,K,ie;const{state:i,updateState:h}=xe(),w=je(),[a,k]=u.useState({name:"",resultItemName:"",resultAmount:1,category:"",level:1,currentVariant:0,variants:[{id:"new-variant",name:"Standard",ingredients:[],fuelItems:[]}],isSeasonDependent:!1,availableSeasons:[],seasonalMultipliers:{},requiresFuel:!1}),x=u.useRef([]),f=u.useRef([]),S=u.useRef({baseTime:0,ingredientsTime:0,totalTime:0,variantTimes:[]}),[L,C]=u.useState(!1),M=w.currentConfig.seasons||["Весна","Лето","Осень","Зима"];u.useEffect(()=>{const E=new Set;i.craftSystem.recipes.forEach(F=>{F.resultItemName&&E.add(F.resultItemName)});const V=i.balance.comparisonItems.map(F=>F.hasCraftRecipe&&!E.has(F.name)?(console.log(`Автоматически сбрасываем craftValue для ${F.name}, т.к. нет рецепта`),{...F,craftValue:void 0,hasCraftRecipe:!1}):F);V.some((F,g)=>F.hasCraftRecipe!==i.balance.comparisonItems[g].hasCraftRecipe||F.craftValue!==i.balance.comparisonItems[g].craftValue)&&(console.log("Обновляем список предметов из-за изменений hasCraftRecipe или craftValue"),h("balance.comparisonItems",V))},[i.craftSystem.recipes]),u.useEffect(()=>{if(o){const E=i.craftSystem.recipes.find(V=>V.id===o);if(E){const V=E.variants.map(c=>({id:c.id,name:c.name,ingredients:c.ingredients.map(F=>({itemName:F.itemName,amount:F.amount})),fuelItems:c.fuelItems?c.fuelItems.map(F=>({itemName:F.itemName,amount:F.amount})):[]}));k({name:E.name,resultItemName:E.resultItemName,resultAmount:E.resultAmount,category:E.category,level:E.level,currentVariant:0,variants:V,isSeasonDependent:E.isSeasonDependent||!1,availableSeasons:E.availableSeasons||[],seasonalMultipliers:E.seasonalMultipliers||{},requiresFuel:E.requiresFuel||!1}),x.current=V.map(c=>[...c.ingredients]),f.current=V.map(c=>[...c.fuelItems||[]])}}else k({name:"",resultItemName:"",resultAmount:1,category:"",level:1,currentVariant:0,variants:[{id:"new-variant",name:"Standard",ingredients:[],fuelItems:[]}],isSeasonDependent:!1,availableSeasons:[],seasonalMultipliers:{},requiresFuel:!1}),x.current=[[]],f.current=[[]]},[o,i.craftSystem.recipes]);const N=i.balance.comparisonItems,I=u.useMemo(()=>N.filter(E=>E.isFuel),[N]),A=async()=>{console.log("ПОЛНЫЙ СБРОС craftValue и hasCraftRecipe для ВСЕХ предметов");const E=i.balance.comparisonItems.map(F=>({...F,hasCraftRecipe:!1,craftValue:void 0}));await new Promise(F=>{h("balance.comparisonItems",E),setTimeout(F,200)}),console.log("СБРОС завершен");const V=new Set;i.craftSystem.recipes.forEach(F=>{F.resultItemName&&V.add(F.resultItemName)});const c=i.balance.comparisonItems.map(F=>V.has(F.name)?(console.log(`Восстанавливаем hasCraftRecipe для ${F.name}`),{...F,hasCraftRecipe:!0}):F);await new Promise(F=>{h("balance.comparisonItems",c),setTimeout(F,200)}),console.log("Восстановление hasCraftRecipe завершено")},P=async()=>{if(console.log("Расчет craftValue для результата рецепта:",a.resultItemName),!a.resultItemName||!a.variants.length){console.log("Нет результата или вариантов рецепта");return}const E=i.balance.comparisonItems.find(te=>te.name===a.resultItemName);if(!E){console.log("Не найден предмет результата:",a.resultItemName);return}const V=i.balance.currentConfig.craftBaseMultiplier!==void 0?i.balance.currentConfig.craftBaseMultiplier:1.2,c=i.balance.currentConfig.craftComplexityMultiplier!==void 0?i.balance.currentConfig.craftComplexityMultiplier:.1,F=E.craftComplexity||"Средне",g=i.balance.currentConfig.craftComplexityTypes[F]||1,W=a.variants.map(te=>{if(!te.ingredients.length)return 1/0;const de=te.ingredients.reduce((ve,he)=>{if(!he.itemName)return ve;const ne=i.balance.comparisonItems.find(Me=>Me.name===he.itemName);if(!ne)return ve;let ke=w.calculateItemCost(ne);ne.isHarvest&&ne.growingSeason&&w.currentConfig.currentSeason&&(ne.growingSeason.includes(w.currentConfig.currentSeason)||(console.log(`Ингредиент ${he.itemName} - сезонный и недоступен в текущем сезоне, стоимость увеличена`),ke=w.calculateSeasonalItemCost(ne)));const me=ke*he.amount;return console.log(`Ингредиент ${he.itemName} x${he.amount}: стоимость ${ke}, всего ${me}`),ve+me},0);let Ce=0;a.requiresFuel&&te.fuelItems&&te.fuelItems.length>0&&(Ce=te.fuelItems.reduce((ve,he)=>{if(!he.itemName)return ve;const ne=i.balance.comparisonItems.find(Me=>Me.name===he.itemName);if(!ne)return ve;const ke=w.calculateItemCost(ne),me=ke*he.amount;return console.log(`Топливо ${he.itemName} x${he.amount}: стоимость ${ke}, всего ${me}`),ve+me},0));const Te=de+Ce;return console.log(`Стоимость варианта ${te.name}: ингредиенты=${de}, топливо=${Ce}, всего=${Te}`),Te}).filter(te=>te!==1/0);if(!W.length){console.log("Нет вариантов с ингредиентами");return}const z=Math.min(...W);console.log("Минимальная стоимость ингредиентов и топлива:",z);const Y=z/a.resultAmount;console.log("Стоимость на единицу результата:",Y);const $=V+g*c;console.log("Итоговый множитель:",$);let X=Math.round(Y*$);if(a.isSeasonDependent&&w.currentConfig.currentSeason)if(a.availableSeasons.length>0&&!a.availableSeasons.includes(w.currentConfig.currentSeason))console.log(`Рецепт недоступен в текущем сезоне (${w.currentConfig.currentSeason})`),X=X*2;else{const te=a.seasonalMultipliers[w.currentConfig.currentSeason]||1;te!==1&&(console.log(`Применяем сезонный модификатор для ${w.currentConfig.currentSeason}: ${te}`),X=Math.round(X*te))}console.log("Рассчитанный craftValue за единицу:",X);const ee=i.balance.comparisonItems.map(te=>{if(te.name===a.resultItemName){const de={...te,craftValue:X,hasCraftRecipe:!0};return console.log("Обновляем предмет:",de),de}return te});h("balance.comparisonItems",ee),console.log("Обновлен craftValue для",a.resultItemName,"=",X)},U=(E,V)=>{if(!E.length)return 0;const c=E.reduce((F,g)=>F+g.amount,0);return Math.ceil(c/V)},j=async()=>{if(!a.name||!a.resultItemName){alert("Please fill in all required fields");return}try{let E="";if(o){const V=i.craftSystem.recipes.find(c=>c.id===o);E=(V==null?void 0:V.resultItemName)||"",E&&E!==a.resultItemName&&console.log(`Изменен результат рецепта: ${E} -> ${a.resultItemName}`)}if(await A(),o){const V=i.craftSystem.recipes.map(c=>c.id===o?{...c,name:a.name,resultItemName:a.resultItemName,resultAmount:a.resultAmount,category:a.category,level:a.level,variants:a.variants.map(F=>({id:F.id,name:F.name,ingredients:F.ingredients.map(g=>({itemName:g.itemName,amount:g.amount})),fuelItems:F.fuelItems?F.fuelItems.map(g=>({itemName:g.itemName,amount:g.amount})):[]})),isSeasonDependent:a.isSeasonDependent,availableSeasons:a.isSeasonDependent?a.availableSeasons:[],seasonalMultipliers:a.isSeasonDependent?a.seasonalMultipliers:{},requiresFuel:a.requiresFuel}:c);await new Promise(c=>{h("craftSystem.recipes",V),setTimeout(c,200)})}else{const V={id:`recipe-${i.craftSystem.nextRecipeId}`,name:a.name,resultItemName:a.resultItemName,resultAmount:a.resultAmount,category:a.category,level:a.level,imageId:null,variants:a.variants.map(c=>({id:c.id==="new-variant"?`variant-${i.craftSystem.nextVariantId}`:c.id,name:c.name,ingredients:c.ingredients.map(F=>({itemName:F.itemName,amount:F.amount})),fuelItems:c.fuelItems?c.fuelItems.map(F=>({itemName:F.itemName,amount:F.amount})):[]})),isSeasonDependent:a.isSeasonDependent,availableSeasons:a.isSeasonDependent?a.availableSeasons:[],seasonalMultipliers:a.isSeasonDependent?a.seasonalMultipliers:{},requiresFuel:a.requiresFuel};await new Promise(c=>{h("craftSystem.recipes",[...i.craftSystem.recipes,V]),h("craftSystem.nextRecipeId",i.craftSystem.nextRecipeId+1),h("craftSystem.nextVariantId",i.craftSystem.nextVariantId+a.variants.length),setTimeout(c,200)})}await P(),R()}catch(E){console.error("Ошибка при сохранении рецепта:",E),alert(`Ошибка при сохранении: ${E}`)}},O=()=>{const E=[...a.variants,{id:`new-variant-${a.variants.length}`,name:`Variant ${a.variants.length+1}`,ingredients:[],fuelItems:[]}];k({...a,variants:E,currentVariant:a.variants.length}),x.current=[...x.current,[]],f.current=[...f.current,[]]},Z=()=>{const E={itemName:"",amount:1},V=a.variants.map((F,g)=>g===a.currentVariant?{...F,ingredients:[...F.ingredients,E]}:F);k({...a,variants:V});const c=[...x.current];c[a.currentVariant]||(c[a.currentVariant]=[]),c[a.currentVariant].push(E),x.current=c},n=()=>{const E={itemName:"",amount:1},V=a.variants.map((F,g)=>{if(g===a.currentVariant){const W=F.fuelItems||[];return{...F,fuelItems:[...W,E]}}return F});k({...a,variants:V});const c=[...f.current];c[a.currentVariant]||(c[a.currentVariant]=[]),c[a.currentVariant].push(E),f.current=c},t=(E,V)=>{console.log(`Выбор топлива: ${V} для индекса ${E}`);const c=N.find(W=>W.name===V),F=JSON.parse(JSON.stringify(a.variants));for(F[a.currentVariant].fuelItems||(F[a.currentVariant].fuelItems=[]);F[a.currentVariant].fuelItems.length<=E;)F[a.currentVariant].fuelItems.push({itemName:"",amount:1});if(F[a.currentVariant].fuelItems[E].itemName=V,c&&c.isFuel&&c.fuelEfficiency&&F[a.currentVariant].ingredients.length>0){const W=F[a.currentVariant].ingredients.reduce((Y,$)=>Y+$.amount,0),z=Math.ceil(W/c.fuelEfficiency);F[a.currentVariant].fuelItems[E].amount=z}k({...a,variants:F});const g=[...f.current];for(g[a.currentVariant]||(g[a.currentVariant]=[]);g[a.currentVariant].length<=E;)g[a.currentVariant].push({itemName:"",amount:1});g[a.currentVariant][E]={itemName:V,amount:F[a.currentVariant].fuelItems[E].amount},f.current=g},s=E=>{const V=[...a.variants];if(!V[a.currentVariant].fuelItems)V[a.currentVariant].fuelItems=[];else{const F=V[a.currentVariant].fuelItems;V[a.currentVariant].fuelItems=F?F.filter((g,W)=>W!==E):[]}k({...a,variants:V});const c=[...f.current];c[a.currentVariant]&&c[a.currentVariant].splice(E,1),f.current=c},d=E=>{const V=i.balance.comparisonItems.find(F=>F.name===E);if(!V)return 0;const c=w.calculateItemCost(V);return console.log(`Получение значения для ${E}: ${c}`),c},r=E=>{k(E?{...a,resultItemName:E,name:E}:{...a,resultItemName:"",name:""})},y=(E,V)=>{console.log(`Выбор ингредиента: ${V} для индекса ${E}`);const c=JSON.parse(JSON.stringify(a.variants));if(c[a.currentVariant].ingredients[E].itemName=V,V&&a.resultItemName)try{const g=d(a.resultItemName),W=d(V);if(console.log(`Стоимости: результат=${g}, ингредиент=${W}`),g>0&&W>0){const z=yt(g,a.resultAmount,W);console.log(`Рассчитанное количество: ${z}`),c[a.currentVariant].ingredients[E].amount=z}}catch(g){console.error("Ошибка при расчете количества:",g)}k({...a,variants:c});const F=[...x.current];if(F[a.currentVariant]||(F[a.currentVariant]=[]),F[a.currentVariant][E]={itemName:V,amount:c[a.currentVariant].ingredients[E].amount},x.current=F,a.requiresFuel){c[a.currentVariant].fuelItems||(c[a.currentVariant].fuelItems=[]);const g=c[a.currentVariant].fuelItems;g&&g.length>0&&g.forEach((W,z)=>{if(W.itemName){const Y=N.find($=>$.name===W.itemName);if(Y&&Y.isFuel&&Y.fuelEfficiency){const $=c[a.currentVariant].ingredients.reduce((X,ee)=>X+ee.amount,0);g[z].amount=Math.ceil($/Y.fuelEfficiency)}}})}},p=E=>{const V=[...a.variants];V[a.currentVariant].ingredients.splice(E,1),k({...a,variants:V});const c=[...x.current];if(c[a.currentVariant].splice(E,1),x.current=c,a.requiresFuel){const F=V[a.currentVariant].fuelItems;F&&F.length>0&&setTimeout(()=>{const g=JSON.parse(JSON.stringify(V)),W=g[a.currentVariant].fuelItems;W&&W.forEach((z,Y)=>{if(z.itemName){const $=N.find(X=>X.name===z.itemName);if($&&$.isFuel&&$.fuelEfficiency){const X=g[a.currentVariant].ingredients.reduce((ee,te)=>ee+te.amount,0);W[Y].amount=Math.ceil(X/$.fuelEfficiency)}}}),k({...a,variants:g})},10)}},v=u.useMemo(()=>{if(!a.resultItemName)return{formattedTime:"--",details:{baseTime:0,ingredientsTime:0,totalTime:0,variantTimes:[]}};try{const E=i.resources.items.map(g=>({name:g.name,tier:1,mechanic:"Найти в мире",selectedCategories:[g.category],selectedModifiers:[],selectedLocations:[],frequencyType:"Часто встречаемый",craftComplexity:"Не крафтиться"})),V=[...i.balance.comparisonItems,...E],c={resultItemName:a.resultItemName,level:a.level,variants:a.variants},F=Ke(c,V,i.balance.currentConfig);return{formattedTime:we(F.totalTime),details:F}}catch(E){console.error("Ошибка при расчете времени крафта:",E);const V=i.balance.comparisonItems.find(g=>g.name===a.resultItemName);if(!V)return{formattedTime:"--",details:{baseTime:0,ingredientsTime:0,totalTime:0,variantTimes:[]}};const c=V.craftComplexity||"Средне",F=Qe(c,a.level,i.balance.currentConfig);return{formattedTime:we(F),details:{baseTime:F,ingredientsTime:0,totalTime:F,variantTimes:[]}}}},[a.resultItemName,a.level,a.variants,i.resources.items,i.balance.comparisonItems,i.balance.currentConfig,(G=(B=i.balance.currentConfig)==null?void 0:B.craftTimeConfig)==null?void 0:G.version]);u.useEffect(()=>{S.current=v.details},[v]);const T=()=>v.formattedTime,b=E=>{if(E&&!a.isSeasonDependent){let V={...a.seasonalMultipliers};M.forEach(c=>{V[c]||(V[c]=1)}),k({...a,isSeasonDependent:!0,seasonalMultipliers:V})}else k({...a,isSeasonDependent:E})},D=E=>{const V=a.availableSeasons.includes(E)?a.availableSeasons.filter(c=>c!==E):[...a.availableSeasons,E];k({...a,availableSeasons:V})},J=(E,V)=>{k({...a,seasonalMultipliers:{...a.seasonalMultipliers,[E]:V}})};return e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-sm p-4",children:[e.jsx("h2",{className:"text-lg font-semibold mb-4",children:o?"Edit Recipe":"Create New Recipe"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium mb-1 flex items-center",children:["Recipe Name",e.jsx("span",{className:"ml-2 inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-300",children:"Auto-generated"})]}),e.jsx("input",{type:"text",value:a.name,readOnly:!0,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-700 rounded-md bg-gray-100 dark:bg-gray-800 text-gray-700 dark:text-gray-300 cursor-not-allowed opacity-70",placeholder:"Auto-generated from result item"}),e.jsx("p",{className:"mt-1 text-xs text-gray-500 dark:text-gray-400",children:"Recipe name is automatically set to match the result item name"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Result Item"}),e.jsx(ze,{items:N,value:a.resultItemName,onChange:r,placeholder:"Select Item"})]}),a.resultItemName&&e.jsxs("div",{className:"mt-2 p-3 bg-gray-200 dark:bg-gray-700 rounded-md",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"text-sm font-medium",children:["Craft Time: ",T()]}),e.jsxs("div",{className:"mt-1 text-xs text-gray-500 dark:text-gray-400",children:[e.jsxs("div",{children:["Base processing: ",we(S.current.baseTime)]}),S.current.ingredientsTime>0&&e.jsxs("div",{children:["Ingredients processing: +",we(S.current.ingredientsTime)]})]})]}),S.current.variantTimes&&S.current.variantTimes.length>0&&e.jsx("button",{onClick:()=>C(!L),className:"text-xs text-blue-500 hover:underline",children:L?"Hide details":"Show details"})]}),L&&S.current.variantTimes&&S.current.variantTimes.length>0&&e.jsxs("div",{className:"mt-3 pt-3 border-t border-gray-300 dark:border-gray-600",children:[e.jsx("h4",{className:"text-xs font-medium mb-2",children:"Processing time per variant:"}),e.jsx("div",{className:"space-y-2",children:S.current.variantTimes.map((E,V)=>{var F;const c=((F=a.variants.find(g=>g.id===E.variantId))==null?void 0:F.name)||`Variant ${V+1}`;return e.jsxs("div",{className:"text-xs border border-gray-300 dark:border-gray-600 rounded-md p-2",children:[e.jsxs("div",{className:"font-medium mb-1",children:[c,": ",we(E.time)]}),E.breakdown&&E.breakdown.length>0&&e.jsx("div",{className:"space-y-1 mt-1 pl-2 border-l-2 border-gray-300 dark:border-gray-600",children:E.breakdown.map((g,W)=>e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("span",{children:[g.itemName," x",g.amount]}),e.jsx("span",{children:we(g.totalTime)})]},`ing-${W}`))})]},`time-${V}`)})}),e.jsx("p",{className:"mt-2 text-xs text-gray-500 dark:text-gray-400",children:"Note: The total time uses the fastest variant for optimal crafting."})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Result Amount"}),e.jsx("input",{type:"number",value:a.resultAmount,onChange:E=>k({...a,resultAmount:parseInt(E.target.value)||1}),className:"w-full px-3 py-2 border border-gray-600 dark:border-gray-700 rounded-md bg-gray-100 dark:bg-gray-800 text-gray-900 dark:text-gray-100",min:"1"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Category"}),e.jsxs("select",{value:a.category,onChange:E=>k({...a,category:E.target.value}),className:"w-full px-3 py-2 border border-gray-600 dark:border-gray-700 rounded-md bg-gray-100 dark:bg-gray-800 text-gray-900 dark:text-gray-100",children:[e.jsx("option",{value:"",children:"Select Category"}),Object.keys(i.balance.currentConfig.categories).map(E=>e.jsx("option",{value:E,children:E},E))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Recipe Level"}),e.jsx("input",{type:"number",value:a.level,onChange:E=>k({...a,level:parseInt(E.target.value)||1}),className:"w-full px-3 py-2 border border-gray-600 dark:border-gray-700 rounded-md bg-gray-100 dark:bg-gray-800 text-gray-900 dark:text-gray-100",min:"1",max:"10"})]}),e.jsxs("div",{className:"mt-6 p-3 border border-gray-300 dark:border-gray-600 rounded-lg",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",id:"requiresFuel",checked:a.requiresFuel,onChange:E=>k({...a,requiresFuel:E.target.checked}),className:"h-5 w-5 text-primary rounded border-gray-300 dark:border-gray-600 focus:ring-primary"}),e.jsx("label",{htmlFor:"requiresFuel",className:"ml-2 text-base font-medium text-gray-700 dark:text-gray-300",children:"Требуется топливо (печь)"})]}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-2",children:"Включите эту опцию, если для крафта требуется печь и расходуется топливо. Для каждого варианта рецепта можно указать разные типы топлива."})]}),e.jsxs("div",{className:"space-y-4 p-4 border border-gray-300 dark:border-gray-600 rounded-lg",children:[e.jsx("h3",{className:"text-lg font-medium",children:"Сезонные настройки"}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",id:"isSeasonDependent",checked:a.isSeasonDependent,onChange:E=>b(E.target.checked),className:"mr-2 h-4 w-4"}),e.jsx("label",{htmlFor:"isSeasonDependent",children:"Рецепт зависит от сезона"})]}),a.isSeasonDependent&&e.jsxs("div",{children:[e.jsx("label",{className:"block mb-2",children:"Доступные сезоны для крафта:"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:M.map(E=>e.jsxs("label",{className:"flex items-center p-2 border border-gray-300 dark:border-gray-600 rounded-md",children:[e.jsx("input",{type:"checkbox",checked:a.availableSeasons.includes(E),onChange:()=>D(E),className:"mr-2 h-4 w-4"}),e.jsx("span",{children:E})]},E))}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-1",children:"Если не выбран ни один сезон, рецепт доступен во всех сезонах."})]}),a.isSeasonDependent&&e.jsxs("div",{children:[e.jsx("label",{className:"block mb-2",children:"Сезонные модификаторы стоимости:"}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:M.map(E=>e.jsxs("div",{className:"flex items-center",children:[e.jsxs("span",{className:"w-20",children:[E,":"]}),e.jsx("input",{type:"number",min:"0.1",step:"0.1",value:a.seasonalMultipliers[E]||1,onChange:V=>{const c=parseFloat(V.target.value);!isNaN(c)&&c>0&&J(E,c)},className:"ml-2 px-2 py-1 border border-gray-600 dark:border-gray-700 rounded-md bg-gray-100 dark:bg-gray-800 text-gray-900 dark:text-gray-100 w-24"}),e.jsx("span",{className:"ml-2",children:"×"})]},E))}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-1",children:"Указанные значения будут умножать базовую стоимость крафта в соответствующем сезоне."})]}),e.jsxs("div",{className:"mt-2 p-2 bg-gray-100 dark:bg-gray-700 rounded-md",children:[e.jsxs("div",{className:"text-sm",children:["Текущий сезон: ",e.jsx("span",{className:"font-medium",children:w.currentConfig.currentSeason||"Не выбран"})]}),a.isSeasonDependent&&w.currentConfig.currentSeason&&e.jsx("div",{className:"mt-1 text-sm",children:a.availableSeasons.length>0&&!a.availableSeasons.includes(w.currentConfig.currentSeason)?e.jsx("span",{className:"text-red-500 dark:text-red-400",children:"Рецепт недоступен в текущем сезоне"}):e.jsxs("span",{className:"text-green-500 dark:text-green-400",children:["Рецепт доступен в текущем сезоне ",a.seasonalMultipliers[w.currentConfig.currentSeason]!==1?`(модификатор: ${a.seasonalMultipliers[w.currentConfig.currentSeason]}×)`:""]})})]})]}),e.jsxs("div",{className:"mt-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("h3",{className:"font-medium",children:"Recipe Variants"}),e.jsx("button",{onClick:O,className:"px-2 py-1 bg-blue-500 text-white rounded-md text-sm hover:bg-blue-600 transition",children:"Add Variant"})]}),e.jsx("div",{className:"flex border-b border-gray-300 dark:border-gray-700 mb-4",children:a.variants.map((E,V)=>e.jsx("button",{className:`px-4 py-2 ${a.currentVariant===V?"border-b-2 border-primary text-primary":"text-gray-500 dark:text-gray-400 hover:text-primary dark:hover:text-primary"}`,onClick:()=>k({...a,currentVariant:V}),children:E.name},E.id))}),a.variants.length>0&&e.jsxs("div",{children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Variant Name"}),e.jsx("input",{type:"text",value:a.variants[a.currentVariant].name,onChange:E=>{const V=[...a.variants];V[a.currentVariant]={...V[a.currentVariant],name:E.target.value},k({...a,variants:V})},className:"w-full px-3 py-2 border border-gray-600 dark:border-gray-700 rounded-md bg-gray-100 dark:bg-gray-800 text-gray-900 dark:text-gray-100"})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("h4",{className:"font-medium text-sm",children:"Ingredients"}),e.jsx("div",{className:"flex space-x-2",children:e.jsx("button",{onClick:Z,className:"px-2 py-1 bg-gray-200 dark:bg-gray-700 rounded-md text-sm hover:bg-gray-300 dark:hover:bg-gray-600 transition",children:"Add Ingredient"})})]}),a.variants[a.currentVariant].ingredients.length===0?e.jsx("div",{className:"text-center py-4 text-gray-500 dark:text-gray-400 border border-dashed border-gray-500 dark:border-gray-600 rounded-md bg-gray-50 dark:bg-gray-900/30",children:"No ingredients yet. Add some ingredients to this variant."}):e.jsx("div",{className:"space-y-3",children:a.variants[a.currentVariant].ingredients.map((E,V)=>{var W,z;const c=N.find(Y=>Y.name===E.itemName),F=(c==null?void 0:c.isHarvest)&&(c==null?void 0:c.growingSeason),g=w.currentConfig.currentSeason&&((W=c==null?void 0:c.growingSeason)==null?void 0:W.includes(w.currentConfig.currentSeason));return e.jsxs("div",{children:[e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(ze,{items:N,value:E.itemName,onChange:Y=>y(V,Y),placeholder:"Select Ingredient",className:"flex-1"}),e.jsx("input",{type:"number",value:E.amount,onChange:Y=>{const $=[...a.variants];$[a.currentVariant].ingredients[V].amount=parseInt(Y.target.value)||1,k({...a,variants:$})},className:"w-20 px-3 py-2 border border-gray-600 dark:border-gray-700 rounded-md bg-gray-100 dark:bg-gray-800 text-gray-900 dark:text-gray-100",min:"1"}),e.jsx("button",{onClick:()=>p(V),className:"px-2 py-2 bg-red-500 text-white rounded-md hover:bg-red-600 transition",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),F&&e.jsxs("div",{className:"mt-1 ml-2 text-xs",children:[e.jsxs("div",{className:"flex flex-wrap gap-1 mb-1",children:[e.jsx("span",{children:"Сезоны роста:"}),(z=c==null?void 0:c.growingSeason)==null?void 0:z.map(Y=>e.jsx("span",{className:`px-1.5 py-0.5 rounded-full ${w.currentConfig.currentSeason===Y?"bg-green-100 dark:bg-green-900/30 text-green-800 dark:text-green-300":"bg-gray-100 dark:bg-gray-700 text-gray-800 dark:text-gray-300"}`,children:Y},Y))]}),w.currentConfig.currentSeason&&e.jsx("div",{className:g?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400",children:g?`✓ Доступен в текущем сезоне (${w.currentConfig.currentSeason})`:`⚠ Недоступен в текущем сезоне (${w.currentConfig.currentSeason})`})]})]},`ingredient-${a.currentVariant}-${V}`)})})]}),a.requiresFuel&&e.jsxs("div",{className:"mt-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("h4",{className:"font-medium text-sm",children:"Топливо"}),e.jsx("button",{onClick:n,className:"px-2 py-1 bg-gray-200 dark:bg-gray-700 rounded-md text-sm hover:bg-gray-300 dark:hover:bg-gray-600 transition",children:"Добавить топливо"})]}),!a.variants[a.currentVariant].fuelItems||((K=a.variants[a.currentVariant].fuelItems)==null?void 0:K.length)===0?e.jsx("div",{className:"text-center py-4 text-gray-500 dark:text-gray-400 border border-dashed border-gray-500 dark:border-gray-600 rounded-md bg-gray-50 dark:bg-gray-900/30",children:"Не указано топливо. Добавьте хотя бы один тип топлива."}):e.jsx("div",{className:"space-y-3",children:(ie=a.variants[a.currentVariant].fuelItems)==null?void 0:ie.map((E,V)=>{const c=N.find(W=>W.name===E.itemName),F=c==null?void 0:c.isFuel,g=(c==null?void 0:c.fuelEfficiency)||1;return e.jsxs("div",{children:[e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(ze,{items:I,value:E.itemName,onChange:W=>t(V,W),placeholder:"Выберите топливо",className:"flex-1"}),e.jsx("input",{type:"number",value:E.amount,onChange:W=>{const z=[...a.variants];z[a.currentVariant].fuelItems||(z[a.currentVariant].fuelItems=[]);const Y=z[a.currentVariant].fuelItems;for(;Y.length<=V;)Y.push({itemName:"",amount:1});Y[V].amount=parseInt(W.target.value)||1,k({...a,variants:z})},className:"w-20 px-3 py-2 border border-gray-600 dark:border-gray-700 rounded-md bg-gray-100 dark:bg-gray-800 text-gray-900 dark:text-gray-100",min:"1"}),e.jsx("button",{onClick:()=>s(V),className:"px-2 py-2 bg-red-500 text-white rounded-md hover:bg-red-600 transition",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),F&&e.jsxs("div",{className:"mt-1 ml-2 text-xs",children:[e.jsxs("div",{className:"text-gray-600 dark:text-gray-400",children:["Эффективность: 1 ед. топлива на ",g," ед. ресурса"]}),a.variants[a.currentVariant].ingredients.length>0&&e.jsxs("div",{className:"mt-1 text-green-600 dark:text-green-400",children:["Расчетное количество: ",U(a.variants[a.currentVariant].ingredients,g)," шт."]})]})]},`fuel-${a.currentVariant}-${V}`)})})]})]})]}),e.jsxs("div",{className:"flex justify-end space-x-2 mt-6",children:[e.jsx("button",{onClick:R,className:"px-4 py-2 bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200 rounded-md hover:bg-gray-300 dark:hover:bg-gray-600 transition",children:"Cancel"}),e.jsx("button",{onClick:j,className:"px-4 py-2 bg-primary text-white rounded-md hover:bg-opacity-90 transition",children:"Save Recipe"})]})]})]})}function Wt(){var s,d;const{state:o}=xe(),R=je(),{recipes:i}=o.craftSystem,[h,w]=u.useState("profit"),[a,k]=u.useState("desc"),[x,f]=u.useState(null),[S,L]=u.useState(null),[C,M]=u.useState("profit");u.useEffect(()=>{console.log("RecipeAnalysis: Загружены рецепты",i);const r=i.filter(y=>!Ve(y));r.length>0?(console.error("Найдены некорректные рецепты:",r),f("Некоторые рецепты имеют неправильную структуру. Проверьте консоль для подробностей.")):f(null)},[i]);const N=u.useMemo(()=>{const r=o.resources.items.map(y=>({name:y.name,tier:1,mechanic:"Найти в мире",selectedCategories:[y.category],selectedModifiers:[],selectedLocations:[],frequencyType:"Часто встречаемый",craftComplexity:"Не крафтиться",imageId:y.imageId||null}));return[...o.balance.comparisonItems,...r]},[o.resources.items,o.balance.comparisonItems]),I=r=>r?R.calculateItemCost(r):0,A=(r,y)=>{if(!r||!r.variants||r.variants.length===0)return{ingredientsCost:0,craftValue:0,profit:0,profitPercentage:0,variantCosts:[]};const p=y.find(B=>B.name===r.resultItemName);if(!p)return{ingredientsCost:0,craftValue:0,profit:0,profitPercentage:0,variantCosts:[]};const v=I(p)*(r.resultAmount||1),T=r.variants.filter(B=>B&&B.ingredients&&Array.isArray(B.ingredients)).map(B=>{const G=B.ingredients.reduce((K,ie)=>{if(!ie||!ie.itemName)return K;const E=y.find(c=>c.name===ie.itemName);if(!E)return K;const V=I(E);return K+V*ie.amount},0);return{id:B.id,cost:G}}),b=T.length>0?Math.min(...T.map(B=>B.cost)):0,D=v-b,J=b>0?D/b*100:0;return{ingredientsCost:b,craftValue:v,profit:D,profitPercentage:J,variantCosts:T}},P=u.useMemo(()=>{if(!i||i.length===0)return[];try{return i.filter(r=>Ve(r)).map(r=>{try{const y=r.resultItemName,p=N.find(B=>B.name===y),T=I(p)*(r.resultAmount||1),{variantCosts:b}=A(r,N),D=r.variants.filter(B=>B&&B.ingredients&&Array.isArray(B.ingredients)).map(B=>{try{const G=b.find(z=>z.id===B.id),K=(G==null?void 0:G.cost)||0,ie={...r};ie.variants=[B];const V=Ke(ie,N,o.balance.currentConfig).totalTime,c=T-K,F=V>0?c/(V/60):0,g=K>0?c/K:0,W=B.ingredients.filter(z=>z&&z.itemName).map(z=>{const Y=N.find(X=>X.name===z.itemName),$=I(Y);return{name:z.itemName,amount:z.amount,cost:$*z.amount,tier:(Y==null?void 0:Y.tier)||1}});return{variantId:B.id,variantName:B.name,ingredientsCost:K,craftTime:V,profit:c,efficiency:F,roi:g,ingredients:W}}catch(G){return console.error("Ошибка анализа варианта:",B,G),null}}).filter(Boolean);if(D.length===0)return null;let J=D[0];if(D.length>1)for(let B=1;B<D.length;B++)D[B]&&J&&D[B].efficiency>J.efficiency&&(J=D[B]);return{recipeId:r.id,recipeName:r.name,resultName:y,resultValue:T,variants:D,bestVariant:J}}catch(y){const p=y instanceof Error?y.message:String(y);return console.error("Ошибка анализа рецепта:",r,p),null}}).filter(Boolean)}catch(r){const y=r instanceof Error?r.message:String(r);return console.error("Ошибка анализа рецептов:",y),f(`Ошибка при анализе рецептов: ${y}`),[]}},[i,N,o.balance.currentConfig,(d=(s=o.balance.currentConfig)==null?void 0:s.craftTimeConfig)==null?void 0:d.version]),U=u.useMemo(()=>!P||P.length===0?[]:[...P].sort((r,y)=>{if(!r||!y||!r.bestVariant||!y.bestVariant)return 0;let p=0,v=0;switch(h){case"name":p=r.recipeName,v=y.recipeName;break;case"profit":p=r.bestVariant.profit,v=y.bestVariant.profit;break;case"efficiency":p=r.bestVariant.efficiency,v=y.bestVariant.efficiency;break;case"roi":p=r.bestVariant.roi,v=y.bestVariant.roi;break;case"craftTime":p=r.bestVariant.craftTime,v=y.bestVariant.craftTime;break;default:p=r.bestVariant.profit,v=y.bestVariant.profit}return typeof p=="string"&&typeof v=="string"?a==="asc"?p.localeCompare(v):v.localeCompare(p):a==="asc"?p-v:v-p}),[P,h,a]),j=u.useMemo(()=>!S||!P?null:P.find(r=>r.recipeId===S)||null,[S,P]),O=u.useMemo(()=>{if(!U||U.length===0)return{};const r=document.documentElement.classList.contains("dark"),y=[...U].filter(G=>{if(!G.bestVariant)return!1;switch(C){case"profit":return G.bestVariant.profit>0;case"efficiency":return G.bestVariant.efficiency>0;case"roi":return G.bestVariant.roi>0;default:return G.bestVariant.profit>0}}).sort((G,K)=>{if(!G.bestVariant||!K.bestVariant)return 0;switch(C){case"profit":return K.bestVariant.profit-G.bestVariant.profit;case"efficiency":return K.bestVariant.efficiency-G.bestVariant.efficiency;case"roi":return K.bestVariant.roi-G.bestVariant.roi;default:return K.bestVariant.profit-G.bestVariant.profit}}).slice(0,10);if(y.length===0)return{backgroundColor:"transparent",title:{text:`No recipes with positive ${C} found`,textStyle:{color:r?"#ccc":"#333",fontSize:14},left:"center",top:"middle"}};const p=y.map(G=>G.recipeName),v=y.map(G=>Math.round(G.bestVariant.profit)),T=y.map(G=>parseFloat(G.bestVariant.efficiency.toFixed(1))),b=y.map(G=>parseFloat((G.bestVariant.roi*100).toFixed(1)));let D,J,B;switch(C){case"profit":J="Top Recipes by Profit",B="#10B981",D=[{name:"Profit",type:"bar",data:v,itemStyle:{color:B},emphasis:{itemStyle:{color:"#059669"}},label:{show:!0,position:"top",formatter:"{c}",color:r?"#ccc":"#333"}}];break;case"efficiency":J="Top Recipes by Efficiency (profit/min)",B="#3B82F6",D=[{name:"Efficiency",type:"bar",data:T,itemStyle:{color:B},emphasis:{itemStyle:{color:"#2563EB"}},label:{show:!0,position:"top",formatter:"{c}",color:r?"#ccc":"#333"}}];break;case"roi":J="Top Recipes by ROI (%)",B="#8B5CF6",D=[{name:"ROI %",type:"bar",data:b,itemStyle:{color:B},emphasis:{itemStyle:{color:"#7C3AED"}},label:{show:!0,position:"top",formatter:"{c}%",color:r?"#ccc":"#333"}}];break;default:J="Recipe Analysis",B="#10B981",D=[{name:"Profit",type:"bar",data:v,itemStyle:{color:B},emphasis:{itemStyle:{color:"#059669"}},label:{show:!0,position:"top",formatter:"{c}",color:r?"#ccc":"#333"}}]}return{backgroundColor:"transparent",title:{text:J,left:"center",textStyle:{color:r?"#ccc":"#333"}},tooltip:{trigger:"axis",axisPointer:{type:"shadow"},backgroundColor:r?"rgba(30, 30, 30, 0.9)":"rgba(255, 255, 255, 0.9)",borderColor:r?"#555":"#ddd",textStyle:{color:r?"#fff":"#333"}},grid:{left:"5%",right:"5%",bottom:"15%",top:"15%",containLabel:!0},xAxis:{type:"category",data:p,axisLabel:{interval:0,rotate:30,fontSize:10,color:r?"#ccc":"#333",margin:15},axisLine:{lineStyle:{color:r?"rgba(255, 255, 255, 0.2)":"rgba(0, 0, 0, 0.2)"}}},yAxis:{type:"value",name:C==="roi"?"Percentage (%)":"Value",nameTextStyle:{color:r?"#ccc":"#333"},axisLabel:{color:r?"#ccc":"#333"},splitLine:{lineStyle:{color:r?"rgba(255, 255, 255, 0.1)":"rgba(0, 0, 0, 0.1)"}}},series:D}},[U,C]),Z=u.useMemo(()=>{if(!j)return{};const r=document.documentElement.classList.contains("dark"),{variants:y}=j,p=y.map(G=>G.variantName),v=y.map(G=>Math.round(G.profit)),T=y.map(G=>parseFloat(G.efficiency.toFixed(1))),b=y.map(G=>parseFloat((G.roi*100).toFixed(1))),D=y.map(G=>parseFloat((G.craftTime/60).toFixed(1))),J=y.map(G=>Math.round(G.ingredientsCost)),B=y.findIndex(G=>G.variantId===j.bestVariant.variantId);return{backgroundColor:"transparent",title:{text:`${j.recipeName} - Variant Comparison`,left:"center",textStyle:{color:r?"#ccc":"#333"}},tooltip:{trigger:"axis",axisPointer:{type:"shadow"},backgroundColor:r?"rgba(30, 30, 30, 0.9)":"rgba(255, 255, 255, 0.9)",borderColor:r?"#555":"#ddd",textStyle:{color:r?"#fff":"#333"}},legend:{data:["Profit","Efficiency (profit/min)","ROI (%)","Craft Time (min)","Cost"],top:30,textStyle:{color:r?"#ccc":"#333"}},grid:{left:"5%",right:"5%",bottom:"10%",containLabel:!0,top:80},xAxis:{type:"category",data:p,axisLabel:{interval:0,rotate:p.length>2?30:0,color:r?"#ccc":"#333"},axisLine:{lineStyle:{color:r?"rgba(255, 255, 255, 0.2)":"rgba(0, 0, 0, 0.2)"}}},yAxis:[{type:"value",name:"Value",position:"left",nameTextStyle:{color:r?"#ccc":"#333"},axisLabel:{color:r?"#ccc":"#333"},splitLine:{lineStyle:{color:r?"rgba(255, 255, 255, 0.1)":"rgba(0, 0, 0, 0.1)"}}},{type:"value",name:"Time (min)",position:"right",nameTextStyle:{color:r?"#ccc":"#333"},axisLabel:{color:r?"#ccc":"#333"},splitLine:{show:!1}}],series:[{name:"Profit",type:"bar",data:v.map((G,K)=>({value:G,itemStyle:{color:K===B?"#10B981":"#34D399"},emphasis:{itemStyle:{color:K===B?"#059669":"#10B981"}}})),label:{show:!0,position:"top",color:r?"#ccc":"#333",formatter:"{c}"}},{name:"Efficiency (profit/min)",type:"bar",data:T.map((G,K)=>({value:G,itemStyle:{color:K===B?"#3B82F6":"#60A5FA"},emphasis:{itemStyle:{color:K===B?"#2563EB":"#3B82F6"}}})),label:{show:!0,position:"top",color:r?"#ccc":"#333",formatter:"{c}"}},{name:"ROI (%)",type:"bar",data:b.map((G,K)=>({value:G,itemStyle:{color:K===B?"#8B5CF6":"#A78BFA"},emphasis:{itemStyle:{color:K===B?"#7C3AED":"#8B5CF6"}}})),label:{show:!0,position:"top",color:r?"#ccc":"#333",formatter:"{c}%"}},{name:"Cost",type:"bar",data:J.map((G,K)=>({value:G,itemStyle:{color:K===B?"#F59E0B":"#FBBF24"},emphasis:{itemStyle:{color:K===B?"#D97706":"#F59E0B"}}})),label:{show:!0,position:"top",color:r?"#ccc":"#333",formatter:"{c}"}},{name:"Craft Time (min)",type:"line",yAxisIndex:1,data:D.map((G,K)=>({value:G,itemStyle:{color:K===B?"#EF4444":"#F87171"}})),symbol:"circle",symbolSize:8,lineStyle:{width:2,type:"dashed",color:"#EF4444"},label:{show:!0,position:"top",color:r?"#ccc":"#333",formatter:"{c}"}}]}},[j]),n=u.useMemo(()=>{if(!j||!j.bestVariant)return{};const r=document.documentElement.classList.contains("dark"),{ingredients:y}=j.bestVariant;if(y.length===0)return{backgroundColor:"transparent",title:{text:"No ingredients available",textStyle:{color:r?"#ccc":"#333",fontSize:14},left:"center",top:"middle"}};const p=[...y].sort((b,D)=>D.cost-b.cost),v=p.map(b=>`${b.name} x${b.amount}`),T=["#3B82F6","#10B981","#8B5CF6","#F59E0B","#EF4444","#EC4899","#6366F1","#14B8A6","#F97316","#06B6D4"];return{backgroundColor:"transparent",title:{text:`${j.recipeName} - Best Variant Ingredients`,left:"center",textStyle:{color:r?"#ccc":"#333"}},tooltip:{trigger:"item",formatter:function(b){return!b||!b.data?"":`${b.name}: ${b.value} (${b.percent}%)`},backgroundColor:r?"rgba(30, 30, 30, 0.9)":"rgba(255, 255, 255, 0.9)",borderColor:r?"#555":"#ddd",textStyle:{color:r?"#fff":"#333"}},legend:{type:"scroll",orient:"vertical",right:10,top:20,bottom:20,data:v,textStyle:{color:r?"#ccc":"#333"},pageTextStyle:{color:r?"#ccc":"#333"},pageIconColor:r?"#ccc":"#333",pageIconInactiveColor:r?"#666":"#aaa",formatter:function(b){return b.length>15?b.substring(0,15)+"...":b}},series:[{name:"Ingredient Cost",type:"pie",radius:["40%","70%"],center:["35%","50%"],data:p.map((b,D)=>({name:`${b.name} x${b.amount}`,value:Math.round(b.cost),itemStyle:{color:T[D%T.length]}})),emphasis:{itemStyle:{shadowBlur:10,shadowOffsetX:0,shadowColor:"rgba(0, 0, 0, 0.5)"}},label:{show:!1},labelLine:{show:!1}}]}},[j]),t=r=>{L(y=>y===r?null:r)};return x?e.jsxs("div",{className:"bg-red-100 dark:bg-red-900/30 rounded-lg shadow-sm p-4 border border-red-300 dark:border-red-700",children:[e.jsx("h2",{className:"text-lg font-semibold text-red-800 dark:text-red-400 mb-2",children:"Ошибка анализа"}),e.jsx("p",{className:"text-red-700 dark:text-red-300",children:x})]}):e.jsxs("div",{className:"space-y-6",children:[U.length>0&&e.jsxs("div",{className:"bg-gray-100 dark:bg-gray-800 rounded-lg shadow-sm p-4 border border-gray-300 dark:border-gray-700",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h2",{className:"text-lg font-semibold",children:"Recipes Overview"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("button",{onClick:()=>M("profit"),className:`px-3 py-1 rounded text-sm ${C==="profit"?"bg-green-500 text-white":"bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300"}`,children:"Profit"}),e.jsx("button",{onClick:()=>M("efficiency"),className:`px-3 py-1 rounded text-sm ${C==="efficiency"?"bg-blue-500 text-white":"bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300"}`,children:"Efficiency"}),e.jsx("button",{onClick:()=>M("roi"),className:`px-3 py-1 rounded text-sm ${C==="roi"?"bg-purple-500 text-white":"bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300"}`,children:"ROI"})]})]}),e.jsx("div",{className:"h-72 mt-4",children:e.jsx(Ne,{options:O})}),e.jsx("div",{className:"mt-2 text-sm text-gray-500 dark:text-gray-400 text-center",children:"Click on a recipe in the table below to see detailed analysis"})]}),e.jsxs("div",{className:"bg-gray-100 dark:bg-gray-800 rounded-lg shadow-sm p-4 border border-gray-300 dark:border-gray-700",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h2",{className:"text-lg font-semibold",children:"Recipe Analysis"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("select",{value:h,onChange:r=>w(r.target.value),className:"px-3 py-2 border border-gray-600 dark:border-gray-700 rounded-md bg-gray-100 dark:bg-gray-800 text-gray-900 dark:text-gray-100 text-sm",children:[e.jsx("option",{value:"name",children:"Name"}),e.jsx("option",{value:"profit",children:"Profit"}),e.jsx("option",{value:"efficiency",children:"Efficiency"}),e.jsx("option",{value:"roi",children:"ROI"}),e.jsx("option",{value:"craftTime",children:"Craft Time"})]}),e.jsx("button",{onClick:()=>k(r=>r==="asc"?"desc":"asc"),className:"px-3 py-2 bg-gray-200 dark:bg-gray-700 rounded-md hover:bg-gray-300 dark:hover:bg-gray-600 transition",children:a==="asc"?"↑":"↓"})]})]}),!i||i.length===0?e.jsx("div",{className:"text-center py-10 text-gray-500 dark:text-gray-400 border border-dashed border-gray-500 dark:border-gray-600 rounded-md bg-gray-50 dark:bg-gray-900/30",children:"No recipes available for analysis. Create some recipes first!"}):U.length===0?e.jsx("div",{className:"text-center py-10 text-gray-500 dark:text-gray-400 border border-dashed border-gray-500 dark:border-gray-600 rounded-md bg-gray-50 dark:bg-gray-900/30",children:"Cannot analyze recipes. Check console for errors."}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200 dark:divide-gray-700",children:[e.jsx("thead",{className:"bg-gray-50 dark:bg-gray-700",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Recipe"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Result"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Time"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Cost"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Value"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-green-500 dark:text-green-400 uppercase tracking-wider",children:"Profit"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-blue-500 dark:text-blue-400 uppercase tracking-wider",children:"Efficiency"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-purple-500 dark:text-purple-400 uppercase tracking-wider",children:"ROI"})]})}),e.jsx("tbody",{className:"bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700",children:U.map(r=>e.jsxs("tr",{className:`hover:bg-gray-50 dark:hover:bg-gray-700 cursor-pointer ${S===r.recipeId?"bg-blue-50 dark:bg-blue-900/20":""}`,onClick:()=>t(r.recipeId),children:[e.jsx("td",{className:"px-4 py-3 text-sm font-medium",children:r.recipeName}),e.jsx("td",{className:"px-4 py-3 text-sm",children:r.resultName}),e.jsx("td",{className:"px-4 py-3 text-sm",children:r.bestVariant?we(r.bestVariant.craftTime):"--"}),e.jsx("td",{className:"px-4 py-3 text-sm",children:r.bestVariant?Math.round(r.bestVariant.ingredientsCost):"--"}),e.jsx("td",{className:"px-4 py-3 text-sm",children:Math.round(r.resultValue)}),e.jsx("td",{className:"px-4 py-3 text-sm font-medium text-green-500 dark:text-green-400",children:r.bestVariant?`${r.bestVariant.profit>0?"+":""}${Math.round(r.bestVariant.profit)}`:"--"}),e.jsx("td",{className:"px-4 py-3 text-sm text-blue-500 dark:text-blue-400",children:r.bestVariant?`${r.bestVariant.efficiency.toFixed(1)}/min`:"--"}),e.jsx("td",{className:"px-4 py-3 text-sm text-purple-500 dark:text-purple-400",children:r.bestVariant?`${(r.bestVariant.roi*100).toFixed(1)}%`:"--"})]},r.recipeId))})]})})]}),j&&e.jsxs("div",{className:"bg-gray-100 dark:bg-gray-800 rounded-lg shadow-sm p-4 border border-gray-300 dark:border-gray-700",children:[e.jsxs("h2",{className:"text-lg font-semibold mb-4",children:[j.recipeName," - Detailed Analysis"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-6",children:[e.jsxs("div",{className:"bg-white dark:bg-gray-900 rounded-lg p-4 border border-gray-200 dark:border-gray-700",children:[e.jsx("h3",{className:"text-md font-medium mb-2",children:"Variant Comparison"}),e.jsx("div",{className:"h-64",children:e.jsx(Ne,{options:Z})})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-900 rounded-lg p-4 border border-gray-200 dark:border-gray-700",children:[e.jsx("h3",{className:"text-md font-medium mb-2",children:"Ingredients Cost Distribution"}),e.jsx("div",{className:"h-64",children:e.jsx(Ne,{options:n})})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200 dark:divide-gray-700",children:[e.jsx("thead",{className:"bg-gray-50 dark:bg-gray-700",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Variant"}),e.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Ingredients"}),e.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Cost"}),e.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-green-500 dark:text-green-400 uppercase tracking-wider",children:"Profit"}),e.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-blue-500 dark:text-blue-400 uppercase tracking-wider",children:"Efficiency"})]})}),e.jsx("tbody",{className:"bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700",children:j.variants.map(r=>{var y,p;return e.jsxs("tr",{className:`hover:bg-gray-50 dark:hover:bg-gray-700 ${r.variantId===((y=j.bestVariant)==null?void 0:y.variantId)?"bg-green-50 dark:bg-green-900/20":""}`,children:[e.jsxs("td",{className:"px-4 py-2 text-sm font-medium",children:[r.variantName,r.variantId===((p=j.bestVariant)==null?void 0:p.variantId)&&e.jsx("span",{className:"ml-2 text-green-500 dark:text-green-400",children:"★ Best"})]}),e.jsx("td",{className:"px-4 py-2 text-sm",children:e.jsx("div",{className:"space-y-1",children:r.ingredients.map((v,T)=>e.jsxs("div",{className:"flex justify-between text-xs",children:[e.jsxs("span",{children:[v.name," (T",v.tier,") x",v.amount]}),e.jsxs("span",{className:"text-gray-500 dark:text-gray-400",children:["(",Math.round(v.cost),")"]})]},T))})}),e.jsx("td",{className:"px-4 py-2 text-sm",children:Math.round(r.ingredientsCost)}),e.jsxs("td",{className:"px-4 py-2 text-sm text-green-500 dark:text-green-400",children:[r.profit>0?"+":"",Math.round(r.profit)]}),e.jsxs("td",{className:"px-4 py-2 text-sm text-blue-500 dark:text-blue-400",children:[r.efficiency.toFixed(1),"/min"]})]},r.variantId)})})]})})]})]})}const qt=({options:o,...R})=>{const i=u.useRef(null);return u.useEffect(()=>{i.current&&(i.current.setOption(o),i.current.on("graphroam",()=>{var a,k,x;const h=(x=(k=(a=i.current)==null?void 0:a.getModel)==null?void 0:k.call(a))==null?void 0:x.getSeriesByIndex(0);if(!h)return;const w=h.getData();if(w&&o.graphic&&o.graphic.elements){const f=o.graphic.elements;Array.isArray(f)&&f.forEach(S=>{var L,C;if(S&&S.type==="image"&&S.id){const M=S.id.replace("img_",""),N=w.indexOfName(M);if(N>=0){const I=w.getItemLayout(N);if(I&&i.current){const A=((L=S.style)==null?void 0:L.width)||0,P=((C=S.style)==null?void 0:C.height)||0;i.current.setOption({graphic:{elements:[{$action:"merge",id:S.id,style:{x:I.x-A/2,y:I.y-P/2}}]}},!1)}}}})}}))},[o]),e.jsx(Ne,{options:o,style:R.style,className:R.className,onChartInit:h=>{i.current=h,R.onChartInit&&R.onChartInit(h)}})};function Ut(){var n;const{state:o}=xe(),[R,i]=u.useState(null),[h,w]=u.useState(null),[a,k]=u.useState(new Set),[x,f]=u.useState(null),[S,L]=u.useState("tree"),C=t=>{var s,d;if(!t)return null;try{const r=(s=o.resources.imageMap)==null?void 0:s.get(t);if(r)return typeof r.data=="string"&&r.data.startsWith("data:")?r.data:`data:${r.type};base64,${r.data}`;const y=(d=o.units.imageMap)==null?void 0:d.get(t);return y?typeof y.data=="string"&&y.data.startsWith("data:")?y.data:`data:${y.type};base64,${y.data}`:(console.log(`Изображение с ID ${t} не найдено ни в одном хранилище`),null)}catch(r){return console.error("Ошибка при получении URL изображения:",r),null}};u.useEffect(()=>{console.log("CraftingTree: Загружены рецепты",o.craftSystem.recipes);const t=o.craftSystem.recipes.filter(s=>!Ve(s));t.length>0?(console.error("Найдены некорректные рецепты:",t),f("Некоторые рецепты имеют неправильную структуру. Проверьте консоль для подробностей.")):f(null)},[o.craftSystem.recipes]);const M=t=>{if(!t)return{tier:1,complexity:"Средне",imageId:null};try{const s=o.balance.comparisonItems.find(y=>y.name===t);if(s)return{tier:s.tier||1,complexity:s.craftComplexity||"Средне",imageId:s.imageId||null};const d=o.resources.items.find(y=>y.name===t);if(d)return{tier:d.value||1,complexity:"Средне",imageId:d.imageId||null};const r=o.craftSystem.recipes.find(y=>y.resultItemName===t);return r?{tier:r.level||1,complexity:"Средне",imageId:r.imageId||null}:{tier:1,complexity:"Средне",imageId:null}}catch(s){return console.error(`Ошибка получения информации для ${t}:`,s),{tier:1,complexity:"Средне",imageId:null}}},N=t=>{if(!t)return!1;try{return o.craftSystem.recipes.some(s=>s.resultItemName===t)}catch(s){return console.error(`Ошибка проверки рецепта для ${t}:`,s),!1}},I=(t,s,d=0,r="")=>{try{if(!t)return console.error("Попытка построить дерево для пустого имени предмета"),null;const y=`${r}_${t.replace(/\s+/g,"_")}_${d}`,{imageId:p}=M(t),v={id:y,itemName:t,amount:s,children:[],level:d,imageId:p};if(d>=5)return v;const T=o.craftSystem.recipes.find(b=>b.resultItemName===t);if(T&&T.variants&&T.variants.length>0){const b=T.variants[0];b&&b.ingredients&&Array.isArray(b.ingredients)&&b.ingredients.forEach((D,J)=>{if(!D||!D.itemName)return;const B=Math.ceil(D.amount*s/(T.resultAmount||1)),G=`${y}_${J}`;if(N(D.itemName)){const K=I(D.itemName,B,d+1,G);K&&v.children.push(K)}else{const{imageId:K}=M(D.itemName);v.children.push({id:`${G}_leaf`,itemName:D.itemName,amount:B,children:[],level:d+1,imageId:K})}})}return v}catch(y){const p=y instanceof Error?y.message:String(y);return f(`Ошибка при построении дерева: ${p}`),null}};u.useEffect(()=>{if(R)try{const t=o.craftSystem.recipes.find(s=>s.id===R);if(t&&t.resultItemName){const s=I(t.resultItemName,t.resultAmount||1);if(w(s),s){const d=new Set;d.add(s.id),k(d)}}else w(null),f("Выбран некорректный рецепт. Не найдено имя результата.")}catch(t){const s=t instanceof Error?t.message:String(t);f(`Ошибка при создании дерева: ${s}`),w(null)}else w(null),f(null)},[R,o.craftSystem.recipes]);const A=t=>{k(s=>{const d=new Set(s);return d.has(t)?d.delete(t):d.add(t),d})},P=t=>{try{const{complexity:s}=M(t.itemName),d=o.craftSystem.recipes.find(r=>r.resultItemName===t.itemName);return d?Qe(s,d.level||1,o.balance.currentConfig)*Math.ceil(t.amount/(d.resultAmount||1)):0}catch(s){return console.error("Ошибка при расчете времени крафта:",s),0}},U=u.useMemo(()=>{if(!h)return{};const t={},s=d=>{if(!d)return;if(!N(d.itemName)){if(!t[d.itemName]){const{tier:y}=M(d.itemName);t[d.itemName]={amount:0,tier:y,isLeaf:!0}}t[d.itemName].amount+=d.amount}else{if(!t[d.itemName]){const{tier:y}=M(d.itemName);t[d.itemName]={amount:0,tier:y,isLeaf:!1}}t[d.itemName].amount+=d.amount}for(const y of d.children)s(y)};return s(h),t},[h]),j=u.useMemo(()=>{if(!h)return{nodes:[],links:[]};const t=[],s=[];function d(r,y=null,p=0){const v=r.id,T=!N(r.itemName),{tier:b,imageId:D}=M(r.itemName),J=r.imageId||D,B=C(J);if(J&&!B?console.warn(`Не удалось получить URL для изображения с ID ${J} для ${r.itemName}`):B&&console.log(`Загружен URL изображения для ${r.itemName}`),t.push({id:v,name:r.itemName,amount:r.amount,tier:b,category:T?0:1,level:p,imageUrl:B,imageId:J}),y!==null&&s.push({source:v,target:y,amount:r.amount,sourceLevel:p,targetLevel:p-1}),r.children&&r.children.length>0)for(const G of r.children)d(G,v,p+1)}return d(h),{nodes:t,links:s}},[h]),O=u.useMemo(()=>{const{nodes:t,links:s}=j;if(t.length===0)return{series:[]};const d=document.documentElement.classList.contains("dark"),r=d?"#192231":"#f8fafc",y=d?"#e5e7eb":"#374151",p=Math.max(...t.map(b=>b.level||0),0),v=180,T=t.map(b=>{const D=50+(p-(b.level||0))*v,J=t.filter(Y=>Y.level===b.level),B=J.findIndex(Y=>Y.id===b.id),G=J.length,K=90+G*30,ie=G>1?100+B/(G-1)*K:350,E=b.category===0;let V=b.name;if(b.name==="Доска из сухой древесины")V=`Доска из
сухой древесины`;else if(b.name.includes(" ")&&b.name.length>15){const Y=b.name.indexOf(" ");V=b.name.substring(0,Y)+`
`+b.name.substring(Y+1)}const c=E?70:60,F=Math.min(150,110+b.name.length*2),g=60,W=E?c:[F,g];return{...b,x:D,y:ie,symbol:E?"circle":"roundRect",symbolSize:W,itemStyle:{color:E?"#3B82F6":"#10B981",borderColor:d?"rgba(255, 255, 255, 0.7)":"rgba(0, 0, 0, 0.7)",borderWidth:2,shadowBlur:3,shadowColor:"rgba(0, 0, 0, 0.3)"},label:{show:!0,position:"inside",formatter:`${V}
x${b.amount}`,fontSize:10,fontWeight:"bold",color:"#FFFFFF",padding:[3,3],borderRadius:3,width:E?typeof W=="number"?W*.8:0:F-10,height:E?typeof W=="number"?W*.8:0:g-8,overflow:"break",lineHeight:16}}});return{backgroundColor:r,tooltip:{trigger:"item",formatter:function(b){if(!b)return"";if(b.dataType==="node"){const D=b.data.imageUrl?'<div style="color:lime">Изображение: Есть</div>':`<div style="color:red">Изображение: Нет${b.data.imageId?" (ID: "+b.data.imageId+")":""}</div>`,J=b.data.imageUrl?`<div style="text-align:center; margin-top:5px; margin-bottom:5px">
                <img src="${b.data.imageUrl}" style="max-width:120px; max-height:80px; border:2px solid white;" />
              </div>`:"";return`<div style="padding: 10px; max-width:250px;">
            <div style="font-weight: bold; margin-bottom: 5px; font-size:14px;">${b.data.name}</div>
            ${J}
            <div>Количество: x${b.data.amount}</div>
            <div>Тир: ${b.data.tier||"?"}</div>
            <div>Тип: ${b.data.category===0?"Ресурс":"Крафтовый предмет"}</div>
            ${D}
          </div>`}return b.dataType==="edge"?`<div style="padding: 8px;">
            <div>Требуется: x${b.data.amount||1}</div>
          </div>`:""},backgroundColor:d?"rgba(30, 41, 59, 0.95)":"rgba(255, 255, 255, 0.95)",borderColor:d?"#555":"#ddd",textStyle:{color:d?"#fff":"#333"}},graphic:{elements:[]},animationDurationUpdate:1500,animationEasingUpdate:"quinticInOut",zoom:.95,series:[{type:"graph",layout:"none",data:T,links:s.map(b=>({source:b.source,target:b.target,lineStyle:{color:"#64748b",width:2,curveness:.2,type:"solid",opacity:.8},label:{show:!0,formatter:`x${b.amount||1}`,fontSize:10,backgroundColor:d?"rgba(30, 41, 59, 0.8)":"rgba(255, 255, 255, 0.8)",padding:[2,4],borderRadius:3,color:y,fontWeight:"bold"},symbol:["none","arrow"],symbolSize:[0,8]})),categories:[{name:"Resource"},{name:"Craftable Item"}],roam:!0,draggable:!0,focusNodeAdjacency:!0,emphasis:{scale:!0,focus:"adjacency"},force:{repulsion:150,edgeLength:90}}]}},[j]),Z=t=>{if(!t)return null;try{const s=a.has(t.id),d=t.children&&t.children.length>0,{tier:r,imageId:y}=M(t.itemName),p=o.craftSystem.recipes.find(D=>D.resultItemName===t.itemName),v=t.imageId||y,T=C(v),b=p?P(t):0;return e.jsxs("div",{className:"ml-6",children:[e.jsxs("div",{className:"flex items-center py-2",children:[d&&e.jsx("button",{onClick:()=>A(t.id),className:"mr-2 h-5 w-5 flex items-center justify-center rounded hover:bg-gray-200 dark:hover:bg-gray-700",children:s?"−":"+"}),!d&&e.jsx("div",{className:"mr-2 w-5"}),T?e.jsx("div",{className:"w-6 h-6 mr-2 flex-shrink-0 rounded-full overflow-hidden bg-gray-200 dark:bg-gray-700",children:e.jsx("img",{src:T,alt:t.itemName,className:"w-full h-full object-cover"})}):v&&e.jsx("div",{className:"w-6 h-6 mr-2 flex-shrink-0 rounded-full bg-gray-200 dark:bg-gray-700 flex items-center justify-center",children:e.jsx("span",{className:"text-xs text-gray-500",children:"ID"})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:"font-medium",children:t.itemName}),e.jsxs("span",{className:"ml-2 text-gray-500 dark:text-gray-400",children:["(T",r,") × ",t.amount]}),b>0&&e.jsx("span",{className:"ml-3 text-sm text-blue-500 dark:text-blue-400",children:we(b)})]}),p&&e.jsxs("div",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:["Recipe: ",p.name]})]})]}),s&&d&&e.jsx("div",{className:"border-l-2 border-gray-300 dark:border-gray-700 pl-2",children:t.children.map(D=>Z(D))})]},t.id)}catch(s){return console.error("Ошибка рендеринга узла дерева:",s),e.jsxs("div",{className:"ml-6 py-2 text-red-500",children:["Error rendering node: ",s instanceof Error?s.message:String(s)]})}};return x?e.jsxs("div",{className:"bg-red-100 dark:bg-red-900/30 rounded-lg shadow-sm p-4 border border-red-300 dark:border-red-700",children:[e.jsx("h2",{className:"text-lg font-semibold text-red-800 dark:text-red-400 mb-2",children:"Ошибка дерева крафта"}),e.jsx("p",{className:"text-red-700 dark:text-red-300",children:x})]}):e.jsxs("div",{className:"bg-gray-100 dark:bg-gray-800 rounded-lg shadow-sm p-4 border border-gray-300 dark:border-gray-700",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h2",{className:"text-lg font-semibold",children:"Crafting Tree"}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{onClick:()=>L("tree"),className:`px-3 py-1 rounded ${S==="tree"?"bg-blue-500 text-white":"bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300"}`,children:"Tree View"}),e.jsx("button",{onClick:()=>L("graph"),className:`px-3 py-1 rounded ${S==="graph"?"bg-blue-500 text-white":"bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300"}`,children:"Graph View"})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Select Recipe"}),e.jsxs("select",{value:R||"",onChange:t=>i(t.target.value||null),className:"w-full px-3 py-2 border border-gray-600 dark:border-gray-700 rounded-md bg-gray-100 dark:bg-gray-800 text-gray-900 dark:text-gray-100",children:[e.jsx("option",{value:"",children:"Select a recipe"}),o.craftSystem.recipes.filter(t=>Ve(t)).map(t=>e.jsxs("option",{value:t.id,children:[t.name," (",t.resultItemName,")"]},t.id))]})]}),R&&h?e.jsxs("div",{className:"border border-gray-500 dark:border-gray-600 rounded-md p-4 bg-gray-50 dark:bg-gray-900/30",children:[e.jsxs("div",{className:"font-semibold mb-2",children:["Recipe Tree: ",(n=o.craftSystem.recipes.find(t=>t.id===R))==null?void 0:n.name]}),S==="tree"?e.jsx("div",{className:"overflow-x-auto",children:Z(h)}):e.jsxs("div",{className:"relative overflow-hidden border border-gray-600 dark:border-gray-700 rounded-lg",style:{height:"650px",minHeight:"650px",width:"100%"},children:[e.jsx(qt,{options:O,style:{height:"100%",width:"100%",minHeight:"650px"}}),e.jsxs("div",{className:"absolute top-4 right-4 p-3 text-xs rounded text-gray-600 dark:text-gray-400 bg-white dark:bg-gray-800 bg-opacity-90 dark:bg-opacity-90 border border-gray-300 dark:border-gray-600",children:[e.jsx("div",{className:"font-semibold mb-2",children:"Legend:"}),e.jsxs("div",{className:"flex items-center mb-1",children:[e.jsx("div",{className:"w-3 h-3 rounded-full bg-blue-500 mr-2"}),e.jsx("span",{children:"Resource"})]}),e.jsxs("div",{className:"flex items-center mb-1",children:[e.jsx("div",{className:"w-4 h-3 rounded bg-green-500 mr-2"}),e.jsx("span",{children:"Craftable Item"})]}),e.jsxs("div",{className:"flex items-center mb-1",children:[e.jsx("hr",{className:"w-5 border-blue-500 border-2 mr-2"}),e.jsx("span",{children:"Resource Path"})]}),e.jsxs("div",{className:"flex items-center mb-1",children:[e.jsx("hr",{className:"w-5 border-green-500 border-2 mr-2"}),e.jsx("span",{children:"Crafting Path"})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("hr",{className:"w-5 border-purple-500 border-dashed border-2 mr-2"}),e.jsx("span",{children:"Final Product Link"})]})]}),e.jsxs("div",{className:"absolute top-4 left-4 p-3 text-xs rounded text-gray-600 dark:text-gray-400 bg-white dark:bg-gray-800 bg-opacity-90 dark:bg-opacity-90 border border-gray-300 dark:border-gray-600",children:[e.jsx("div",{className:"font-semibold mb-1",children:"Image Debug:"}),e.jsx("div",{children:"• Hover на узел для просмотра информации об изображении"}),e.jsx("div",{children:"• Красный текст означает отсутствие изображения"}),e.jsx("div",{children:"• ID отображается, если есть идентификатор без изображения"})]}),e.jsxs("div",{className:"absolute bottom-4 left-4 p-3 text-xs rounded text-gray-600 dark:text-gray-400 bg-white dark:bg-gray-800 bg-opacity-90 dark:bg-opacity-90 border border-gray-300 dark:border-gray-600",children:[e.jsx("div",{className:"font-semibold mb-1",children:"Tip:"}),e.jsx("div",{children:"• Колесо мыши: масштабирование"}),e.jsx("div",{children:"• Перетаскивание: перемещение узлов и графа"}),e.jsx("div",{children:"• Клик на узел: подсветка связанных элементов"}),e.jsx("div",{children:"• Двойной клик: центрирование на узле"})]})]}),e.jsxs("div",{className:"mt-4 p-3 bg-blue-50 dark:bg-blue-900/20 rounded-md text-sm border border-blue-200 dark:border-blue-800",children:[e.jsx("div",{className:"font-medium text-blue-800 dark:text-blue-300 mb-2",children:"Resource Requirements Summary:"}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-2",children:Object.entries(U).filter(([t,s])=>s.isLeaf).sort(([t],[s])=>t.localeCompare(s)).map(([t,s])=>{const{imageId:d}=M(t),r=C(d);return e.jsxs("div",{className:"flex justify-between items-center p-2 bg-white dark:bg-gray-800 rounded",children:[e.jsxs("div",{className:"flex items-center",children:[r?e.jsx("div",{className:"w-6 h-6 mr-2 rounded-full overflow-hidden bg-gray-200 dark:bg-gray-700 flex-shrink-0",children:e.jsx("img",{src:r,alt:t,className:"w-full h-full object-cover"})}):d&&e.jsx("div",{className:"w-6 h-6 mr-2 rounded-full bg-gray-200 dark:bg-gray-700 flex items-center justify-center flex-shrink-0",children:e.jsx("span",{className:"text-xs text-gray-500",children:"ID"})}),e.jsx("span",{className:"font-medium",children:t}),e.jsxs("span",{className:"ml-2 text-xs text-gray-500 dark:text-gray-400",children:["(T",s.tier,")"]})]}),e.jsxs("div",{className:"font-bold text-blue-500 dark:text-blue-400",children:["x",s.amount]})]},t)})}),Object.entries(U).filter(([t,s])=>s.isLeaf).length===0&&e.jsx("div",{className:"text-gray-500 dark:text-gray-400",children:"No base resources found in this recipe."})]})]}):e.jsx("div",{className:"text-center py-10 text-gray-500 dark:text-gray-400 border border-dashed border-gray-500 dark:border-gray-600 rounded-md bg-gray-50 dark:bg-gray-900/30",children:"Please select a recipe to view its crafting tree."})]})}const Gt=({onCreateItem:o,onEditItem:R,onDeleteItem:i,onDuplicateItem:h})=>{const w=je(),{state:a,updateState:k}=xe(),{comparisonItems:x,calculateItemCost:f}=w,[S,L]=u.useState(""),[C,M]=u.useState("all"),[N,I]=u.useState("all"),[A,P]=u.useState("all"),[U,j]=u.useState("all"),[O,Z]=u.useState("all"),[n,t]=u.useState("name"),[s,d]=u.useState("asc"),[r,y]=u.useState("none"),{categories:p,mechanics:v,subTypes:T,seasons:b}=u.useMemo(()=>{const g=new Set,W=new Set,z=new Set,Y=new Set;return x.forEach($=>{$.selectedCategories.forEach(X=>g.add(X)),W.add($.mechanic),$.subType&&z.add($.subType),$.isHarvest&&$.growingSeason&&$.growingSeason.forEach(X=>Y.add(X))}),{categories:Array.from(g).sort(),mechanics:Array.from(W).sort(),subTypes:Array.from(z).sort(),seasons:Array.from(Y).sort()}},[x]),D=u.useMemo(()=>x.filter(g=>!(S&&!g.name.toLowerCase().includes(S.toLowerCase())||C!=="all"&&!g.selectedCategories.includes(C)||N!=="all"&&g.mechanic!==N||A!=="all"&&(A==="harvest"&&!g.isHarvest||A==="regular"&&g.isHarvest)||U!=="all"&&g.subType!==U||O!=="all"&&(!g.isHarvest||!g.growingSeason||!g.growingSeason.includes(O)))).sort((g,W)=>{switch(n){case"name":return s==="asc"?g.name.localeCompare(W.name):W.name.localeCompare(g.name);case"tier":return s==="asc"?g.tier-W.tier:W.tier-g.tier;case"cost":const z=f(g),Y=f(W);return s==="asc"?z-Y:Y-z;case"profitability":const $=J(g),X=J(W);return s==="asc"?$-X:X-$;default:return 0}}),[x,S,C,N,A,U,O,n,s,f]),J=g=>{if(!g.isHarvest)return 0;const W=f(g),z=g.seedCost||0,Y=g.growingTime||1;return(W-z)/Y},B=u.useMemo(()=>{if(r==="none")return{"Все предметы":D};const g={};return D.forEach(W=>{let z="";switch(r){case"type":z=W.isHarvest?"Урожай":"Обычные предметы";break;case"tier":z=`Tier ${W.tier}`;break;case"category":if(W.selectedCategories.length>0){W.selectedCategories.forEach(Y=>{g[Y]||(g[Y]=[]),g[Y].push(W)});return}else z="Без категории";break;case"mechanic":z=W.mechanic;break;case"subType":z=W.subType?W.subType:"Без подтипа";break;case"season":if(W.isHarvest&&W.growingSeason&&W.growingSeason.length>0){W.growingSeason.forEach(Y=>{g[Y]||(g[Y]=[]),g[Y].push(W)});return}else z="Не сезонные";break;default:z="Другие"}g[z]||(g[z]=[]),g[z].push(W)}),g},[D,r]),G=()=>{o?o():(console.log("Create new item"),window.switchTabDirectly&&window.switchTabDirectly("items","editor"))},K=g=>{R?R(g):(console.log("Edit item:",g.name),window.switchTabDirectly&&window.switchTabDirectly("items","editor",g))},ie=g=>{if(window.confirm(`Вы уверены, что хотите удалить "${g.name}"?`))if(i)i(g);else{const W=x.filter(z=>z.name!==g.name);k("balance",{...a.balance,comparisonItems:W})}},E=g=>{if(h)h(g);else{const W={...g,name:""};if(window.switchTabDirectly)window.switchTabDirectly("items","editor",W);else{const z=[...x,W];k("balance",{...a.balance,comparisonItems:z}),console.log("Item duplicated:",W)}}},V=g=>g?Ee(g,a):null,c=g=>!g||g.length===0?"Не указано":g.join(", "),F=g=>{if(!g.isHarvest)return null;const W=J(g);let z="bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-300";return W>10?z="bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-300":W<0?z="bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-300":W>0&&(z="bg-yellow-100 text-yellow-800 dark:bg-yellow-900/30 dark:text-yellow-300"),e.jsxs("div",{className:`mt-1 px-2 py-1 rounded-md text-xs inline-flex items-center ${z}`,children:[e.jsx("span",{className:"font-medium mr-1",children:"Доходность:"})," ",W.toFixed(1)," в день"]})};return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h2",{className:"text-xl font-semibold",children:"Список предметов"}),e.jsx("button",{onClick:G,className:"px-4 py-2 bg-primary text-white rounded-md hover:bg-opacity-90 transition",children:"Создать новый предмет"})]}),e.jsxs("div",{className:"p-4 bg-white dark:bg-gray-700 rounded-lg shadow-sm",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Поиск"}),e.jsx("input",{type:"text",value:S,onChange:g=>L(g.target.value),placeholder:"Поиск предметов...",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-800"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Категория"}),e.jsxs("select",{value:C,onChange:g=>M(g.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-800",children:[e.jsx("option",{value:"all",children:"Все категории"}),p.map(g=>e.jsx("option",{value:g,children:g},g))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Механика"}),e.jsxs("select",{value:N,onChange:g=>I(g.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-800",children:[e.jsx("option",{value:"all",children:"Все механики"}),v.map(g=>e.jsx("option",{value:g,children:g},g))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Тип предмета"}),e.jsxs("select",{value:A,onChange:g=>P(g.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-800",children:[e.jsx("option",{value:"all",children:"Все типы"}),e.jsx("option",{value:"regular",children:"Обычные предметы"}),e.jsx("option",{value:"harvest",children:"Урожай"})]})]}),T.length>0&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Подтип"}),e.jsxs("select",{value:U,onChange:g=>j(g.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-800",children:[e.jsx("option",{value:"all",children:"Все подтипы"}),T.map(g=>e.jsx("option",{value:g,children:g},g))]})]}),b.length>0&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Сезон"}),e.jsxs("select",{value:O,onChange:g=>Z(g.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-800",children:[e.jsx("option",{value:"all",children:"Все сезоны"}),b.map(g=>e.jsx("option",{value:g,children:g},g))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Группировать по"}),e.jsxs("select",{value:r,onChange:g=>y(g.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-800",children:[e.jsx("option",{value:"none",children:"Без группировки"}),e.jsx("option",{value:"type",children:"Типу (обычный/урожай)"}),e.jsx("option",{value:"tier",children:"Тиру"}),e.jsx("option",{value:"category",children:"Категории"}),e.jsx("option",{value:"mechanic",children:"Механике"}),e.jsx("option",{value:"subType",children:"Подтипу"}),e.jsx("option",{value:"season",children:"Сезону"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Сортировка"}),e.jsxs("div",{className:"flex",children:[e.jsxs("select",{value:n,onChange:g=>t(g.target.value),className:"flex-1 px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-800",children:[e.jsx("option",{value:"name",children:"Имя"}),e.jsx("option",{value:"tier",children:"Тир"}),e.jsx("option",{value:"cost",children:"Стоимость"}),e.jsx("option",{value:"profitability",children:"Доходность"})]}),e.jsx("button",{onClick:()=>d(g=>g==="asc"?"desc":"asc"),className:"ml-2 px-3 py-2 bg-gray-200 dark:bg-gray-600 rounded-md",children:s==="asc"?"↑":"↓"})]})]})]}),e.jsxs("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:["Найдено предметов: ",D.length," из ",x.length]})]}),Object.entries(B).map(([g,W])=>e.jsxs("div",{className:"mb-6",children:[r!=="none"&&e.jsxs("h3",{className:"text-lg font-medium mb-3 border-b pb-2 dark:border-gray-700",children:[g," (",W.length,")"]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:W.map(z=>{const Y=z.imageId!==void 0?V(z.imageId):null,$=f(z);return e.jsxs("div",{className:"bg-white dark:bg-gray-700 rounded-lg shadow-sm overflow-hidden",children:[e.jsxs("div",{className:"p-4 flex items-start gap-4",children:[e.jsx("div",{className:"w-16 h-16 bg-gray-200 dark:bg-gray-600 rounded-lg overflow-hidden flex-shrink-0",children:Y?e.jsx("img",{src:Y,alt:z.name,className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full flex items-center justify-center text-gray-400",children:"No Image"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h3",{className:"font-medium text-lg truncate",children:z.name}),z.isHarvest&&e.jsx("span",{className:"px-2 py-0.5 text-xs bg-green-100 dark:bg-green-900/30 text-green-800 dark:text-green-300 rounded",children:"Урожай"})]}),e.jsxs("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:["Tier ",z.tier,z.subType&&e.jsxs("span",{children:[" • ",z.subType]}),e.jsxs("span",{children:[" • ",z.mechanic]})]}),z.isHarvest&&e.jsxs("div",{className:"mt-1 text-xs text-gray-600 dark:text-gray-400",children:[e.jsxs("div",{children:["Сезоны: ",c(z.growingSeason)]}),e.jsxs("div",{children:["Время роста: ",z.growingTime||0," дней"]}),e.jsxs("div",{children:["Количество за сезон: ",z.harvestPerSeason||1]}),F(z)]}),e.jsx("div",{className:"mt-2 flex flex-wrap gap-1",children:z.selectedCategories.map(X=>e.jsx("span",{className:"px-2 py-1 text-xs bg-blue-100 dark:bg-blue-900/30 text-blue-800 dark:text-blue-200 rounded-full",children:X},X))})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"font-bold text-lg",children:$}),e.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:"стоимость"})]})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800 p-2 flex justify-between",children:[e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{onClick:()=>K(z),className:"px-3 py-1 text-sm bg-blue-500 text-white rounded-md hover:bg-blue-600",children:"Редактировать"}),e.jsx("button",{onClick:()=>E(z),className:"px-3 py-1 text-sm bg-green-500 text-white rounded-md hover:bg-green-600",title:"Дублировать с пустым названием",children:"Дублировать"})]}),e.jsx("button",{onClick:()=>ie(z),className:"px-3 py-1 text-sm bg-red-500 text-white rounded-md hover:bg-red-600",children:"Удалить"})]})]},z.name)})}),W.length===0&&e.jsx("div",{className:"p-8 text-center bg-white dark:bg-gray-700 rounded-lg",children:e.jsxs("p",{className:"text-gray-500 dark:text-gray-400",children:['В группе "',g,'" нет предметов']})})]},g)),D.length===0&&e.jsx("div",{className:"p-8 text-center bg-white dark:bg-gray-700 rounded-lg",children:e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Предметы не найдены"})})]})};function Ht({item:o}){const R=je(),{currentConfig:i}=R,h=document.documentElement.classList.contains("dark"),w=o.selectedCategories.reduce((y,p)=>y+(i.categories[p]||0),0),a=o.selectedCategories.length>0?w/o.selectedCategories.length:0,k=1+(o.tier-1)*i.tierMultiplier,x=i.mechanics[o.mechanic]||1,f=o.selectedModifiers.reduce((y,p)=>y+(i.modifiers[p]||0),0),S=o.selectedLocations.reduce((y,p)=>y+(i.locations[p]||0),0),L=o.selectedLocations.length>0?S/o.selectedLocations.length:1,C=o.selectedModifiers.length>0?f/o.selectedModifiers.length:1,M=i.frequencyTypes[o.frequencyType]||1,N=i.craftComplexityTypes[o.craftComplexity]||1,I=o.subType&&i.subTypeModifiers&&i.subTypeModifiers[o.subType]?i.subTypeModifiers[o.subType]:1,A=i.weights.categoryWeight*a,P=i.weights.tierWeight*k,U=i.weights.mechanicWeight*x,j=i.weights.modifiersWeight*C,O=i.weights.locationsWeight*L,Z=(i.weights.frequencyWeight||0)*M,n=(i.weights.craftComplexityWeight||0)*N,t=A+P+U+j+O+Z+n,s=i.baseValue*t*I,d={category:"#8B5CF6",tier:"#10B981",mechanic:"#3B82F6",modifiers:"#FBBF24",locations:"#EF4444",frequency:"#EC4899",craftComplexity:"#F97316",subType:"#06B6D4"},r=u.useMemo(()=>{const y=[{name:"Категория",value:A,color:d.category},{name:"Тир",value:P,color:d.tier},{name:"Механика",value:U,color:d.mechanic},{name:"Модификаторы",value:j,color:d.modifiers},{name:"Локации",value:O,color:d.locations},{name:"Частота",value:Z,color:d.frequency},{name:"Сложность крафта",value:n,color:d.craftComplexity}];I!==1&&y.push({name:"Подтип",value:t*(I-1),color:d.subType});const p=y.filter(v=>v.value>0).sort((v,T)=>T.value-v.value);return{backgroundColor:"transparent",title:{text:"Влияние компонентов (сортировка)",left:"center",top:0,textStyle:{fontSize:14,color:h?"#ccc":"#333"}},tooltip:{trigger:"axis",axisPointer:{type:"shadow"},formatter:function(v){const T=Array.isArray(v)?v[0]:v,b=typeof T.value=="number"?T.value:0,D=(b/t*100).toFixed(1);return`${T.name}: ${b.toFixed(2)} (${D}%)`},backgroundColor:h?"rgba(30, 30, 30, 0.9)":"rgba(255, 255, 255, 0.9)",borderColor:h?"#555":"#ddd",textStyle:{color:h?"#fff":"#333"}},grid:{left:"3%",right:"28%",bottom:"3%",top:"40px",containLabel:!0},xAxis:{type:"value",axisLabel:{show:!1},axisLine:{show:!1},axisTick:{show:!1},splitLine:{show:!1}},yAxis:{type:"category",data:p.map(v=>v.name),axisLabel:{color:h?"#ccc":"#333",fontSize:12,padding:[0,15,0,0],fontWeight:"bold"},axisLine:{lineStyle:{color:h?"rgba(255, 255, 255, 0.2)":"rgba(0, 0, 0, 0.2)"}},axisTick:{show:!1}},series:[{type:"bar",barWidth:"50%",data:p.map(v=>({value:v.value,itemStyle:{color:v.color}})),label:{show:!0,position:"right",distance:10,formatter:function(v){const T=typeof v.value=="number"?v.value:0,b=(T/t*100).toFixed(1);return`${T.toFixed(2)} (${b}%)`},color:h?"#ccc":"#333",fontSize:12,fontWeight:"bold"}}]}},[A,P,U,j,O,Z,n,I,t,h]);return e.jsxs("div",{className:"mb-4",children:[e.jsx("h3",{className:"text-sm font-medium mb-2",children:"Формула:"}),e.jsxs("div",{className:"p-3 bg-white dark:bg-gray-800 rounded-md border border-gray-200 dark:border-gray-600",children:[e.jsx("div",{className:"h-56 mb-4",children:e.jsx(Ne,{options:r,style:{height:"100%"}})}),e.jsxs("div",{className:"text-xs font-mono",children:[e.jsx("h4",{className:"text-xs font-medium mb-1 text-gray-500 dark:text-gray-400",children:"Детальный расчет:"}),e.jsxs("div",{className:"flex flex-wrap items-center gap-1",children:[e.jsx("span",{className:"text-gray-500 dark:text-gray-400",children:"Базовая"}),e.jsx("span",{children:"×"}),e.jsx("span",{className:"text-gray-500 dark:text-gray-400",children:"("}),e.jsx("span",{style:{color:d.category},children:i.weights.categoryWeight.toFixed(2)}),e.jsx("span",{className:"text-gray-500 dark:text-gray-400",children:"×"}),e.jsx("span",{style:{color:d.category},children:a.toFixed(2)}),e.jsx("span",{children:"+"}),e.jsx("span",{style:{color:d.tier},children:i.weights.tierWeight.toFixed(2)}),e.jsx("span",{className:"text-gray-500 dark:text-gray-400",children:"×"}),e.jsx("span",{style:{color:d.tier},children:k.toFixed(2)}),e.jsx("span",{children:"+"}),e.jsx("span",{style:{color:d.mechanic},children:i.weights.mechanicWeight.toFixed(2)}),e.jsx("span",{className:"text-gray-500 dark:text-gray-400",children:"×"}),e.jsx("span",{style:{color:d.mechanic},children:x.toFixed(2)}),e.jsx("span",{children:"+"}),e.jsx("span",{style:{color:d.modifiers},children:i.weights.modifiersWeight.toFixed(2)}),e.jsx("span",{className:"text-gray-500 dark:text-gray-400",children:"×"}),e.jsx("span",{style:{color:d.modifiers},children:C.toFixed(2)}),e.jsx("span",{children:"+"}),e.jsx("span",{style:{color:d.locations},children:i.weights.locationsWeight.toFixed(2)}),e.jsx("span",{className:"text-gray-500 dark:text-gray-400",children:"×"}),e.jsx("span",{style:{color:d.locations},children:L.toFixed(2)}),e.jsx("span",{children:"+"}),e.jsx("span",{style:{color:d.frequency},children:(i.weights.frequencyWeight||0).toFixed(2)}),e.jsx("span",{className:"text-gray-500 dark:text-gray-400",children:"×"}),e.jsx("span",{style:{color:d.frequency},children:M.toFixed(2)}),e.jsx("span",{children:"+"}),e.jsx("span",{style:{color:d.craftComplexity},children:(i.weights.craftComplexityWeight||0).toFixed(2)}),e.jsx("span",{className:"text-gray-500 dark:text-gray-400",children:"×"}),e.jsx("span",{style:{color:d.craftComplexity},children:N.toFixed(2)}),e.jsx("span",{className:"text-gray-500 dark:text-gray-400",children:")"})]}),e.jsxs("div",{className:"mt-2 flex flex-wrap items-center gap-1",children:[e.jsx("span",{children:i.baseValue}),e.jsx("span",{children:"×"}),e.jsx("span",{className:"text-gray-500 dark:text-gray-400",children:"("}),e.jsx("span",{style:{color:d.category},children:A.toFixed(2)}),e.jsx("span",{children:"+"}),e.jsx("span",{style:{color:d.tier},children:P.toFixed(2)}),e.jsx("span",{children:"+"}),e.jsx("span",{style:{color:d.mechanic},children:U.toFixed(2)}),e.jsx("span",{children:"+"}),e.jsx("span",{style:{color:d.modifiers},children:j.toFixed(2)}),e.jsx("span",{children:"+"}),e.jsx("span",{style:{color:d.locations},children:O.toFixed(2)}),e.jsx("span",{children:"+"}),e.jsx("span",{style:{color:d.frequency},children:Z.toFixed(2)}),e.jsx("span",{children:"+"}),e.jsx("span",{style:{color:d.craftComplexity},children:n.toFixed(2)}),e.jsx("span",{className:"text-gray-500 dark:text-gray-400",children:")"}),I!==1&&e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"×"}),e.jsx("span",{style:{color:d.subType},title:"Множитель подтипа",children:I.toFixed(2)})]})]}),e.jsxs("div",{className:"mt-2 flex flex-wrap items-center gap-1",children:[e.jsx("span",{children:i.baseValue}),e.jsx("span",{children:"×"}),e.jsx("span",{className:"font-semibold",children:t.toFixed(2)}),I!==1&&e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"×"}),e.jsx("span",{style:{color:d.subType},className:"font-semibold",children:I.toFixed(2)})]}),e.jsx("span",{children:"="}),e.jsx("span",{className:"font-bold text-lg",children:Math.round(s)})]})]})]})]})}const Ze={Весна:28,Лето:28,Осень:28,Зима:28},Ae={name:"",tier:1,mechanic:"Найти в мире",selectedCategories:[],selectedModifiers:[],selectedLocations:[],frequencyType:"Часто встречаемый",craftComplexity:"Не крафтиться",imageId:null,subType:"",isHarvest:!1,growingSeason:[],growingTime:0,harvestPerSeason:1,seedCost:0,isFuel:!1,fuelEfficiency:1},_t=({itemToEdit:o,onBack:R})=>{const{state:i,updateState:h}=xe(),w=je(),{calculateItemCost:a,currentConfig:k}=w,[x,f]=u.useState({...Ae}),[S,L]=u.useState("new"),[C,M]=u.useState([]),[N,I]=u.useState(null),[A,P]=u.useState(""),[U,j]=u.useState(""),[O,Z]=u.useState(""),[n,t]=u.useState("general");u.useEffect(()=>{o&&(f({...o}),L("edit"),I(o.name),o.isHarvest?t("harvest"):o.isFuel&&t("fuel"))},[o]),u.useEffect(()=>{M(i.balance.comparisonItems)},[i.balance.comparisonItems]);const s=u.useMemo(()=>C.filter(l=>l.selectedCategories.includes("Семечко")||l.name.toLowerCase().includes("семена")||l.name.toLowerCase().includes("семя")||l.name.toLowerCase().includes("семечк")),[C]),d=l=>{const q=C.find(H=>H.name===l);q&&(f({...q}),L("edit"),I(l),q.isHarvest?t("harvest"):q.isFuel&&t("fuel"))},{categories:r,mechanics:y,modifiers:p,locations:v,frequencyTypes:T,craftComplexityTypes:b}=u.useMemo(()=>({categories:Object.keys(k.categories),mechanics:Object.keys(k.mechanics),modifiers:Object.keys(k.modifiers),locations:Object.keys(k.locations),frequencyTypes:Object.keys(k.frequencyTypes||{}),craftComplexityTypes:Object.keys(k.craftComplexityTypes||{})}),[k]),D=u.useMemo(()=>k.seasons||["Весна","Лето","Осень","Зима"],[k.seasons]),J=u.useMemo(()=>r.filter(l=>l.toLowerCase().includes(A.toLowerCase())),[r,A]),B=u.useMemo(()=>p.filter(l=>l.toLowerCase().includes(U.toLowerCase())),[p,U]),G=u.useMemo(()=>v.filter(l=>l.toLowerCase().includes(O.toLowerCase())),[v,O]),K=l=>{const q=l.selectedCategories.reduce((De,Le)=>De+(k.categories[Le]||0),0),H=l.selectedCategories.length>0?q/l.selectedCategories.length:0,re=1+(l.tier-1)*k.tierMultiplier,ce=k.mechanics[l.mechanic]||1,pe=l.selectedModifiers.reduce((De,Le)=>De+(k.modifiers[Le]||0),0),se=l.selectedLocations.reduce((De,Le)=>De+(k.locations[Le]||0),0),le=l.selectedLocations.length>0?se/l.selectedLocations.length:1,ye=l.selectedModifiers.length>0?pe/l.selectedModifiers.length:1,ge=k.frequencyTypes[l.frequencyType]||1,oe=k.craftComplexityTypes[l.craftComplexity]||1,ue=l.subType&&k.subTypeModifiers&&k.subTypeModifiers[l.subType]||1,fe=k.weights.categoryWeight*H,be=k.weights.tierWeight*re,Ie=k.weights.mechanicWeight*ce,Se=k.weights.modifiersWeight*ye,_e=k.weights.locationsWeight*le,at=(k.weights.frequencyWeight||0)*ge,st=(k.weights.craftComplexityWeight||0)*oe,Ye={Категория:Math.round(k.baseValue*fe),Тир:Math.round(k.baseValue*be),Механика:Math.round(k.baseValue*Ie),Модификаторы:Math.round(k.baseValue*Se),Локации:Math.round(k.baseValue*_e),Частота:Math.round(k.baseValue*at),"Сложность крафта":Math.round(k.baseValue*st)};return l.subType&&ue!==1&&k.subTypeModifiers&&k.subTypeModifiers[l.subType]&&(Ye.Подтип=Math.round(k.baseValue*(ue-1))),Ye},{cost:ie,components:E}=u.useMemo(()=>{const l=a(x),q=K(x);return{cost:l,components:q}},[x,a,K,k]),V=()=>{if(!x.isHarvest)return null;const l=x.seedCost||0,q=x.growingTime||0,H=x.harvestPerSeason||1,re=k.growthDayMultiplier||1,ce=q*re,pe=l+ce,se=pe/H;return{seedCost:l,growingTime:q,dayMultiplier:re,growingCost:ce,totalCost:pe,harvestPerSeason:H,unitCost:se}},c=u.useMemo(()=>V(),[x.isHarvest,x.seedCost,x.growingTime,x.harvestPerSeason,k.growthDayMultiplier]),F=(l,q)=>{if(!l||l<=0||!q||q.length===0)return 1;const H=Math.min(...q.map(ce=>Ze[ce]||28)),re=Math.floor(H/l);return Math.max(1,re)},g=l=>{f({...x,name:l.target.value})},W=l=>{f({...x,tier:parseInt(l.target.value)})},z=l=>{f({...x,mechanic:l.target.value})},Y=l=>{f(q=>q.selectedCategories.includes(l)?{...q,selectedCategories:q.selectedCategories.filter(re=>re!==l)}:{...q,selectedCategories:[...q.selectedCategories,l]})},$=l=>{f(q=>q.selectedModifiers.includes(l)?{...q,selectedModifiers:q.selectedModifiers.filter(re=>re!==l)}:{...q,selectedModifiers:[...q.selectedModifiers,l]})},X=l=>{f(q=>q.selectedLocations.includes(l)?{...q,selectedLocations:q.selectedLocations.filter(re=>re!==l)}:{...q,selectedLocations:[...q.selectedLocations,l]})},ee=l=>{f(q=>{var ce,pe;const H=((ce=q.growingSeason)==null?void 0:ce.includes(l))||!1;let re;if(H?re=((pe=q.growingSeason)==null?void 0:pe.filter(se=>se!==l))||[]:re=[...q.growingSeason||[],l],q.isHarvest&&re.length>0&&(q.growingTime||0)>0){const se=F(q.growingTime||0,re);return{...q,growingSeason:re,harvestPerSeason:se}}return{...q,growingSeason:re}})},te=()=>{f(l=>{if(l.isHarvest&&(l.growingTime||0)>0){const q=F(l.growingTime||0,D);return{...l,growingSeason:[...D],harvestPerSeason:q}}return{...l,growingSeason:[...D]}})},de=()=>{f(l=>({...l,growingSeason:[]}))},Ce=()=>{f(l=>({...l,selectedCategories:[...J]}))},Te=()=>{f(l=>({...l,selectedCategories:l.selectedCategories.filter(q=>!J.includes(q))}))},ve=()=>{f(l=>({...l,selectedModifiers:[...B]}))},he=()=>{f(l=>({...l,selectedModifiers:l.selectedModifiers.filter(q=>!B.includes(q))}))},ne=()=>{f(l=>({...l,selectedLocations:[...G]}))},ke=()=>{f(l=>({...l,selectedLocations:l.selectedLocations.filter(q=>!G.includes(q))}))},me=l=>{f({...x,frequencyType:l.target.value})},Me=l=>{f({...x,craftComplexity:l.target.value})},Re=l=>{const q=l.target.checked;let H={...x,isHarvest:q};if(q&&(r.includes("Урожай")&&!x.selectedCategories.includes("Урожай")&&(H.selectedCategories=[...H.selectedCategories,"Урожай"]),(!H.growingSeason||H.growingSeason.length===0)&&(H.growingSeason=["Весна"]),(!H.growingTime||H.growingTime<=0)&&(H.growingTime=10),H.growingSeason&&H.growingSeason.length>0&&H.growingTime>0)){const re=F(H.growingTime,H.growingSeason);H.harvestPerSeason=re}f(H)},Be=l=>{const q=l.target.checked;let H={...x,isFuel:q};q&&(r.includes("Топливо")&&!x.selectedCategories.includes("Топливо")&&(H.selectedCategories=[...H.selectedCategories,"Топливо"]),(!H.fuelEfficiency||H.fuelEfficiency<=0)&&(H.fuelEfficiency=1)),f(H)},Oe=l=>{const q=parseFloat(l.target.value);!isNaN(q)&&q>0&&f({...x,fuelEfficiency:q})},Pe=l=>{const q=parseInt(l.target.value);if(!isNaN(q)&&q>=0){const H={...x,growingTime:q};if(H.isHarvest&&H.growingSeason&&H.growingSeason.length>0&&q>0){const re=F(q,H.growingSeason);H.harvestPerSeason=re}f(H)}},We=l=>{const q=parseInt(l.target.value);!isNaN(q)&&q>=1&&f({...x,harvestPerSeason:q})},qe=l=>{const q=l.target.value;if(q.startsWith("seed_")){const H=parseInt(q.replace("seed_",""));isNaN(H)||f({...x,seedCost:H})}else if(q){const H=C.find(re=>re.name===q);if(H){const re=a(H);f({...x,seedCost:re})}}},Ue=l=>{const q=parseInt(l.target.value);!isNaN(q)&&q>=0&&f({...x,seedCost:q})},Ge=l=>{f({...x,imageId:l})},He=()=>{if(!x.name.trim()){alert("Пожалуйста, введите название предмета");return}if(S==="new"&&C.some(q=>q.name===x.name)){alert(`Предмет с названием "${x.name}" уже существует`);return}if(x.isHarvest){if(!x.growingSeason||x.growingSeason.length===0){alert("Пожалуйста, выберите хотя бы один сезон роста");return}if(!x.growingTime||x.growingTime<=0){alert("Время роста должно быть больше 0");return}}if(x.isFuel&&(!x.fuelEfficiency||x.fuelEfficiency<=0)){alert("Эффективность топлива должна быть больше 0");return}let l;S==="edit"&&N?l=C.map(q=>q.name===N?{...x}:q):l=[...C,{...x}],h("balance",{...i.balance,comparisonItems:l}),f({...Ae}),L("new"),I(null),R?R():alert(`Предмет "${x.name}" успешно ${S==="edit"?"обновлен":"создан"}`)},m=()=>{R?R():(f({...Ae}),L("new"),I(null))},_=l=>{if(window.confirm(`Вы уверены, что хотите удалить предмет "${l}"?`)){const q=C.filter(H=>H.name!==l);h("balance",{...i.balance,comparisonItems:q}),S==="edit"&&N===l&&(f({...Ae}),L("new"),I(null))}},Q=l=>{if(l)return Ee(l,i)||void 0},ae=l=>!l||l.length===0?"Не указано":l.join(", ");return e.jsxs("div",{className:"grid grid-cols-1 xl:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"xl:col-span-1 bg-white dark:bg-gray-800 rounded-lg shadow p-4",children:[e.jsx("h2",{className:"text-lg font-semibold mb-4 text-gray-900 dark:text-gray-100",children:"Сохраненные предметы"}),e.jsx("div",{className:"space-y-2 overflow-y-auto max-h-96",children:C.length===0?e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Нет сохраненных предметов"}):C.map(l=>e.jsxs("div",{className:`p-3 rounded-lg flex justify-between items-center ${N===l.name?"bg-blue-100 dark:bg-blue-900/30":"bg-gray-100 dark:bg-gray-700"}`,children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-10 h-10 rounded overflow-hidden bg-gray-200 dark:bg-gray-600",children:l.imageId&&Q(l.imageId)?e.jsx("img",{src:Q(l.imageId),alt:l.name,className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full flex items-center justify-center text-gray-400 text-xs",children:"No img"})}),e.jsxs("div",{children:[e.jsxs("div",{className:"font-medium text-gray-900 dark:text-gray-100",children:[l.name,l.isHarvest&&e.jsx("span",{className:"ml-1 px-1 py-0.5 text-xs bg-green-100 dark:bg-green-900/30 text-green-800 dark:text-green-300 rounded",children:"Урожай"}),l.selectedCategories.includes("Семечко")&&e.jsx("span",{className:"ml-1 px-1 py-0.5 text-xs bg-yellow-100 dark:bg-yellow-900/30 text-yellow-800 dark:text-yellow-300 rounded",children:"Семя"}),l.isFuel&&e.jsx("span",{className:"ml-1 px-1 py-0.5 text-xs bg-orange-100 dark:bg-orange-900/30 text-orange-800 dark:text-orange-300 rounded",children:"Топливо"})]}),e.jsxs("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:["Tier ",l.tier,l.subType&&e.jsxs("span",{children:[" • ",l.subType]}),e.jsxs("span",{children:[" • ",a(l)]}),l.isHarvest&&l.growingSeason&&e.jsxs("span",{children:[" • Сезон: ",ae(l.growingSeason)]}),l.isFuel&&e.jsxs("span",{children:[" • Эфф: ",l.fuelEfficiency||1]})]})]})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{onClick:()=>d(l.name),className:"p-1 text-blue-500",title:"Edit",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})})}),e.jsx("button",{onClick:()=>_(l.name),className:"p-1 text-red-500",title:"Delete",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]})]},l.name))})]}),e.jsxs("div",{className:"xl:col-span-1 bg-white dark:bg-gray-800 rounded-lg shadow p-4 overflow-y-auto max-h-[calc(100vh-2rem)]",children:[e.jsx("h2",{className:"text-lg font-semibold mb-2 text-gray-900 dark:text-gray-100",children:S==="edit"?"Редактирование предмета":"Создание предмета"}),e.jsxs("div",{className:"mb-4 flex border-b border-gray-300 dark:border-gray-600",children:[e.jsx("button",{onClick:()=>t("general"),className:`px-4 py-2 ${n==="general"?"border-b-2 border-primary text-primary":"text-gray-500 dark:text-gray-400"}`,children:"Основное"}),e.jsx("button",{onClick:()=>t("harvest"),className:`px-4 py-2 ${n==="harvest"?"border-b-2 border-primary text-primary":"text-gray-500 dark:text-gray-400"}`,children:"Урожай"}),e.jsx("button",{onClick:()=>t("fuel"),className:`px-4 py-2 ${n==="fuel"?"border-b-2 border-primary text-primary":"text-gray-500 dark:text-gray-400"}`,children:"Топливо"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1 text-gray-700 dark:text-gray-300",children:"Название"}),e.jsx("input",{type:"text",value:x.name,onChange:g,placeholder:"Введите название предмета",className:"w-full px-3 py-2 border border-gray-600 dark:border-gray-700 rounded-md bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100"})]}),n==="general"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1 text-gray-700 dark:text-gray-300",children:"Подтип"}),e.jsxs("select",{value:x.subType||"",onChange:l=>f({...x,subType:l.target.value}),className:"w-full px-3 py-2 border border-gray-600 dark:border-gray-700 rounded-md bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100",children:[e.jsx("option",{value:"",children:"Не определен"}),e.jsxs("optgroup",{label:"Металлы",children:[e.jsx("option",{value:"Медный",children:"Медный"}),e.jsx("option",{value:"Железный",children:"Железный"}),e.jsx("option",{value:"Бронзовый",children:"Бронзовый"}),e.jsx("option",{value:"Стальной",children:"Стальной"}),e.jsx("option",{value:"Титановый",children:"Титановый"}),e.jsx("option",{value:"Золотой",children:"Золотой"}),e.jsx("option",{value:"Серебряный",children:"Серебряный"})]}),e.jsxs("optgroup",{label:"Дерево",children:[e.jsx("option",{value:"Деревянный",children:"Деревянный"}),e.jsx("option",{value:"Дубовый",children:"Дубовый"}),e.jsx("option",{value:"Сосновый",children:"Сосновый"}),e.jsx("option",{value:"Березовый",children:"Березовый"})]}),e.jsxs("optgroup",{label:"Растительные",children:[e.jsx("option",{value:"Кукурузный",children:"Кукурузный"}),e.jsx("option",{value:"Пшеничный",children:"Пшеничный"}),e.jsx("option",{value:"Льняной",children:"Льняной"})]}),e.jsxs("optgroup",{label:"Другие материалы",children:[e.jsx("option",{value:"Каменный",children:"Каменный"}),e.jsx("option",{value:"Стеклянный",children:"Стеклянный"}),e.jsx("option",{value:"Кожаный",children:"Кожаный"}),e.jsx("option",{value:"Тканевый",children:"Тканевый"})]}),e.jsxs("optgroup",{label:"Пищевые",children:[e.jsx("option",{value:"Мясной",children:"Мясной"}),e.jsx("option",{value:"Рыбный",children:"Рыбный"}),e.jsx("option",{value:"Грибной",children:"Грибной"}),e.jsx("option",{value:"Ягодный",children:"Ягодный"}),e.jsx("option",{value:"Овощной",children:"Овощной"}),e.jsx("option",{value:"Фруктовый",children:"Фруктовый"})]})]}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:"Используйте для различения предметов одного тира"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1 text-gray-700 dark:text-gray-300",children:"Изображение"}),e.jsx(Fe,{onUpload:Ge}),x.imageId&&Q(x.imageId)&&e.jsx("div",{className:"mt-2",children:e.jsx("img",{src:Q(x.imageId),alt:x.name,className:"w-32 h-32 object-cover rounded-md"})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1 text-gray-700 dark:text-gray-300",children:"Тир"}),e.jsx("select",{value:x.tier,onChange:W,className:"w-full px-3 py-2 border border-gray-600 dark:border-gray-700 rounded-md bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100",children:[1,2,3,4,5].map(l=>e.jsxs("option",{value:l,children:["Tier ",l]},l))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1 text-gray-700 dark:text-gray-300",children:"Механика получения"}),e.jsx("select",{value:x.mechanic,onChange:z,className:"w-full px-3 py-2 border border-gray-600 dark:border-gray-700 rounded-md bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100",children:y.map(l=>e.jsx("option",{value:l,children:l},l))})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-1",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Категории"}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{type:"button",onClick:Ce,className:"text-xs text-blue-600 dark:text-blue-400 hover:underline",children:"Выбрать все"}),e.jsx("button",{type:"button",onClick:Te,className:"text-xs text-blue-600 dark:text-blue-400 hover:underline",children:"Снять все"})]})]}),e.jsx("div",{className:"mb-2",children:e.jsx("input",{type:"text",value:A,onChange:l=>P(l.target.value),placeholder:"Найти категорию...",className:"w-full px-3 py-1 text-sm border border-gray-600 dark:border-gray-700 rounded-md bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100"})}),e.jsx("div",{className:"p-3 border border-gray-600 dark:border-gray-700 rounded-md bg-white dark:bg-gray-800 max-h-48 overflow-y-auto",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2",children:[J.map(l=>e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",id:`category-${l}`,checked:x.selectedCategories.includes(l),onChange:()=>Y(l),className:"h-4 w-4 text-primary rounded border-gray-300 dark:border-gray-600 focus:ring-primary"}),e.jsxs("label",{htmlFor:`category-${l}`,className:"ml-2 text-sm text-gray-900 dark:text-gray-100",children:[l,e.jsxs("span",{className:"ml-1 text-xs text-gray-500 dark:text-gray-400",children:["(×",k.categories[l],")"]})]})]},l)),J.length===0&&e.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400 col-span-2 py-2 text-center",children:"Ничего не найдено"})]})})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-1",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Модификаторы"}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{type:"button",onClick:ve,className:"text-xs text-blue-600 dark:text-blue-400 hover:underline",children:"Выбрать все"}),e.jsx("button",{type:"button",onClick:he,className:"text-xs text-blue-600 dark:text-blue-400 hover:underline",children:"Снять все"})]})]}),e.jsx("div",{className:"mb-2",children:e.jsx("input",{type:"text",value:U,onChange:l=>j(l.target.value),placeholder:"Найти модификатор...",className:"w-full px-3 py-1 text-sm border border-gray-600 dark:border-gray-700 rounded-md bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100"})}),e.jsx("div",{className:"p-3 border border-gray-600 dark:border-gray-700 rounded-md bg-white dark:bg-gray-800 max-h-48 overflow-y-auto",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2",children:[B.map(l=>e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",id:`modifier-${l}`,checked:x.selectedModifiers.includes(l),onChange:()=>$(l),className:"h-4 w-4 text-primary rounded border-gray-300 dark:border-gray-600 focus:ring-primary"}),e.jsxs("label",{htmlFor:`modifier-${l}`,className:"ml-2 text-sm text-gray-900 dark:text-gray-100",children:[l,e.jsxs("span",{className:"ml-1 text-xs text-gray-500 dark:text-gray-400",children:["(×",k.modifiers[l],")"]})]})]},l)),B.length===0&&e.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400 col-span-2 py-2 text-center",children:"Ничего не найдено"})]})})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-1",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Локации"}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{type:"button",onClick:ne,className:"text-xs text-blue-600 dark:text-blue-400 hover:underline",children:"Выбрать все"}),e.jsx("button",{type:"button",onClick:ke,className:"text-xs text-blue-600 dark:text-blue-400 hover:underline",children:"Снять все"})]})]}),e.jsx("div",{className:"mb-2",children:e.jsx("input",{type:"text",value:O,onChange:l=>Z(l.target.value),placeholder:"Найти локацию...",className:"w-full px-3 py-1 text-sm border border-gray-600 dark:border-gray-700 rounded-md bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100"})}),e.jsx("div",{className:"p-3 border border-gray-600 dark:border-gray-700 rounded-md bg-white dark:bg-gray-800 max-h-48 overflow-y-auto",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2",children:[G.map(l=>e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",id:`location-${l}`,checked:x.selectedLocations.includes(l),onChange:()=>X(l),className:"h-4 w-4 text-primary rounded border-gray-300 dark:border-gray-600 focus:ring-primary"}),e.jsxs("label",{htmlFor:`location-${l}`,className:"ml-2 text-sm text-gray-900 dark:text-gray-100",children:[l,e.jsxs("span",{className:"ml-1 text-xs text-gray-500 dark:text-gray-400",children:["(×",k.locations[l],")"]})]})]},l)),G.length===0&&e.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400 col-span-2 py-2 text-center",children:"Ничего не найдено"})]})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1 text-gray-700 dark:text-gray-300",children:"Частота появления"}),e.jsx("select",{value:x.frequencyType,onChange:me,className:"w-full px-3 py-2 border border-gray-600 dark:border-gray-700 rounded-md bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100",children:T.map(l=>e.jsx("option",{value:l,children:l},l))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1 text-gray-700 dark:text-gray-300",children:"Сложность крафта"}),e.jsx("select",{value:x.craftComplexity,onChange:Me,className:"w-full px-3 py-2 border border-gray-600 dark:border-gray-700 rounded-md bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100",children:b.map(l=>e.jsx("option",{value:l,children:l},l))})]})]}),n==="harvest"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center mb-4",children:[e.jsx("input",{type:"checkbox",id:"isHarvest",checked:x.isHarvest||!1,onChange:Re,className:"h-5 w-5 text-primary rounded border-gray-300 dark:border-gray-600 focus:ring-primary"}),e.jsx("label",{htmlFor:"isHarvest",className:"ml-2 text-base font-medium text-gray-700 dark:text-gray-300",children:"Это урожай"})]}),x.isHarvest&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-1",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Сезон роста"}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{type:"button",onClick:te,className:"text-xs text-blue-600 dark:text-blue-400 hover:underline",children:"Выбрать все"}),e.jsx("button",{type:"button",onClick:de,className:"text-xs text-blue-600 dark:text-blue-400 hover:underline",children:"Снять все"})]})]}),e.jsx("div",{className:"border border-gray-600 dark:border-gray-700 rounded-md bg-white dark:bg-gray-800 p-3",children:e.jsx("div",{className:"grid grid-cols-2 gap-2",children:D.map(l=>e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",id:`season-${l}`,checked:(x.growingSeason||[]).includes(l),onChange:()=>ee(l),className:"h-4 w-4 text-primary rounded border-gray-300 dark:border-gray-600 focus:ring-primary"}),e.jsxs("label",{htmlFor:`season-${l}`,className:"ml-2 text-sm text-gray-900 dark:text-gray-100",children:[l,e.jsxs("span",{className:"ml-1 text-xs text-gray-500 dark:text-gray-400",children:["(",Ze[l]," дней)"]})]})]},l))})}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:"Выберите сезоны, в которые можно выращивать"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1 text-gray-700 dark:text-gray-300",children:"Время роста (дни)"}),e.jsx("input",{type:"number",min:"1",value:x.growingTime||0,onChange:Pe,className:"w-full px-3 py-2 border border-gray-600 dark:border-gray-700 rounded-md bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100"}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:"Количество дней от посадки до сбора урожая. При изменении автоматически пересчитывается количество возможных урожаев за сезон."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1 text-gray-700 dark:text-gray-300",children:"Количество за сезон"}),e.jsx("input",{type:"number",min:"1",value:x.harvestPerSeason||1,onChange:We,className:"w-full px-3 py-2 border border-gray-600 dark:border-gray-700 rounded-md bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100"}),e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:["Сколько единиц урожая получается за один сезон. По умолчанию рассчитывается как максимальное количество полных урожаев за сезон (",x.growingSeason&&x.growingSeason.length>0&&(x.growingTime||0)>0?Math.floor(Math.min(...x.growingSeason.map(l=>Ze[l]||28))/(x.growingTime||0)):"?"," для выбранного времени роста)."]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1 text-gray-700 dark:text-gray-300",children:"Стоимость семян"}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs("select",{value:`seed_${x.seedCost||0}`,onChange:qe,className:"w-full px-3 py-2 border border-gray-600 dark:border-gray-700 rounded-md bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100",children:[e.jsx("option",{value:`seed_${x.seedCost||0}`,children:x.seedCost?`Стоимость: ${x.seedCost}`:"Выберите семена"}),s.length>0&&e.jsx("optgroup",{label:"Доступные семена",children:s.map(l=>e.jsxs("option",{value:l.name,children:[l.name," - ",a(l)]},l.name))})]}),e.jsx("input",{type:"number",min:"0",value:x.seedCost||0,onChange:Ue,className:"w-24 px-3 py-2 border border-gray-600 dark:border-gray-700 rounded-md bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100"})]}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:"Стоимость семян для посадки. Можно выбрать из списка доступных семян или ввести вручную."})]}),e.jsxs("div",{className:"mt-4 p-3 bg-blue-50 dark:bg-blue-900/20 rounded-md",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("span",{className:"text-sm font-medium text-blue-800 dark:text-blue-300",children:"Множитель дня роста:"}),e.jsx("span",{className:"text-sm font-bold text-blue-800 dark:text-blue-300",children:(k.growthDayMultiplier||1).toFixed(2)})]}),e.jsx("p",{className:"text-xs text-blue-600 dark:text-blue-400",children:"Этот множитель используется для расчета стоимости выращивания и настраивается в параметрах баланса."})]})]}),!x.isHarvest&&e.jsx("div",{className:"p-8 text-center",children:e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:'Включите опцию "Это урожай", чтобы настроить параметры урожая'})})]}),n==="fuel"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center mb-4",children:[e.jsx("input",{type:"checkbox",id:"isFuel",checked:x.isFuel||!1,onChange:Be,className:"h-5 w-5 text-primary rounded border-gray-300 dark:border-gray-600 focus:ring-primary"}),e.jsx("label",{htmlFor:"isFuel",className:"ml-2 text-base font-medium text-gray-700 dark:text-gray-300",children:"Это топливо"})]}),x.isFuel&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1 text-gray-700 dark:text-gray-300",children:"Эффективность топлива"}),e.jsx("input",{type:"number",min:"0.1",step:"0.1",value:x.fuelEfficiency||1,onChange:Oe,className:"w-full px-3 py-2 border border-gray-600 dark:border-gray-700 rounded-md bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100"}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:"Сколько единиц ресурса можно обработать одной единицей этого топлива. Например, если эффективность угля равна 2, то 1 углем можно переплавить 2 единицы руды."})]}),e.jsxs("div",{className:"mt-4 p-3 bg-gray-50 dark:bg-gray-700 rounded-md",children:[e.jsx("h4",{className:"text-sm font-medium mb-2 text-gray-800 dark:text-gray-200",children:"Примеры применения:"}),e.jsxs("div",{className:"space-y-2 text-sm text-gray-600 dark:text-gray-300",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Переплавка руды:"}),e.jsxs("span",{className:"font-medium",children:[(x.fuelEfficiency||1).toFixed(1)," руды / 1 ",x.name]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Для 10 единиц руды нужно:"}),e.jsxs("span",{className:"font-medium",children:[Math.ceil(10/(x.fuelEfficiency||1))," ",x.name]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("span",{children:["20 единиц ",x.name," переплавят:"]}),e.jsxs("span",{className:"font-medium",children:[Math.floor(20*(x.fuelEfficiency||1))," руды"]})]})]})]}),r.includes("Топливо")&&!x.selectedCategories.includes("Топливо")&&e.jsx("div",{className:"mt-4",children:e.jsx("button",{type:"button",onClick:()=>Y("Топливо"),className:"px-3 py-1 bg-blue-100 dark:bg-blue-900/30 text-blue-800 dark:text-blue-300 rounded-full text-sm hover:bg-blue-200 dark:hover:bg-blue-900/50 transition",children:'+ Добавить категорию "Топливо"'})})]}),!x.isFuel&&e.jsx("div",{className:"p-8 text-center",children:e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:'Включите опцию "Это топливо", чтобы настроить параметры топлива'})})]}),e.jsxs("div",{className:"flex space-x-2 pt-4",children:[e.jsx("button",{onClick:He,className:"px-4 py-2 bg-primary text-white rounded-md hover:bg-opacity-90 transition",children:S==="edit"?"Обновить":"Сохранить"}),e.jsx("button",{onClick:m,className:"px-4 py-2 bg-gray-300 dark:bg-gray-700 text-gray-800 dark:text-white rounded-md",children:"Отмена"})]})]})]}),e.jsxs("div",{className:"xl:col-span-1 bg-white dark:bg-gray-800 rounded-lg shadow p-4",children:[e.jsx("h2",{className:"text-lg font-semibold mb-4 text-gray-900 dark:text-gray-100",children:"Предпросмотр"}),e.jsxs("div",{className:"p-4 bg-gray-100 dark:bg-gray-700 rounded-lg mb-4",children:[e.jsx("div",{className:"text-2xl font-bold text-gray-900 dark:text-gray-100",children:ie}),e.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Расчетная стоимость"})]}),e.jsxs("div",{className:"mb-4 p-3 bg-gray-100 dark:bg-gray-700 rounded-lg",children:[e.jsx("h3",{className:"text-md font-medium mb-2 text-gray-900 dark:text-gray-100",children:"Выбранные атрибуты"}),e.jsxs("div",{className:"mb-2 flex flex-wrap gap-2",children:[x.isHarvest&&e.jsx("div",{className:"px-2 py-1 inline-block bg-green-100 dark:bg-green-900/30 text-green-800 dark:text-green-300 rounded-md text-sm font-medium",children:"Урожай"}),x.isFuel&&e.jsxs("div",{className:"px-2 py-1 inline-block bg-orange-100 dark:bg-orange-900/30 text-orange-800 dark:text-orange-300 rounded-md text-sm font-medium",children:["Топливо (эфф: ",x.fuelEfficiency||1,")"]})]}),x.isHarvest&&x.growingSeason&&x.growingSeason.length>0&&e.jsxs("div",{className:"mt-1 text-sm text-gray-700 dark:text-gray-300",children:["Сезон роста: ",ae(x.growingSeason)]}),x.subType&&e.jsxs("div",{className:"mb-2",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"Подтип:"}),e.jsx("div",{className:"flex flex-wrap gap-1 mt-1",children:e.jsx("span",{className:"px-2 py-0.5 text-xs bg-purple-100 dark:bg-purple-900/30 text-purple-800 dark:text-purple-300 rounded-full",children:x.subType})})]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"Категории:"}),e.jsx("div",{className:"flex flex-wrap gap-1 mt-1",children:x.selectedCategories.length>0?x.selectedCategories.map(l=>e.jsx("span",{className:"px-2 py-0.5 text-xs bg-blue-100 dark:bg-blue-900/30 text-blue-800 dark:text-blue-300 rounded-full",children:l},l)):e.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Не выбрано"})})]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"Модификаторы:"}),e.jsx("div",{className:"flex flex-wrap gap-1 mt-1",children:x.selectedModifiers.length>0?x.selectedModifiers.map(l=>e.jsx("span",{className:"px-2 py-0.5 text-xs bg-yellow-100 dark:bg-yellow-900/30 text-yellow-800 dark:text-yellow-300 rounded-full",children:l},l)):e.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Не выбрано"})})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"Локации:"}),e.jsx("div",{className:"flex flex-wrap gap-1 mt-1",children:x.selectedLocations.length>0?x.selectedLocations.map(l=>e.jsx("span",{className:"px-2 py-0.5 text-xs bg-green-100 dark:bg-green-900/30 text-green-800 dark:text-green-300 rounded-full",children:l},l)):e.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Не выбрано"})})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("h3",{className:"text-md font-medium mb-2 text-gray-900 dark:text-gray-100",children:"Компоненты стоимости"}),e.jsx("div",{className:"space-y-2",children:Object.entries(E).map(([l,q])=>e.jsxs("div",{className:"flex justify-between",children:[e.jsx("div",{className:"text-sm text-gray-700 dark:text-gray-300",children:l}),e.jsx("div",{className:"text-sm font-medium text-gray-900 dark:text-gray-100",children:q})]},l))})]}),x.isHarvest&&c&&e.jsxs("div",{className:"mb-4 p-3 bg-gray-100 dark:bg-gray-700 rounded-lg border-l-4 border-green-500 dark:border-green-700",children:[e.jsx("h3",{className:"text-md font-medium mb-2 text-gray-900 dark:text-gray-100",children:"Расчет стоимости урожая"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("div",{className:"text-sm text-gray-700 dark:text-gray-300",children:"Стоимость семян"}),e.jsx("div",{className:"text-sm font-medium text-gray-900 dark:text-gray-100",children:c.seedCost})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("div",{className:"text-sm text-gray-700 dark:text-gray-300",children:"Время роста (дни)"}),e.jsx("div",{className:"text-sm font-medium text-gray-900 dark:text-gray-100",children:c.growingTime})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("div",{className:"text-sm text-gray-700 dark:text-gray-300",children:"Множитель дня"}),e.jsx("div",{className:"text-sm font-medium text-gray-900 dark:text-gray-100",children:c.dayMultiplier.toFixed(2)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("div",{className:"text-sm text-gray-700 dark:text-gray-300",children:"Стоимость выращивания"}),e.jsxs("div",{className:"text-sm font-medium text-gray-900 dark:text-gray-100",children:[c.growingTime," × ",c.dayMultiplier.toFixed(2)," = ",Math.round(c.growingCost)]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("div",{className:"text-sm text-gray-700 dark:text-gray-300",children:"Количество за сезон"}),e.jsx("div",{className:"text-sm font-medium text-gray-900 dark:text-gray-100",children:c.harvestPerSeason})]}),e.jsxs("div",{className:"border-t border-gray-300 dark:border-gray-600 mt-2 pt-2 flex justify-between",children:[e.jsx("div",{className:"text-sm font-bold text-gray-700 dark:text-gray-300",children:"Формула расчета"}),e.jsxs("div",{className:"text-sm font-medium text-gray-900 dark:text-gray-100",children:["(",c.seedCost," + ",c.growingTime," × ",c.dayMultiplier.toFixed(2),") ÷ ",c.harvestPerSeason]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("div",{className:"text-sm font-bold text-gray-700 dark:text-gray-300",children:"Итоговая стоимость за единицу"}),e.jsx("div",{className:"text-sm font-bold text-gray-900 dark:text-gray-100",children:Math.round(c.unitCost)})]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-md font-medium mb-2 text-gray-900 dark:text-gray-100",children:"Формула расчета"}),x.isHarvest&&e.jsx("div",{className:"mb-4",children:e.jsxs("div",{className:"p-3 bg-gray-100 dark:bg-gray-700 rounded-lg",children:[e.jsx("p",{className:"text-sm text-gray-700 dark:text-gray-300",children:"Для урожая используется специальная формула:"}),e.jsx("pre",{className:"mt-2 p-2 bg-gray-200 dark:bg-gray-600 rounded text-sm overflow-x-auto",children:"(Стоимость семян + Время роста × Множитель дня) ÷ Количество за сезон"})]})}),e.jsx("div",{className:"mb-4",children:e.jsx(Ht,{item:x})})]})]})]})};function tt(){const o=je(),{state:R}=xe(),{comparisonItems:i,calculateItemCost:h,calculateSeasonalItemCost:w,removeItemFromComparison:a,addItemToComparison:k,updateItemInComparison:x,currentConfig:f}=o,[S,L]=u.useState(1),[C,M]=u.useState(10),[N,I]=u.useState("cost"),[A,P]=u.useState("desc"),[U,j]=u.useState("all"),[O,Z]=u.useState("all"),[n,t]=u.useState(1),[s,d]=u.useState(10),[r,y]=u.useState("all"),[p,v]=u.useState("all"),[T,b]=u.useState("table"),[D,J]=u.useState("base"),[B,G]=u.useState("base"),[K,ie]=u.useState(!1),[E,V]=u.useState(!1),[c,F]=u.useState(null),[g,W]=u.useState({name:"",tier:1,mechanic:"",selectedCategories:[],selectedModifiers:[],selectedLocations:[],frequencyType:Object.keys(f.frequencyTypes)[0]||"",craftComplexity:Object.keys(f.craftComplexityTypes)[0]||"",imageId:null,isHarvest:!1,growingSeason:[],growingTime:1,harvestPerSeason:1,seedCost:0,subType:""}),z=m=>{if(!m)return null;const _=Ee(m,R);if(_)return _;const Q=i.find(ae=>ae.imageId===m);return Q&&Q.imageUrl?Q.imageUrl:null},Y=m=>{W({...g,imageId:m})},$=(m,_)=>{console.log("Starting edit of item at original index:",_,m);const Q=i.findIndex(ae=>ae.name===m.name&&ae.tier===m.tier&&ae.mechanic===m.mechanic&&JSON.stringify(ae.selectedCategories)===JSON.stringify(m.selectedCategories));console.log("Actual index in comparisonItems:",Q),F({originalItem:m,index:Q>=0?Q:_}),W({name:m.name,tier:m.tier,mechanic:m.mechanic,selectedCategories:[...m.selectedCategories],selectedModifiers:[...m.selectedModifiers],selectedLocations:[...m.selectedLocations],frequencyType:m.frequencyType||Object.keys(f.frequencyTypes)[0]||"",craftComplexity:m.craftComplexity||Object.keys(f.craftComplexityTypes)[0]||"",imageId:m.imageId||null,subType:m.subType||"",isHarvest:m.isHarvest||!1,growingSeason:m.growingSeason?[...m.growingSeason]:[],growingTime:m.growingTime||1,harvestPerSeason:m.harvestPerSeason||1,seedCost:m.seedCost||0}),V(!0)},X=()=>{if(!c){console.error("Invalid editing state: editingItem is null");return}const{index:m,originalItem:_}=c;console.log("About to save item. Original index:",m),console.log("Original item:",_),console.log("Updated item:",g),m<0||m>=i.length?(console.error(`Invalid index: ${m}, items length: ${i.length}`),k(g)):x(m,g),V(!1),F(null)},ee=m=>{const _=h(m);return Math.round(_*(1-f.sellDiscount))},te=m=>{const _=h(m);return Math.round(_*(1+f.buyMarkup))},{uniqueCategories:de,uniqueMechanics:Ce,uniqueSubTypes:Te}=u.useMemo(()=>{const m=new Set,_=new Set,Q=new Set;return i.forEach(ae=>{ae.selectedCategories.forEach(l=>{m.add(l)}),_.add(ae.mechanic),ae.subType&&Q.add(ae.subType)}),{uniqueCategories:["all",...Array.from(m)],uniqueMechanics:["all",...Array.from(_)],uniqueSubTypes:["all",...Array.from(Q)]}},[i]);function ve(m){const _=m.selectedCategories.reduce((oe,ue)=>oe+(f.categories[ue]||0),0),Q=m.selectedCategories.length>0?_/m.selectedCategories.length:0,ae=1+(m.tier-1)*f.tierMultiplier,l=f.mechanics[m.mechanic]||1,q=m.selectedModifiers.reduce((oe,ue)=>oe+(f.modifiers[ue]||0),0),H=m.selectedLocations.reduce((oe,ue)=>oe+(f.locations[ue]||0),0),re=m.selectedLocations.length>0?H/m.selectedLocations.length:1,ce=m.selectedModifiers.length>0?q/m.selectedModifiers.length:1,pe=Math.round(f.weights.categoryWeight*Q*f.baseValue),se=Math.round(f.weights.tierWeight*ae*f.baseValue),le=Math.round(f.weights.mechanicWeight*l*f.baseValue),ye=Math.round(f.weights.modifiersWeight*ce*f.baseValue),ge=Math.round(f.weights.locationsWeight*re*f.baseValue);return{categoryComponent:pe,tierComponent:se,mechanicComponent:le,modifiersComponent:ye,locationsComponent:ge,total:h(m)}}const he=u.useMemo(()=>i.map(m=>{const _=ve(m);return{...m,components:_,cost:_.total}}),[i,f]),ne=u.useMemo(()=>{let m=[...he];return U!=="all"&&(m=m.filter(_=>_.mechanic===U)),O!=="all"&&(m=m.filter(_=>_.selectedCategories.includes(O))),r!=="all"&&(m=m.filter(_=>r==="harvest"&&_.isHarvest||r==="regular"&&!_.isHarvest)),p!=="all"&&(m=m.filter(_=>_.subType===p)),m=m.filter(_=>_.tier>=n&&_.tier<=s),m.sort((_,Q)=>{let ae,l;switch(N){case"name":ae=_.name,l=Q.name;break;case"tier":ae=_.tier,l=Q.tier;break;case"cost":ae=_.cost,l=Q.cost;break;case"categoryValue":ae=_.components.categoryComponent,l=Q.components.categoryComponent;break;case"tierValue":ae=_.components.tierComponent,l=Q.components.tierComponent;break;case"mechanicValue":ae=_.components.mechanicComponent,l=Q.components.mechanicComponent;break;case"growingTime":ae=_.growingTime||0,l=Q.growingTime||0;break;case"profitability":const q=_.isHarvest?(_.cost-(_.seedCost||0))/(_.growingTime||1):0,H=Q.isHarvest?(Q.cost-(Q.seedCost||0))/(Q.growingTime||1):0;ae=q,l=H;break;default:ae=_.cost,l=Q.cost}return typeof ae=="string"&&typeof l=="string"?A==="asc"?ae.localeCompare(l):l.localeCompare(ae):typeof ae=="number"&&typeof l=="number"?A==="asc"?ae-l:l-ae:0}),m},[he,U,O,n,s,r,p,N,A]),ke=u.useMemo(()=>{const m=(S-1)*C;return ne.slice(m,m+C)},[ne,S,C]),me=u.useMemo(()=>{if(ne.length===0)return null;const m=ne.map(H=>H.cost),_=ne.map(H=>H.tier),Q=ne.map(H=>ee(H)),ae=ne.map(H=>te(H)),l=ne.filter(H=>H.isHarvest),q=l.map(H=>{const re=H.cost,ce=H.seedCost||0,pe=H.growingTime||1;return(re-ce)/pe});return{count:ne.length,costMin:Math.min(...m),costMax:Math.max(...m),costAvg:Math.round(m.reduce((H,re)=>H+re,0)/m.length),costMedian:Me(m),tierAvg:(_.reduce((H,re)=>H+re,0)/_.length).toFixed(1),sellMin:Math.min(...Q),sellMax:Math.max(...Q),sellAvg:Math.round(Q.reduce((H,re)=>H+re,0)/Q.length),buyMin:Math.min(...ae),buyMax:Math.max(...ae),buyAvg:Math.round(ae.reduce((H,re)=>H+re,0)/ae.length),categoryAvg:Math.round(ne.reduce((H,re)=>H+re.components.categoryComponent,0)/ne.length),tierAvgValue:Math.round(ne.reduce((H,re)=>H+re.components.tierComponent,0)/ne.length),mechanicAvg:Math.round(ne.reduce((H,re)=>H+re.components.mechanicComponent,0)/ne.length),modifiersAvg:Math.round(ne.reduce((H,re)=>H+re.components.modifiersComponent,0)/ne.length),locationsAvg:Math.round(ne.reduce((H,re)=>H+(re.components.locationsComponent||0),0)/ne.length),harvestCount:l.length,harvestAvgProfit:q.length>0?Math.round(q.reduce((H,re)=>H+re,0)/q.length*10)/10:0,harvestMinProfit:q.length>0?Math.min(...q):0,harvestMaxProfit:q.length>0?Math.max(...q):0}},[ne,ee,te]);function Me(m){if(m.length===0)return 0;const _=[...m].sort((ae,l)=>ae-l),Q=Math.floor(_.length/2);return _.length%2===0?Math.round((_[Q-1]+_[Q])/2):_[Q]}const Re=m=>!m||m.length===0?"Не указано":m.join(", "),Be=m=>{if(!m.isHarvest)return 0;const _=h(m),Q=m.seedCost||0,ae=m.growingTime||1;return(_-Q)/ae},Oe=u.useMemo(()=>{if(ne.length===0)return{title:{text:"Нет данных для отображения",left:"center",top:"middle",textStyle:{color:document.documentElement.classList.contains("dark")?"#ccc":"#333"}}};let m,_,Q;switch(D){case"sell":m=ne.map(oe=>ee(oe)),_="Распределение цены продажи",Q="Диапазон цен продажи";break;case"buy":m=ne.map(oe=>te(oe)),_="Распределение цены покупки",Q="Диапазон цен покупки";break;default:m=ne.map(oe=>oe.cost),_="Распределение базовой ценности",Q="Диапазон базовой ценности"}const ae=Math.min(...m),q=Math.max(...m)-ae,H=Math.min(8,Math.ceil(Math.sqrt(ne.length))),re=q/H,ce=Array(H).fill(0);m.forEach(oe=>{const ue=Math.min(H-1,Math.floor((oe-ae)/re));ce[ue]++});const pe=ce.map((oe,ue)=>{const fe=Math.round(ae+ue*re),be=Math.round(ae+(ue+1)*re),Ie=Se=>Se>=1e4?(Se/1e3).toFixed(0)+"k":Se.toString();return`${Ie(fe)}-${Ie(be)}`}),se=document.documentElement.classList.contains("dark"),le=se?"#e5e7eb":"#374151",ye=se?"rgba(255, 255, 255, 0.1)":"rgba(0, 0, 0, 0.1)";let ge;switch(D){case"sell":ge="rgba(239, 68, 68, 0.7)";break;case"buy":ge="rgba(34, 197, 94, 0.7)";break;default:ge="rgba(93, 92, 222, 0.7)"}return{backgroundColor:"transparent",title:{text:_,left:"center",textStyle:{color:le,fontWeight:"bold",fontSize:16}},tooltip:{trigger:"item",formatter:function(oe){const ue=typeof oe.value=="number"?oe.value:0,fe=(ue/ne.length*100).toFixed(1),be=oe.name.split("-"),Ie=be.length===2?`${be[0]} - ${be[1]}`:oe.name;return`${Q}: ${Ie}<br/>Предметов: ${ue} (${fe}%)`},backgroundColor:se?"rgba(30, 30, 30, 0.9)":"rgba(255, 255, 255, 0.9)",borderColor:se?"#555":"#ddd",textStyle:{color:se?"#fff":"#333"}},grid:{left:"5%",right:"5%",bottom:"18%",top:"60px",containLabel:!0},xAxis:{type:"category",data:pe,axisLabel:{color:le,rotate:45,fontSize:11,interval:0,hideOverlap:!0,margin:14,align:"right"},axisLine:{lineStyle:{color:ye}},name:Q,nameLocation:"middle",nameGap:50,nameTextStyle:{color:le,fontSize:12,padding:[30,0,0,0]}},yAxis:{type:"value",name:"Количество предметов",nameLocation:"middle",nameGap:50,nameTextStyle:{color:le,fontSize:12},axisLabel:{color:le},axisLine:{lineStyle:{color:ye}},splitLine:{lineStyle:{color:ye}}},series:[{data:ce,type:"bar",itemStyle:{color:ge,borderRadius:[3,3,0,0]},emphasis:{itemStyle:{color:ge.replace("0.7","0.9")}},barMaxWidth:"60%",barCategoryGap:"30%"}]}},[ne,D,ee,te]),Pe=u.useMemo(()=>{if(ne.length===0)return{title:{text:"Нет данных для отображения",left:"center",top:"middle",textStyle:{color:document.documentElement.classList.contains("dark")?"#ccc":"#333"}}};let m;switch(B){case"sell":m="Распределение цены продажи по тирам и механикам";break;case"buy":m="Распределение цены покупки по тирам и механикам";break;default:m="Распределение базовой ценности по тирам и механикам"}const _=Array.from(new Set(ne.map(se=>se.tier))).sort((se,le)=>se-le),Q=Array.from(new Set(ne.map(se=>se.mechanic))),ae=ne.map(se=>{let le;switch(B){case"sell":le=ee(se);break;case"buy":le=te(se);break;default:le=se.cost;break}return{...se,value:le}}),l={};_.forEach(se=>{l[se]={},Q.forEach(le=>{l[se][le]={sum:0,count:0,avg:0}})}),ae.forEach(se=>{l[se.tier]&&l[se.tier][se.mechanic]&&(l[se.tier][se.mechanic].sum+=se.value,l[se.tier][se.mechanic].count++)}),_.forEach(se=>{Q.forEach(le=>{l[se][le].count>0&&(l[se][le].avg=Math.round(l[se][le].sum/l[se][le].count))})});const q=Q.map(se=>{const le=_.map(ye=>l[ye][se].avg||0);return{name:se,type:"bar",stack:"total",emphasis:{focus:"series"},label:{show:!0,formatter:function(ye){const ge=typeof ye.value=="number"?ye.value:0;return ge<1e3?"":ge>=1e4?(ge/1e3).toFixed(1)+"k":ge.toString()},position:"inside",color:"#fff",fontSize:11,textShadowColor:"rgba(0, 0, 0, 0.5)",textShadowBlur:3},data:le}}),H=["#3B82F6","#EF4444","#F59E0B","#10B981","#8B5CF6","#EC4899","#6B7280"],re=document.documentElement.classList.contains("dark"),ce=re?"#e5e7eb":"#374151",pe=re?"rgba(255, 255, 255, 0.1)":"rgba(0, 0, 0, 0.1)";return{backgroundColor:"transparent",title:{text:m,left:"center",top:15,textStyle:{color:ce,fontWeight:"bold",fontSize:16}},tooltip:{trigger:"axis",axisPointer:{type:"shadow"},formatter:function(se){if(!se)return"";const le=Array.isArray(se)?se:[se];if(le.length===0)return"";const ye=le[0].axisValue;let ge=0,oe=`<div style="font-weight:bold;margin-bottom:5px">Тир ${ye}</div>`;le.forEach(fe=>{const be=typeof fe.value=="number"?fe.value:0;be>0&&(ge+=be)}),ge=Math.round(ge),le.forEach(fe=>{const be=typeof fe.value=="number"?fe.value:0;if(be>0){const Ie=Math.round(be/ge*100),Se=Math.round(be),_e=Se>=1e4?(Se/1e3).toFixed(1)+" тыс.":Se;oe+=`<div style="display:flex;justify-content:space-between;margin:3px 0">
                <div>
                  <span style="display:inline-block;width:10px;height:10px;border-radius:50%;background-color:${fe.color};margin-right:8px"></span>
                  <span>${fe.seriesName}</span>
                </div>
                <div style="margin-left:20px;font-weight:bold">
                  ${_e} (${Ie}%)
                </div>
              </div>`}});const ue=ge>=1e4?(ge/1e3).toFixed(1)+" тыс.":ge;return oe+=`<div style="margin-top:5px;padding-top:5px;border-top:1px solid ${re?"#555":"#ddd"}">
            <div style="display:flex;justify-content:space-between">
              <span>Всего:</span>
              <span style="font-weight:bold;margin-left:20px">${ue}</span>
            </div>
          </div>`,oe},backgroundColor:re?"rgba(30, 30, 30, 0.9)":"rgba(255, 255, 255, 0.9)",borderColor:re?"#555":"#ddd",textStyle:{color:re?"#fff":"#333"}},legend:{data:Q,orient:"horizontal",left:"center",bottom:10,textStyle:{color:ce,fontSize:12},itemWidth:12,itemHeight:12,itemGap:20,selectedMode:!0},color:H,grid:{left:60,right:20,bottom:70,top:60,containLabel:!0},xAxis:{type:"category",data:_.map(se=>`Тир ${se}`),name:"Тир предмета",nameLocation:"middle",nameGap:35,nameTextStyle:{color:ce,fontSize:12,padding:[10,0,0,0]},axisLabel:{color:ce},axisLine:{lineStyle:{color:pe}}},yAxis:{type:"value",name:B==="sell"?"Цена продажи":B==="buy"?"Цена покупки":"Базовая ценность",nameLocation:"middle",nameGap:50,nameTextStyle:{color:ce,fontSize:12},axisLabel:{color:ce,formatter:function(se){return se>=1e4?se/1e3+"k":se.toString()}},axisLine:{lineStyle:{color:pe}},splitLine:{lineStyle:{color:pe}}},series:q}},[ne,B,ee,te]),We=()=>E?e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 p-6 rounded-lg w-full max-w-3xl max-h-[90vh] overflow-y-auto",children:[e.jsx("h2",{className:"text-xl font-semibold mb-4",children:"Edit Item"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Item Image"}),e.jsx(Fe,{onUpload:Y,currentImageId:g.imageId,size:"lg"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Name"}),e.jsx("input",{type:"text",value:g.name,onChange:m=>W({...g,name:m.target.value}),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-700 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Tier"}),e.jsx("input",{type:"number",min:"1",max:"10",value:g.tier,onChange:m=>W({...g,tier:parseInt(m.target.value)||1}),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-700 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100"})]}),e.jsxs("div",{className:"relative z-30",children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Mechanic"}),e.jsx("select",{value:g.mechanic,onChange:m=>W({...g,mechanic:m.target.value}),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-700 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100",children:Object.entries(f.mechanics).map(([m,_])=>e.jsxs("option",{value:m,children:[m," (×",_,")"]},m))})]}),e.jsxs("div",{className:"relative z-20",children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Встречаемость объекта"}),e.jsx("select",{value:g.frequencyType,onChange:m=>W({...g,frequencyType:m.target.value}),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-700 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100",children:Object.entries(f.frequencyTypes).map(([m,_])=>e.jsxs("option",{value:m,children:[m," (×",_,")"]},m))})]}),e.jsxs("div",{className:"relative z-10",children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Сложность крафта"}),e.jsx("select",{value:g.craftComplexity,onChange:m=>W({...g,craftComplexity:m.target.value}),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-700 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100",children:Object.entries(f.craftComplexityTypes).map(([m,_])=>e.jsxs("option",{value:m,children:[m," (×",_,")"]},m))})]}),e.jsxs("div",{className:"relative z-9",children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Подтип"}),e.jsxs("select",{value:g.subType||"",onChange:m=>W({...g,subType:m.target.value}),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-700 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100",children:[e.jsx("option",{value:"",children:"Не указан"}),Object.keys(f.subTypeModifiers||{}).map(m=>e.jsxs("option",{value:m,children:[m," (×",f.subTypeModifiers[m]||1,")"]},m))]})]}),e.jsx("div",{className:"relative z-8",children:e.jsxs("label",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"checkbox",checked:g.isHarvest,onChange:m=>W({...g,isHarvest:m.target.checked}),className:"form-checkbox h-5 w-5 text-primary rounded"}),e.jsx("span",{className:"text-sm font-medium",children:"Это предмет урожая"})]})}),g.isHarvest&&e.jsxs("div",{className:"space-y-4 p-4 border border-green-300 dark:border-green-700 rounded-md bg-green-50 dark:bg-green-900/20",children:[e.jsx("h3",{className:"font-medium text-green-800 dark:text-green-300",children:"Настройки урожая"}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Сезоны роста"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:(f.seasons||["Весна","Лето","Осень","Зима"]).map(m=>{var _;return e.jsxs("label",{className:"flex items-center space-x-2 p-2 border border-gray-300 dark:border-gray-600 rounded-md",children:[e.jsx("input",{type:"checkbox",checked:((_=g.growingSeason)==null?void 0:_.includes(m))||!1,onChange:Q=>{const ae=Q.target.checked?[...g.growingSeason||[],m]:(g.growingSeason||[]).filter(l=>l!==m);W({...g,growingSeason:ae})},className:"form-checkbox h-4 w-4 text-primary rounded"}),e.jsx("span",{className:"text-sm",children:m})]},m)})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Время роста (дней)"}),e.jsx("input",{type:"number",min:"1",value:g.growingTime||1,onChange:m=>W({...g,growingTime:parseInt(m.target.value)||1}),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-700 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Количество за сезон"}),e.jsx("input",{type:"number",min:"1",value:g.harvestPerSeason||1,onChange:m=>W({...g,harvestPerSeason:parseInt(m.target.value)||1}),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-700 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Стоимость семян"}),e.jsx("input",{type:"number",min:"0",value:g.seedCost||0,onChange:m=>W({...g,seedCost:parseInt(m.target.value)||0}),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-700 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Categories"}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-2 border border-gray-300 dark:border-gray-700 p-3 rounded-md max-h-52 overflow-y-auto",children:Object.keys(f.categories).map(m=>e.jsxs("label",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"checkbox",checked:g.selectedCategories.includes(m),onChange:_=>{const Q=_.target.checked?[...g.selectedCategories,m]:g.selectedCategories.filter(ae=>ae!==m);W({...g,selectedCategories:Q})},className:"form-checkbox h-4 w-4 text-primary rounded"}),e.jsx("span",{children:m})]},m))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Modifiers"}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-2 border border-gray-300 dark:border-gray-700 p-3 rounded-md max-h-52 overflow-y-auto",children:Object.keys(f.modifiers).map(m=>e.jsxs("label",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"checkbox",checked:g.selectedModifiers.includes(m),onChange:_=>{const Q=_.target.checked?[...g.selectedModifiers,m]:g.selectedModifiers.filter(ae=>ae!==m);W({...g,selectedModifiers:Q})},className:"form-checkbox h-4 w-4 text-primary rounded"}),e.jsx("span",{children:m})]},m))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Locations"}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-2 border border-gray-300 dark:border-gray-700 p-3 rounded-md max-h-52 overflow-y-auto",children:Object.keys(f.locations).map(m=>e.jsxs("label",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"checkbox",checked:g.selectedLocations.includes(m),onChange:_=>{const Q=_.target.checked?[...g.selectedLocations,m]:g.selectedLocations.filter(ae=>ae!==m);W({...g,selectedLocations:Q})},className:"form-checkbox h-4 w-4 text-primary rounded"}),e.jsx("span",{children:m})]},m))})]})]}),e.jsxs("div",{className:"flex justify-end space-x-3 mt-6",children:[e.jsx("button",{onClick:()=>{V(!1),F(null)},className:"px-4 py-2 bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200 rounded-md",children:"Cancel"}),e.jsx("button",{onClick:X,className:"px-4 py-2 bg-primary text-white rounded-md",children:"Save Changes"})]})]})}):null;if(i.length===0)return e.jsx("div",{className:"bg-gray-50 dark:bg-gray-700 p-6 rounded-lg text-center",children:e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"No items to compare yet. Add items from the Item Calculator."})});const qe=()=>e.jsx("div",{className:"bg-gray-50 dark:bg-gray-700 p-4 rounded-lg mb-4",children:e.jsxs("div",{className:"flex flex-wrap gap-4 items-end",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Mechanic"}),e.jsx("select",{value:U,onChange:m=>j(m.target.value),className:"px-3 py-2 border border-gray-300 dark:border-gray-700 rounded-md bg-white dark:bg-gray-800 text-sm",children:Ce.map(m=>e.jsx("option",{value:m,children:m==="all"?"All Mechanics":m},m))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Category"}),e.jsx("select",{value:O,onChange:m=>Z(m.target.value),className:"px-3 py-2 border border-gray-300 dark:border-gray-700 rounded-md bg-white dark:bg-gray-800 text-sm",children:de.map(m=>e.jsx("option",{value:m,children:m==="all"?"All Categories":m},m))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Тип предмета"}),e.jsxs("select",{value:r,onChange:m=>y(m.target.value),className:"px-3 py-2 border border-gray-300 dark:border-gray-700 rounded-md bg-white dark:bg-gray-800 text-sm",children:[e.jsx("option",{value:"all",children:"Все типы"}),e.jsx("option",{value:"regular",children:"Обычные предметы"}),e.jsx("option",{value:"harvest",children:"Урожай"})]})]}),Te.length>1&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Подтип"}),e.jsx("select",{value:p,onChange:m=>v(m.target.value),className:"px-3 py-2 border border-gray-300 dark:border-gray-700 rounded-md bg-white dark:bg-gray-800 text-sm",children:Te.map(m=>e.jsx("option",{value:m,children:m==="all"?"Все подтипы":m},m))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Tier Range"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"number",min:"1",max:"10",value:n,onChange:m=>t(Math.min(parseInt(m.target.value)||1,s)),className:"w-16 px-2 py-2 border border-gray-300 dark:border-gray-700 rounded-md bg-white dark:bg-gray-800 text-sm"}),e.jsx("span",{children:"to"}),e.jsx("input",{type:"number",min:"1",max:"10",value:s,onChange:m=>d(Math.max(parseInt(m.target.value)||1,n)),className:"w-16 px-2 py-2 border border-gray-300 dark:border-gray-700 rounded-md bg-white dark:bg-gray-800 text-sm"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Sort By"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("select",{value:N,onChange:m=>I(m.target.value),className:"px-3 py-2 border border-gray-300 dark:border-gray-700 rounded-md bg-white dark:bg-gray-800 text-sm",children:[e.jsx("option",{value:"name",children:"Name"}),e.jsx("option",{value:"tier",children:"Tier"}),e.jsx("option",{value:"cost",children:"Total Cost"}),e.jsx("option",{value:"categoryValue",children:"Category Value"}),e.jsx("option",{value:"tierValue",children:"Tier Value"}),e.jsx("option",{value:"mechanicValue",children:"Mechanic Value"}),e.jsx("option",{value:"growingTime",children:"Время роста"}),e.jsx("option",{value:"profitability",children:"Доходность"})]}),e.jsx("button",{onClick:()=>P(A==="asc"?"desc":"asc"),className:"px-3 py-2 bg-gray-200 dark:bg-gray-600 rounded-md",children:A==="asc"?"↑":"↓"})]})]}),r==="harvest"||r==="all"?e.jsx("div",{children:e.jsx("button",{onClick:()=>ie(!K),className:`px-3 py-2 rounded-md text-sm ${K?"bg-primary text-white":"bg-gray-200 dark:bg-gray-600"}`,children:K?"Скрыть сезонные цены":"Показать сезонные цены"})}):null,e.jsx("div",{className:"ml-auto",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("button",{onClick:()=>b("table"),className:`px-3 py-2 rounded-md text-sm ${T==="table"?"bg-primary text-white":"bg-gray-200 dark:bg-gray-600"}`,children:"Table View"}),e.jsx("button",{onClick:()=>b("distribution"),className:`px-3 py-2 rounded-md text-sm ${T==="distribution"?"bg-primary text-white":"bg-gray-200 dark:bg-gray-600"}`,children:"Distribution"}),e.jsx("button",{onClick:()=>b("stacked"),className:`px-3 py-2 rounded-md text-sm ${T==="stacked"?"bg-primary text-white":"bg-gray-200 dark:bg-gray-600"}`,children:"Stacked"})]})})]})}),Ue=()=>me?e.jsxs("div",{className:"space-y-4 mb-6",children:[e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-6 gap-4",children:[e.jsxs("div",{className:"bg-white dark:bg-gray-800 p-4 rounded-lg shadow-sm",children:[e.jsx("div",{className:"text-gray-500 dark:text-gray-400 text-sm",children:"Items"}),e.jsx("div",{className:"text-2xl font-bold",children:me.count})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 p-4 rounded-lg shadow-sm",children:[e.jsx("div",{className:"text-gray-500 dark:text-gray-400 text-sm",children:"Avg Cost"}),e.jsx("div",{className:"text-2xl font-bold",children:me.costAvg})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 p-4 rounded-lg shadow-sm",children:[e.jsx("div",{className:"text-gray-500 dark:text-gray-400 text-sm",children:"Range"}),e.jsxs("div",{className:"text-xl font-bold",children:[me.costMin," - ",me.costMax]})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 p-4 rounded-lg shadow-sm",children:[e.jsx("div",{className:"text-red-500 dark:text-red-400 text-sm",children:"Avg Sell"}),e.jsx("div",{className:"text-2xl font-bold text-red-500 dark:text-red-400",children:me.sellAvg})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 p-4 rounded-lg shadow-sm",children:[e.jsx("div",{className:"text-red-500 dark:text-red-400 text-sm",children:"Sell Range"}),e.jsxs("div",{className:"text-xl font-bold text-red-500 dark:text-red-400",children:[me.sellMin," - ",me.sellMax]})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 p-4 rounded-lg shadow-sm",children:[e.jsx("div",{className:"text-green-500 dark:text-green-400 text-sm",children:"Avg Buy"}),e.jsx("div",{className:"text-2xl font-bold text-green-500 dark:text-green-400",children:me.buyAvg})]})]}),me.harvestCount>0&&e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-green-50 dark:bg-green-900/20 p-4 rounded-lg shadow-sm border border-green-200 dark:border-green-800",children:[e.jsx("div",{className:"text-green-600 dark:text-green-400 text-sm",children:"Предметов урожая"}),e.jsx("div",{className:"text-2xl font-bold text-green-600 dark:text-green-400",children:me.harvestCount})]}),e.jsxs("div",{className:"bg-green-50 dark:bg-green-900/20 p-4 rounded-lg shadow-sm border border-green-200 dark:border-green-800",children:[e.jsx("div",{className:"text-green-600 dark:text-green-400 text-sm",children:"Средняя доходность"}),e.jsxs("div",{className:"text-2xl font-bold text-green-600 dark:text-green-400",children:[me.harvestAvgProfit," в день"]})]}),e.jsxs("div",{className:"bg-green-50 dark:bg-green-900/20 p-4 rounded-lg shadow-sm border border-green-200 dark:border-green-800",children:[e.jsx("div",{className:"text-green-600 dark:text-green-400 text-sm",children:"Мин. доходность"}),e.jsx("div",{className:"text-2xl font-bold text-green-600 dark:text-green-400",children:me.harvestMinProfit.toFixed(1)})]}),e.jsxs("div",{className:"bg-green-50 dark:bg-green-900/20 p-4 rounded-lg shadow-sm border border-green-200 dark:border-green-800",children:[e.jsx("div",{className:"text-green-600 dark:text-green-400 text-sm",children:"Макс. доходность"}),e.jsx("div",{className:"text-2xl font-bold text-green-600 dark:text-green-400",children:me.harvestMaxProfit.toFixed(1)})]})]})]}):null,Ge=m=>{if(!K||!m.isHarvest)return null;const _=f.seasons||["Весна","Лето","Осень","Зима"];return e.jsxs("div",{className:"mt-3 p-2 bg-gray-50 dark:bg-gray-700 rounded-md",children:[e.jsx("h4",{className:"text-xs font-medium mb-1",children:"Сезонные цены:"}),e.jsx("div",{className:"grid grid-cols-2 gap-1",children:_.map(Q=>{var q;const ae=w(m,Q),l=(q=m.growingSeason)==null?void 0:q.includes(Q);return e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("span",{className:`text-xs ${l?"font-medium text-green-600 dark:text-green-400":""}`,children:[Q,":"]}),e.jsx("span",{className:`text-xs ${l?"font-medium text-green-600 dark:text-green-400":""}`,children:ae})]},Q)})}),e.jsx("div",{className:"mt-2 border-t border-gray-200 dark:border-gray-600 pt-1",children:e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-xs font-medium",children:"Доходность:"}),e.jsxs("span",{className:"text-xs font-medium",children:[Be(m).toFixed(1)," в день"]})]})})]})},He=()=>e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg overflow-hidden shadow-sm",children:[e.jsxs("table",{className:"min-w-full divide-y divide-gray-200 dark:divide-gray-700",children:[e.jsx("thead",{className:"bg-gray-50 dark:bg-gray-700",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider w-12",children:"Image"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Name"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Tier"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Type"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Mechanic"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-blue-500 dark:text-blue-400 uppercase tracking-wider",children:"Cat"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-green-500 dark:text-green-400 uppercase tracking-wider",children:"Tier"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-purple-500 dark:text-purple-400 uppercase tracking-wider",children:"Mech"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-yellow-500 dark:text-yellow-400 uppercase tracking-wider",children:"Mod"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-red-500 dark:text-red-400 uppercase tracking-wider",children:"Loc"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Base"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-red-500 dark:text-red-400 uppercase tracking-wider",children:"Sell"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-green-500 dark:text-green-400 uppercase tracking-wider",children:"Buy"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200 dark:divide-gray-700",children:ke.map((m,_)=>{const Q=i.findIndex(l=>l.name===m.name&&l.tier===m.tier&&l.mechanic===m.mechanic),ae=z(m.imageId);return e.jsxs("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-600",children:[e.jsx("td",{className:"px-4 py-3 text-sm",children:ae?e.jsx("div",{className:"w-8 h-8 rounded-full overflow-hidden bg-gray-200 dark:bg-gray-700 flex-shrink-0",children:e.jsx("img",{src:ae,alt:m.name,className:"w-full h-full object-cover"})}):e.jsx("div",{className:"w-8 h-8 rounded-full bg-gray-200 dark:bg-gray-700 flex items-center justify-center flex-shrink-0",children:m.imageId?e.jsx("span",{className:"text-gray-400 text-xs",title:`Image ID: ${m.imageId}`,children:"ID"}):e.jsx("span",{className:"text-gray-400 text-xs",children:"No img"})})}),e.jsxs("td",{className:"px-4 py-3",children:[e.jsx("div",{className:"text-sm font-medium",children:m.name}),m.subType&&e.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:m.subType}),Ge(m)]}),e.jsx("td",{className:"px-4 py-3 text-sm",children:m.tier}),e.jsxs("td",{className:"px-4 py-3 text-sm",children:[m.isHarvest?e.jsx("span",{className:"px-2 py-1 text-xs bg-green-100 dark:bg-green-900/30 text-green-800 dark:text-green-300 rounded-full",children:"Урожай"}):e.jsx("span",{className:"px-2 py-1 text-xs bg-gray-100 dark:bg-gray-700 text-gray-800 dark:text-gray-300 rounded-full",children:"Обычный"}),m.isHarvest&&m.growingSeason&&e.jsxs("div",{className:"mt-1 text-xs text-gray-500 dark:text-gray-400",children:["Сезоны: ",Re(m.growingSeason)]}),m.isHarvest&&m.growingTime&&e.jsxs("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:["Время: ",m.growingTime," дн."]})]}),e.jsx("td",{className:"px-4 py-3 text-sm",children:m.mechanic}),e.jsxs("td",{className:"px-4 py-3 text-sm text-blue-500 dark:text-blue-400",children:["+",m.components.categoryComponent]}),e.jsxs("td",{className:"px-4 py-3 text-sm text-green-500 dark:text-green-400",children:["+",m.components.tierComponent]}),e.jsxs("td",{className:"px-4 py-3 text-sm text-purple-500 dark:text-purple-400",children:["+",m.components.mechanicComponent]}),e.jsxs("td",{className:"px-4 py-3 text-sm text-yellow-500 dark:text-yellow-400",children:["+",m.components.modifiersComponent]}),e.jsxs("td",{className:"px-4 py-3 text-sm text-red-500 dark:text-red-400",children:["+",m.components.locationsComponent]}),e.jsx("td",{className:"px-4 py-3 text-sm font-bold",children:m.cost}),e.jsx("td",{className:"px-4 py-3 text-sm font-bold text-red-500 dark:text-red-400",children:ee(m)}),e.jsx("td",{className:"px-4 py-3 text-sm font-bold text-green-500 dark:text-green-400",children:te(m)}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{onClick:()=>$(m,Q>=0?Q:_),className:"text-blue-500 hover:text-blue-700",title:"Edit item",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})})}),e.jsx("button",{onClick:()=>a(Q>=0?Q:_),className:"text-red-500 hover:text-red-700",title:"Remove item",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})})]},_)})})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 px-4 py-3 flex items-center justify-between border-t border-gray-200 dark:border-gray-700",children:[e.jsx("div",{className:"flex items-center",children:e.jsxs("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:["Showing ",e.jsx("span",{className:"font-medium",children:Math.min((S-1)*C+1,ne.length)})," to"," ",e.jsx("span",{className:"font-medium",children:Math.min(S*C,ne.length)})," ","of ",e.jsx("span",{className:"font-medium",children:ne.length})," results"]})}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("select",{value:C,onChange:m=>{M(Number(m.target.value)),L(1)},className:"px-2 py-1 text-sm border border-gray-300 dark:border-gray-700 rounded-md bg-white dark:bg-gray-700",children:[e.jsx("option",{value:10,children:"10 per page"}),e.jsx("option",{value:20,children:"20 per page"}),e.jsx("option",{value:50,children:"50 per page"}),e.jsx("option",{value:100,children:"100 per page"})]}),e.jsx("button",{onClick:()=>L(Math.max(1,S-1)),disabled:S===1,className:`px-3 py-1 rounded-md text-sm ${S===1?"bg-gray-100 dark:bg-gray-700 text-gray-400 dark:text-gray-500 cursor-not-allowed":"bg-gray-200 dark:bg-gray-600 hover:bg-gray-300 dark:hover:bg-gray-500"}`,children:"Previous"}),e.jsxs("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:["Page ",S," of ",Math.max(1,Math.ceil(ne.length/C))]}),e.jsx("button",{onClick:()=>L(Math.min(Math.ceil(ne.length/C),S+1)),disabled:S>=Math.ceil(ne.length/C),className:`px-3 py-1 rounded-md text-sm ${S>=Math.ceil(ne.length/C)?"bg-gray-100 dark:bg-gray-700 text-gray-400 dark:text-gray-500 cursor-not-allowed":"bg-gray-200 dark:bg-gray-600 hover:bg-gray-300 dark:hover:bg-gray-500"}`,children:"Next"})]})]})]});return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h2",{className:"text-lg font-semibold",children:"Item Comparison Analysis"}),e.jsxs("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:[i.length," items"]})]}),qe(),me&&Ue(),T==="table"&&He(),T==="distribution"&&e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 p-4 rounded-md",children:[e.jsxs("div",{className:"flex justify-center space-x-4 mb-4",children:[e.jsx("button",{onClick:()=>J("base"),className:`px-3 py-1 rounded-md text-sm ${D==="base"?"bg-primary text-white":"bg-gray-200 dark:bg-gray-600 hover:bg-gray-300 dark:hover:bg-gray-500"}`,children:"Базовая ценность"}),e.jsx("button",{onClick:()=>J("sell"),className:`px-3 py-1 rounded-md text-sm ${D==="sell"?"bg-red-500 text-white":"bg-gray-200 dark:bg-gray-600 hover:bg-gray-300 dark:hover:bg-gray-500"}`,children:"Цена продажи"}),e.jsx("button",{onClick:()=>J("buy"),className:`px-3 py-1 rounded-md text-sm ${D==="buy"?"bg-green-500 text-white":"bg-gray-200 dark:bg-gray-600 hover:bg-gray-300 dark:hover:bg-gray-500"}`,children:"Цена покупки"})]}),e.jsx("div",{className:"h-96",children:e.jsx(Ne,{options:Oe})})]})}),T==="stacked"&&e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 p-4 rounded-md",children:[e.jsxs("div",{className:"flex justify-center space-x-4 mb-4",children:[e.jsx("button",{onClick:()=>G("base"),className:`px-3 py-1 rounded-md text-sm ${B==="base"?"bg-primary text-white":"bg-gray-200 dark:bg-gray-600 hover:bg-gray-300 dark:hover:bg-gray-500"}`,children:"Базовая ценность"}),e.jsx("button",{onClick:()=>G("sell"),className:`px-3 py-1 rounded-md text-sm ${B==="sell"?"bg-red-500 text-white":"bg-gray-200 dark:bg-gray-600 hover:bg-gray-300 dark:hover:bg-gray-500"}`,children:"Цена продажи"}),e.jsx("button",{onClick:()=>G("buy"),className:`px-3 py-1 rounded-md text-sm ${B==="buy"?"bg-green-500 text-white":"bg-gray-200 dark:bg-gray-600 hover:bg-gray-300 dark:hover:bg-gray-500"}`,children:"Цена покупки"})]}),e.jsx("div",{className:"h-96",children:e.jsx(Ne,{options:Pe})})]})}),We()]})}const zt=()=>{const{state:o,updateState:R}=xe(),i={items:["list","editor","comparison"],recipes:["list","editor","tree"],balance:["parameters","configs"],analysis:["items","recipes"]},[h,w]=u.useState("items"),[a,k]=u.useState({items:"list",recipes:"list",balance:"parameters",analysis:"items"}),[x,f]=u.useState(null),[S,L]=u.useState(null),C=(s,d)=>{k(r=>({...r,[s]:d}))},M=nt(),N=s=>{w(s),M(`/balance-crafting/${s}/${a[s]}`)},I=(s,d)=>{C(s,d),s===h&&M(`/balance-crafting/${s}/${d}`)};window.switchTabDirectly=(s,d,r)=>{s==="items"&&d==="editor"?f(r||null):s==="recipes"&&d==="editor"&&L(r||null),w(s),C(s,d),M(`/balance-crafting/${s}/${d}`)};const A=()=>{f(null),I("items","editor")},P=s=>{f(s),I("items","editor")},U=s=>{const d={...s,name:""};f(d),I("items","editor")},j=s=>{const d=o.balance.comparisonItems.filter(r=>r.name!==s.name);R("balance",{...o.balance,comparisonItems:d})},O=()=>{L(null),I("recipes","editor")},Z=s=>{if(s===""){O();return}L(s),I("recipes","editor")},n=()=>{I("recipes","list"),L(null)},t=()=>{switch(h){case"items":switch(a.items){case"list":return e.jsx(Gt,{onCreateItem:A,onEditItem:P,onDeleteItem:j,onDuplicateItem:U});case"editor":return e.jsx(_t,{itemToEdit:x,onBack:()=>I("items","list")});case"comparison":return e.jsx(tt,{});default:return null}case"recipes":switch(a.recipes){case"list":return e.jsx(Ot,{onSelectRecipe:Z,selectedRecipeId:a.recipes==="list"?null:S});case"editor":return e.jsx(Pt,{selectedRecipeId:S,onRecipeSaved:n});case"tree":return e.jsx(Ut,{});default:return null}case"balance":switch(a.balance){case"parameters":return e.jsx(Rt,{});case"configs":return e.jsx(Bt,{});default:return null}case"analysis":switch(a.analysis){case"items":return e.jsx(tt,{});case"recipes":return e.jsx(Wt,{});default:return null}default:return e.jsx("div",{children:"Default content"})}};return e.jsxs("div",{className:"flex flex-col h-full",children:[e.jsx("div",{className:"bg-white dark:bg-gray-800 border-b border-gray-200 dark:border-gray-700",children:e.jsxs("div",{className:"flex space-x-1 p-2",children:[e.jsx("button",{onClick:()=>N("items"),className:`px-4 py-2 rounded-t-lg text-sm font-medium ${h==="items"?"bg-primary text-white":"bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600"}`,children:"Предметы"}),e.jsx("button",{onClick:()=>N("recipes"),className:`px-4 py-2 rounded-t-lg text-sm font-medium ${h==="recipes"?"bg-primary text-white":"bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600"}`,children:"Рецепты"}),e.jsx("button",{onClick:()=>N("balance"),className:`px-4 py-2 rounded-t-lg text-sm font-medium ${h==="balance"?"bg-primary text-white":"bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600"}`,children:"Баланс"}),e.jsx("button",{onClick:()=>N("analysis"),className:`px-4 py-2 rounded-t-lg text-sm font-medium ${h==="analysis"?"bg-primary text-white":"bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600"}`,children:"Анализ"})]})}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700 border-b border-gray-200 dark:border-gray-700 px-4",children:[h==="items"&&e.jsx("div",{className:"flex space-x-4 py-2",children:i.items.map(s=>e.jsx("button",{onClick:()=>I("items",s),className:`px-3 py-1 text-sm ${a.items===s?"text-primary font-medium":"text-gray-600 dark:text-gray-400 hover:text-primary dark:hover:text-primary"}`,children:s==="list"?"Список предметов":s==="editor"?"Редактор предметов":s==="comparison"?"Сравнение предметов":s},s))}),h==="recipes"&&e.jsx("div",{className:"flex space-x-4 py-2",children:i.recipes.map(s=>e.jsx("button",{onClick:()=>I("recipes",s),className:`px-3 py-1 text-sm ${a.recipes===s?"text-primary font-medium":"text-gray-600 dark:text-gray-400 hover:text-primary dark:hover:text-primary"}`,children:s==="list"?"Список рецептов":s==="editor"?"Редактор рецептов":s==="tree"?"Дерево крафта":s},s))}),h==="balance"&&e.jsx("div",{className:"flex space-x-4 py-2",children:i.balance.map(s=>e.jsx("button",{onClick:()=>I("balance",s),className:`px-3 py-1 text-sm ${a.balance===s?"text-primary font-medium":"text-gray-600 dark:text-gray-400 hover:text-primary dark:hover:text-primary"}`,children:s==="parameters"?"Параметры баланса":s==="configs"?"Конфигурации":s},s))}),h==="analysis"&&e.jsx("div",{className:"flex space-x-4 py-2",children:i.analysis.map(s=>e.jsx("button",{onClick:()=>I("analysis",s),className:`px-3 py-1 text-sm ${a.analysis===s?"text-primary font-medium":"text-gray-600 dark:text-gray-400 hover:text-primary dark:hover:text-primary"}`,children:s==="items"?"Анализ предметов":s==="recipes"?"Анализ рецептов":s},s))})]}),e.jsx("div",{className:"flex-1 p-4 bg-gray-100 dark:bg-gray-800 overflow-auto",children:t()})]})},Xt=()=>e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-1",children:e.jsx(zt,{})});function Jt(){const[o,R]=u.useState(!1);return e.jsx(ct,{children:e.jsx(mt,{children:e.jsxs("div",{className:"flex h-screen bg-gray-50 dark:bg-gray-900 text-gray-900 dark:text-gray-100",children:[e.jsx("div",{className:`md:hidden fixed inset-0 z-20 bg-black bg-opacity-50 transition-opacity ${o?"opacity-100":"opacity-0 pointer-events-none"}`,onClick:()=>R(!1)}),e.jsx("div",{className:`fixed md:relative z-30 md:z-auto w-64 md:w-64 h-screen transition-transform transform ${o?"translate-x-0":"-translate-x-full md:translate-x-0"}`,children:e.jsx(xt,{})}),e.jsx("main",{className:"flex-1 overflow-auto",children:e.jsxs("div",{className:"container mx-auto p-4",children:[e.jsxs("div",{className:"flex items-center mb-4",children:[e.jsx("button",{className:"md:hidden mr-2 p-2 rounded-md text-gray-500",onClick:()=>R(!0),children:e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 6h16M4 12h16M4 18h16"})})}),e.jsx(ut,{})]}),e.jsxs(lt,{children:[e.jsx($e,{path:"/",element:e.jsx(et,{})}),e.jsx($e,{path:"/units/*",element:e.jsx(et,{})}),e.jsx($e,{path:"/mixing",element:e.jsx($t,{})}),e.jsx($e,{path:"/balance-crafting/*",element:e.jsx(Xt,{})}),e.jsx($e,{path:"/neorust",element:e.jsx(Lt,{})}),e.jsx($e,{path:"/shop-builder",element:e.jsx(bt,{})})]})]})})]})})})}it.createRoot(document.getElementById("root")).render(e.jsx(ot.StrictMode,{children:e.jsx(gt,{children:e.jsx(dt,{children:e.jsx(Jt,{})})})}));export{nr as a,ir as c,lr as g};
